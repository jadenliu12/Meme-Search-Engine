"use strict";var hc=Object.create;var ss=Object.defineProperty;var lc=Object.getOwnPropertyDescriptor;var cc=Object.getOwnPropertyNames;var uc=Object.getPrototypeOf,dc=Object.prototype.hasOwnProperty;var p=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),fc=(s,e)=>{for(var t in e)ss(s,t,{get:e[t],enumerable:!0})},Ao=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of cc(e))!dc.call(s,r)&&r!==t&&ss(s,r,{get:()=>e[r],enumerable:!(i=lc(e,r))||i.enumerable});return s};var rs=(s,e,t)=>(t=s!=null?hc(uc(s)):{},Ao(e||!s||!s.__esModule?ss(t,"default",{value:s,enumerable:!0}):t,s)),mc=s=>Ao(ss({},"__esModule",{value:!0}),s);var Xt=p((xw,Zo)=>{"use strict";var Ko=new Map([["C","cwd"],["f","file"],["z","gzip"],["P","preservePaths"],["U","unlink"],["strip-components","strip"],["stripComponents","strip"],["keep-newer","newer"],["keepNewer","newer"],["keep-newer-files","newer"],["keepNewerFiles","newer"],["k","keep"],["keep-existing","keep"],["keepExisting","keep"],["m","noMtime"],["no-mtime","noMtime"],["p","preserveOwner"],["L","follow"],["h","follow"]]);Zo.exports=s=>s?Object.keys(s).map(e=>[Ko.has(e)?Ko.get(e):e,s[e]]).reduce((e,t)=>(e[t[0]]=t[1],e),Object.create(null)):{}});var bs=p((Ow,oa)=>{"use strict";var Jo=typeof process=="object"&&process?process:{stdout:null,stderr:null},Ic=require("events"),Xo=require("stream"),Lc=require("string_decoder"),Qo=Lc.StringDecoder,pe=Symbol("EOF"),ge=Symbol("maybeEmitEnd"),Me=Symbol("emittedEnd"),ms=Symbol("emittingEnd"),Ai=Symbol("emittedError"),ps=Symbol("closed"),ea=Symbol("read"),gs=Symbol("flush"),ta=Symbol("flushChunk"),M=Symbol("encoding"),ye=Symbol("decoder"),ys=Symbol("flowing"),Ii=Symbol("paused"),Qt=Symbol("resume"),R=Symbol("buffer"),te=Symbol("pipes"),O=Symbol("bufferLength"),Br=Symbol("bufferPush"),Dr=Symbol("bufferShift"),A=Symbol("objectMode"),P=Symbol("destroyed"),kr=Symbol("error"),Fr=Symbol("emitData"),ia=Symbol("emitEnd"),Mr=Symbol("emitEnd2"),we=Symbol("async"),jr=Symbol("abort"),ws=Symbol("aborted"),kt=Symbol("signal"),Li=s=>Promise.resolve().then(s),na=global._MP_NO_ITERATOR_SYMBOLS_!=="1",sa=na&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),ra=na&&Symbol.iterator||Symbol("iterator not implemented"),Bc=s=>s==="end"||s==="finish"||s==="prefinish",Dc=s=>s instanceof ArrayBuffer||typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,kc=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s),vs=class{constructor(e,t,i){this.src=e,this.dest=t,this.opts=i,this.ondrain=()=>e[Qt](),t.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},$r=class extends vs{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,i){super(e,t,i),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}},Bi=class extends Xo{constructor(e){super(),this[ys]=!1,this[Ii]=!1,this[te]=[],this[R]=[],this[A]=e&&e.objectMode||!1,this[A]?this[M]=null:this[M]=e&&e.encoding||null,this[M]==="buffer"&&(this[M]=null),this[we]=e&&!!e.async||!1,this[ye]=this[M]?new Qo(this[M]):null,this[pe]=!1,this[Me]=!1,this[ms]=!1,this[ps]=!1,this[Ai]=null,this.writable=!0,this.readable=!0,this[O]=0,this[P]=!1,e&&e.debugExposeBuffer===!0&&Object.defineProperty(this,"buffer",{get:()=>this[R]}),e&&e.debugExposePipes===!0&&Object.defineProperty(this,"pipes",{get:()=>this[te]}),this[kt]=e&&e.signal,this[ws]=!1,this[kt]&&(this[kt].addEventListener("abort",()=>this[jr]()),this[kt].aborted&&this[jr]())}get bufferLength(){return this[O]}get encoding(){return this[M]}set encoding(e){if(this[A])throw new Error("cannot set encoding in objectMode");if(this[M]&&e!==this[M]&&(this[ye]&&this[ye].lastNeed||this[O]))throw new Error("cannot change encoding");this[M]!==e&&(this[ye]=e?new Qo(e):null,this[R].length&&(this[R]=this[R].map(t=>this[ye].write(t)))),this[M]=e}setEncoding(e){this.encoding=e}get objectMode(){return this[A]}set objectMode(e){this[A]=this[A]||!!e}get async(){return this[we]}set async(e){this[we]=this[we]||!!e}[jr](){this[ws]=!0,this.emit("abort",this[kt].reason),this.destroy(this[kt].reason)}get aborted(){return this[ws]}set aborted(e){}write(e,t,i){if(this[ws])return!1;if(this[pe])throw new Error("write after end");if(this[P])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(i=t,t="utf8"),t||(t="utf8");let r=this[we]?Li:n=>n();return!this[A]&&!Buffer.isBuffer(e)&&(kc(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):Dc(e)?e=Buffer.from(e):typeof e!="string"&&(this.objectMode=!0)),this[A]?(this.flowing&&this[O]!==0&&this[gs](!0),this.flowing?this.emit("data",e):this[Br](e),this[O]!==0&&this.emit("readable"),i&&r(i),this.flowing):e.length?(typeof e=="string"&&!(t===this[M]&&!this[ye].lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[M]&&(e=this[ye].write(e)),this.flowing&&this[O]!==0&&this[gs](!0),this.flowing?this.emit("data",e):this[Br](e),this[O]!==0&&this.emit("readable"),i&&r(i),this.flowing):(this[O]!==0&&this.emit("readable"),i&&r(i),this.flowing)}read(e){if(this[P])return null;if(this[O]===0||e===0||e>this[O])return this[ge](),null;this[A]&&(e=null),this[R].length>1&&!this[A]&&(this.encoding?this[R]=[this[R].join("")]:this[R]=[Buffer.concat(this[R],this[O])]);let t=this[ea](e||null,this[R][0]);return this[ge](),t}[ea](e,t){return e===t.length||e===null?this[Dr]():(this[R][0]=t.slice(e),t=t.slice(0,e),this[O]-=e),this.emit("data",t),!this[R].length&&!this[pe]&&this.emit("drain"),t}end(e,t,i){return typeof e=="function"&&(i=e,e=null),typeof t=="function"&&(i=t,t="utf8"),e&&this.write(e,t),i&&this.once("end",i),this[pe]=!0,this.writable=!1,(this.flowing||!this[Ii])&&this[ge](),this}[Qt](){this[P]||(this[Ii]=!1,this[ys]=!0,this.emit("resume"),this[R].length?this[gs]():this[pe]?this[ge]():this.emit("drain"))}resume(){return this[Qt]()}pause(){this[ys]=!1,this[Ii]=!0}get destroyed(){return this[P]}get flowing(){return this[ys]}get paused(){return this[Ii]}[Br](e){this[A]?this[O]+=1:this[O]+=e.length,this[R].push(e)}[Dr](){return this[A]?this[O]-=1:this[O]-=this[R][0].length,this[R].shift()}[gs](e){do;while(this[ta](this[Dr]())&&this[R].length);!e&&!this[R].length&&!this[pe]&&this.emit("drain")}[ta](e){return this.emit("data",e),this.flowing}pipe(e,t){if(this[P])return;let i=this[Me];return t=t||{},e===Jo.stdout||e===Jo.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,i?t.end&&e.end():(this[te].push(t.proxyErrors?new $r(this,e,t):new vs(this,e,t)),this[we]?Li(()=>this[Qt]()):this[Qt]()),e}unpipe(e){let t=this[te].find(i=>i.dest===e);t&&(this[te].splice(this[te].indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let i=super.on(e,t);return e==="data"&&!this[te].length&&!this.flowing?this[Qt]():e==="readable"&&this[O]!==0?super.emit("readable"):Bc(e)&&this[Me]?(super.emit(e),this.removeAllListeners(e)):e==="error"&&this[Ai]&&(this[we]?Li(()=>t.call(this,this[Ai])):t.call(this,this[Ai])),i}get emittedEnd(){return this[Me]}[ge](){!this[ms]&&!this[Me]&&!this[P]&&this[R].length===0&&this[pe]&&(this[ms]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[ps]&&this.emit("close"),this[ms]=!1)}emit(e,t,...i){if(e!=="error"&&e!=="close"&&e!==P&&this[P])return;if(e==="data")return!this[A]&&!t?!1:this[we]?Li(()=>this[Fr](t)):this[Fr](t);if(e==="end")return this[ia]();if(e==="close"){if(this[ps]=!0,!this[Me]&&!this[P])return;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[Ai]=t,super.emit(kr,t);let n=!this[kt]||this.listeners("error").length?super.emit("error",t):!1;return this[ge](),n}else if(e==="resume"){let n=super.emit("resume");return this[ge](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,t,...i);return this[ge](),r}[Fr](e){for(let i of this[te])i.dest.write(e)===!1&&this.pause();let t=super.emit("data",e);return this[ge](),t}[ia](){this[Me]||(this[Me]=!0,this.readable=!1,this[we]?Li(()=>this[Mr]()):this[Mr]())}[Mr](){if(this[ye]){let t=this[ye].end();if(t){for(let i of this[te])i.dest.write(t);super.emit("data",t)}}for(let t of this[te])t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}collect(){let e=[];this[A]||(e.dataLength=0);let t=this.promise();return this.on("data",i=>{e.push(i),this[A]||(e.dataLength+=i.length)}),t.then(()=>e)}concat(){return this[A]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(e=>this[A]?Promise.reject(new Error("cannot concat in objectMode")):this[M]?e.join(""):Buffer.concat(e,e.dataLength))}promise(){return new Promise((e,t)=>{this.on(P,()=>t(new Error("stream destroyed"))),this.on("error",i=>t(i)),this.on("end",()=>e())})}[sa](){let e=!1,t=()=>(this.pause(),e=!0,Promise.resolve({done:!0}));return{next:()=>{if(e)return t();let r=this.read();if(r!==null)return Promise.resolve({done:!1,value:r});if(this[pe])return t();let n=null,o=null,a=d=>{this.removeListener("data",l),this.removeListener("end",h),this.removeListener(P,u),t(),o(d)},l=d=>{this.removeListener("error",a),this.removeListener("end",h),this.removeListener(P,u),this.pause(),n({value:d,done:!!this[pe]})},h=()=>{this.removeListener("error",a),this.removeListener("data",l),this.removeListener(P,u),t(),n({done:!0})},u=()=>a(new Error("stream destroyed"));return new Promise((d,f)=>{o=f,n=d,this.once(P,u),this.once("error",a),this.once("end",h),this.once("data",l)})},throw:t,return:t,[sa](){return this}}}[ra](){let e=!1,t=()=>(this.pause(),this.removeListener(kr,t),this.removeListener(P,t),this.removeListener("end",t),e=!0,{done:!0}),i=()=>{if(e)return t();let r=this.read();return r===null?t():{value:r}};return this.once("end",t),this.once(kr,t),this.once(P,t),{next:i,throw:t,return:t,[ra](){return this}}}destroy(e){return this[P]?(e?this.emit("error",e):this.emit(P),this):(this[P]=!0,this[R].length=0,this[O]=0,typeof this.close=="function"&&!this[ps]&&this.close(),e?this.emit("error",e):this.emit(P),this)}static isStream(e){return!!e&&(e instanceof Bi||e instanceof Xo||e instanceof Ic&&(typeof e.pipe=="function"||typeof e.write=="function"&&typeof e.end=="function"))}};oa.exports=Bi});var ha=p((Tw,aa)=>{var Fc=require("zlib").constants||{ZLIB_VERNUM:4736};aa.exports=Object.freeze(Object.assign(Object.create(null),{Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_VERSION_ERROR:-6,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,BROTLI_DECODE:8,BROTLI_ENCODE:9,Z_MIN_WINDOWBITS:8,Z_MAX_WINDOWBITS:15,Z_DEFAULT_WINDOWBITS:15,Z_MIN_CHUNK:64,Z_MAX_CHUNK:1/0,Z_DEFAULT_CHUNK:16384,Z_MIN_MEMLEVEL:1,Z_MAX_MEMLEVEL:9,Z_DEFAULT_MEMLEVEL:8,Z_MIN_LEVEL:-1,Z_MAX_LEVEL:9,Z_DEFAULT_LEVEL:-1,BROTLI_OPERATION_PROCESS:0,BROTLI_OPERATION_FLUSH:1,BROTLI_OPERATION_FINISH:2,BROTLI_OPERATION_EMIT_METADATA:3,BROTLI_MODE_GENERIC:0,BROTLI_MODE_TEXT:1,BROTLI_MODE_FONT:2,BROTLI_DEFAULT_MODE:0,BROTLI_MIN_QUALITY:0,BROTLI_MAX_QUALITY:11,BROTLI_DEFAULT_QUALITY:11,BROTLI_MIN_WINDOW_BITS:10,BROTLI_MAX_WINDOW_BITS:24,BROTLI_LARGE_MAX_WINDOW_BITS:30,BROTLI_DEFAULT_WINDOW:22,BROTLI_MIN_INPUT_BLOCK_BITS:16,BROTLI_MAX_INPUT_BLOCK_BITS:24,BROTLI_PARAM_MODE:0,BROTLI_PARAM_QUALITY:1,BROTLI_PARAM_LGWIN:2,BROTLI_PARAM_LGBLOCK:3,BROTLI_PARAM_DISABLE_LITERAL_CONTEXT_MODELING:4,BROTLI_PARAM_SIZE_HINT:5,BROTLI_PARAM_LARGE_WINDOW:6,BROTLI_PARAM_NPOSTFIX:7,BROTLI_PARAM_NDIRECT:8,BROTLI_DECODER_RESULT_ERROR:0,BROTLI_DECODER_RESULT_SUCCESS:1,BROTLI_DECODER_RESULT_NEEDS_MORE_INPUT:2,BROTLI_DECODER_RESULT_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_PARAM_DISABLE_RING_BUFFER_REALLOCATION:0,BROTLI_DECODER_PARAM_LARGE_WINDOW:1,BROTLI_DECODER_NO_ERROR:0,BROTLI_DECODER_SUCCESS:1,BROTLI_DECODER_NEEDS_MORE_INPUT:2,BROTLI_DECODER_NEEDS_MORE_OUTPUT:3,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_NIBBLE:-1,BROTLI_DECODER_ERROR_FORMAT_RESERVED:-2,BROTLI_DECODER_ERROR_FORMAT_EXUBERANT_META_NIBBLE:-3,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_ALPHABET:-4,BROTLI_DECODER_ERROR_FORMAT_SIMPLE_HUFFMAN_SAME:-5,BROTLI_DECODER_ERROR_FORMAT_CL_SPACE:-6,BROTLI_DECODER_ERROR_FORMAT_HUFFMAN_SPACE:-7,BROTLI_DECODER_ERROR_FORMAT_CONTEXT_MAP_REPEAT:-8,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_1:-9,BROTLI_DECODER_ERROR_FORMAT_BLOCK_LENGTH_2:-10,BROTLI_DECODER_ERROR_FORMAT_TRANSFORM:-11,BROTLI_DECODER_ERROR_FORMAT_DICTIONARY:-12,BROTLI_DECODER_ERROR_FORMAT_WINDOW_BITS:-13,BROTLI_DECODER_ERROR_FORMAT_PADDING_1:-14,BROTLI_DECODER_ERROR_FORMAT_PADDING_2:-15,BROTLI_DECODER_ERROR_FORMAT_DISTANCE:-16,BROTLI_DECODER_ERROR_DICTIONARY_NOT_SET:-19,BROTLI_DECODER_ERROR_INVALID_ARGUMENTS:-20,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MODES:-21,BROTLI_DECODER_ERROR_ALLOC_TREE_GROUPS:-22,BROTLI_DECODER_ERROR_ALLOC_CONTEXT_MAP:-25,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_1:-26,BROTLI_DECODER_ERROR_ALLOC_RING_BUFFER_2:-27,BROTLI_DECODER_ERROR_ALLOC_BLOCK_TYPE_TREES:-30,BROTLI_DECODER_ERROR_UNREACHABLE:-31},Fc))});var wa=p((_w,ya)=>{"use strict";var la=typeof process=="object"&&process?process:{stdout:null,stderr:null},Mc=require("events"),ca=require("stream"),ua=require("string_decoder").StringDecoder,ve=Symbol("EOF"),be=Symbol("maybeEmitEnd"),je=Symbol("emittedEnd"),Es=Symbol("emittingEnd"),Di=Symbol("emittedError"),Ss=Symbol("closed"),da=Symbol("read"),Cs=Symbol("flush"),fa=Symbol("flushChunk"),j=Symbol("encoding"),Ee=Symbol("decoder"),Ns=Symbol("flowing"),ki=Symbol("paused"),ei=Symbol("resume"),T=Symbol("bufferLength"),qr=Symbol("bufferPush"),Ur=Symbol("bufferShift"),L=Symbol("objectMode"),B=Symbol("destroyed"),Gr=Symbol("emitData"),ma=Symbol("emitEnd"),Vr=Symbol("emitEnd2"),Se=Symbol("async"),Fi=s=>Promise.resolve().then(s),pa=global._MP_NO_ITERATOR_SYMBOLS_!=="1",jc=pa&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),$c=pa&&Symbol.iterator||Symbol("iterator not implemented"),qc=s=>s==="end"||s==="finish"||s==="prefinish",Uc=s=>s instanceof ArrayBuffer||typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,Gc=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s),Rs=class{constructor(e,t,i){this.src=e,this.dest=t,this.opts=i,this.ondrain=()=>e[ei](),t.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},zr=class extends Rs{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,i){super(e,t,i),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}};ya.exports=class ga extends ca{constructor(e){super(),this[Ns]=!1,this[ki]=!1,this.pipes=[],this.buffer=[],this[L]=e&&e.objectMode||!1,this[L]?this[j]=null:this[j]=e&&e.encoding||null,this[j]==="buffer"&&(this[j]=null),this[Se]=e&&!!e.async||!1,this[Ee]=this[j]?new ua(this[j]):null,this[ve]=!1,this[je]=!1,this[Es]=!1,this[Ss]=!1,this[Di]=null,this.writable=!0,this.readable=!0,this[T]=0,this[B]=!1}get bufferLength(){return this[T]}get encoding(){return this[j]}set encoding(e){if(this[L])throw new Error("cannot set encoding in objectMode");if(this[j]&&e!==this[j]&&(this[Ee]&&this[Ee].lastNeed||this[T]))throw new Error("cannot change encoding");this[j]!==e&&(this[Ee]=e?new ua(e):null,this.buffer.length&&(this.buffer=this.buffer.map(t=>this[Ee].write(t)))),this[j]=e}setEncoding(e){this.encoding=e}get objectMode(){return this[L]}set objectMode(e){this[L]=this[L]||!!e}get async(){return this[Se]}set async(e){this[Se]=this[Se]||!!e}write(e,t,i){if(this[ve])throw new Error("write after end");if(this[B])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(i=t,t="utf8"),t||(t="utf8");let r=this[Se]?Fi:n=>n();return!this[L]&&!Buffer.isBuffer(e)&&(Gc(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):Uc(e)?e=Buffer.from(e):typeof e!="string"&&(this.objectMode=!0)),this[L]?(this.flowing&&this[T]!==0&&this[Cs](!0),this.flowing?this.emit("data",e):this[qr](e),this[T]!==0&&this.emit("readable"),i&&r(i),this.flowing):e.length?(typeof e=="string"&&!(t===this[j]&&!this[Ee].lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[j]&&(e=this[Ee].write(e)),this.flowing&&this[T]!==0&&this[Cs](!0),this.flowing?this.emit("data",e):this[qr](e),this[T]!==0&&this.emit("readable"),i&&r(i),this.flowing):(this[T]!==0&&this.emit("readable"),i&&r(i),this.flowing)}read(e){if(this[B])return null;if(this[T]===0||e===0||e>this[T])return this[be](),null;this[L]&&(e=null),this.buffer.length>1&&!this[L]&&(this.encoding?this.buffer=[this.buffer.join("")]:this.buffer=[Buffer.concat(this.buffer,this[T])]);let t=this[da](e||null,this.buffer[0]);return this[be](),t}[da](e,t){return e===t.length||e===null?this[Ur]():(this.buffer[0]=t.slice(e),t=t.slice(0,e),this[T]-=e),this.emit("data",t),!this.buffer.length&&!this[ve]&&this.emit("drain"),t}end(e,t,i){return typeof e=="function"&&(i=e,e=null),typeof t=="function"&&(i=t,t="utf8"),e&&this.write(e,t),i&&this.once("end",i),this[ve]=!0,this.writable=!1,(this.flowing||!this[ki])&&this[be](),this}[ei](){this[B]||(this[ki]=!1,this[Ns]=!0,this.emit("resume"),this.buffer.length?this[Cs]():this[ve]?this[be]():this.emit("drain"))}resume(){return this[ei]()}pause(){this[Ns]=!1,this[ki]=!0}get destroyed(){return this[B]}get flowing(){return this[Ns]}get paused(){return this[ki]}[qr](e){this[L]?this[T]+=1:this[T]+=e.length,this.buffer.push(e)}[Ur](){return this.buffer.length&&(this[L]?this[T]-=1:this[T]-=this.buffer[0].length),this.buffer.shift()}[Cs](e){do;while(this[fa](this[Ur]()));!e&&!this.buffer.length&&!this[ve]&&this.emit("drain")}[fa](e){return e?(this.emit("data",e),this.flowing):!1}pipe(e,t){if(this[B])return;let i=this[je];return t=t||{},e===la.stdout||e===la.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,i?t.end&&e.end():(this.pipes.push(t.proxyErrors?new zr(this,e,t):new Rs(this,e,t)),this[Se]?Fi(()=>this[ei]()):this[ei]()),e}unpipe(e){let t=this.pipes.find(i=>i.dest===e);t&&(this.pipes.splice(this.pipes.indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let i=super.on(e,t);return e==="data"&&!this.pipes.length&&!this.flowing?this[ei]():e==="readable"&&this[T]!==0?super.emit("readable"):qc(e)&&this[je]?(super.emit(e),this.removeAllListeners(e)):e==="error"&&this[Di]&&(this[Se]?Fi(()=>t.call(this,this[Di])):t.call(this,this[Di])),i}get emittedEnd(){return this[je]}[be](){!this[Es]&&!this[je]&&!this[B]&&this.buffer.length===0&&this[ve]&&(this[Es]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Ss]&&this.emit("close"),this[Es]=!1)}emit(e,t,...i){if(e!=="error"&&e!=="close"&&e!==B&&this[B])return;if(e==="data")return t?this[Se]?Fi(()=>this[Gr](t)):this[Gr](t):!1;if(e==="end")return this[ma]();if(e==="close"){if(this[Ss]=!0,!this[je]&&!this[B])return;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[Di]=t;let n=super.emit("error",t);return this[be](),n}else if(e==="resume"){let n=super.emit("resume");return this[be](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,t,...i);return this[be](),r}[Gr](e){for(let i of this.pipes)i.dest.write(e)===!1&&this.pause();let t=super.emit("data",e);return this[be](),t}[ma](){this[je]||(this[je]=!0,this.readable=!1,this[Se]?Fi(()=>this[Vr]()):this[Vr]())}[Vr](){if(this[Ee]){let t=this[Ee].end();if(t){for(let i of this.pipes)i.dest.write(t);super.emit("data",t)}}for(let t of this.pipes)t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}collect(){let e=[];this[L]||(e.dataLength=0);let t=this.promise();return this.on("data",i=>{e.push(i),this[L]||(e.dataLength+=i.length)}),t.then(()=>e)}concat(){return this[L]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(e=>this[L]?Promise.reject(new Error("cannot concat in objectMode")):this[j]?e.join(""):Buffer.concat(e,e.dataLength))}promise(){return new Promise((e,t)=>{this.on(B,()=>t(new Error("stream destroyed"))),this.on("error",i=>t(i)),this.on("end",()=>e())})}[jc](){return{next:()=>{let t=this.read();if(t!==null)return Promise.resolve({done:!1,value:t});if(this[ve])return Promise.resolve({done:!0});let i=null,r=null,n=h=>{this.removeListener("data",o),this.removeListener("end",a),r(h)},o=h=>{this.removeListener("error",n),this.removeListener("end",a),this.pause(),i({value:h,done:!!this[ve]})},a=()=>{this.removeListener("error",n),this.removeListener("data",o),i({done:!0})},l=()=>n(new Error("stream destroyed"));return new Promise((h,u)=>{r=u,i=h,this.once(B,l),this.once("error",n),this.once("end",a),this.once("data",o)})}}}[$c](){return{next:()=>{let t=this.read();return{value:t,done:t===null}}}}destroy(e){return this[B]?(e?this.emit("error",e):this.emit(B),this):(this[B]=!0,this.buffer.length=0,this[T]=0,typeof this.close=="function"&&!this[Ss]&&this.close(),e?this.emit("error",e):this.emit(B),this)}static isStream(e){return!!e&&(e instanceof ga||e instanceof ca||e instanceof Mc&&(typeof e.pipe=="function"||typeof e.write=="function"&&typeof e.end=="function"))}}});var hn=p(G=>{"use strict";var Zr=require("assert"),$e=require("buffer").Buffer,Ea=require("zlib"),Ft=G.constants=ha(),Vc=wa(),va=$e.concat,Mt=Symbol("_superWrite"),ii=class extends Error{constructor(e){super("zlib: "+e.message),this.code=e.code,this.errno=e.errno,this.code||(this.code="ZLIB_ERROR"),this.message="zlib: "+e.message,Error.captureStackTrace(this,this.constructor)}get name(){return"ZlibError"}},zc=Symbol("opts"),Mi=Symbol("flushFlag"),ba=Symbol("finishFlushFlag"),an=Symbol("fullFlushFlag"),E=Symbol("handle"),Ps=Symbol("onError"),ti=Symbol("sawError"),Wr=Symbol("level"),Hr=Symbol("strategy"),Yr=Symbol("ended"),Aw=Symbol("_defaultFullFlush"),xs=class extends Vc{constructor(e,t){if(!e||typeof e!="object")throw new TypeError("invalid options for ZlibBase constructor");super(e),this[ti]=!1,this[Yr]=!1,this[zc]=e,this[Mi]=e.flush,this[ba]=e.finishFlush;try{this[E]=new Ea[t](e)}catch(i){throw new ii(i)}this[Ps]=i=>{this[ti]||(this[ti]=!0,this.close(),this.emit("error",i))},this[E].on("error",i=>this[Ps](new ii(i))),this.once("end",()=>this.close)}close(){this[E]&&(this[E].close(),this[E]=null,this.emit("close"))}reset(){if(!this[ti])return Zr(this[E],"zlib binding closed"),this[E].reset()}flush(e){this.ended||(typeof e!="number"&&(e=this[an]),this.write(Object.assign($e.alloc(0),{[Mi]:e})))}end(e,t,i){return e&&this.write(e,t),this.flush(this[ba]),this[Yr]=!0,super.end(null,null,i)}get ended(){return this[Yr]}write(e,t,i){if(typeof t=="function"&&(i=t,t="utf8"),typeof e=="string"&&(e=$e.from(e,t)),this[ti])return;Zr(this[E],"zlib binding closed");let r=this[E]._handle,n=r.close;r.close=()=>{};let o=this[E].close;this[E].close=()=>{},$e.concat=h=>h;let a;try{let h=typeof e[Mi]=="number"?e[Mi]:this[Mi];a=this[E]._processChunk(e,h),$e.concat=va}catch(h){$e.concat=va,this[Ps](new ii(h))}finally{this[E]&&(this[E]._handle=r,r.close=n,this[E].close=o,this[E].removeAllListeners("error"))}this[E]&&this[E].on("error",h=>this[Ps](new ii(h)));let l;if(a)if(Array.isArray(a)&&a.length>0){l=this[Mt]($e.from(a[0]));for(let h=1;h<a.length;h++)l=this[Mt](a[h])}else l=this[Mt]($e.from(a));return i&&i(),l}[Mt](e){return super.write(e)}},Ce=class extends xs{constructor(e,t){e=e||{},e.flush=e.flush||Ft.Z_NO_FLUSH,e.finishFlush=e.finishFlush||Ft.Z_FINISH,super(e,t),this[an]=Ft.Z_FULL_FLUSH,this[Wr]=e.level,this[Hr]=e.strategy}params(e,t){if(!this[ti]){if(!this[E])throw new Error("cannot switch params when binding is closed");if(!this[E].params)throw new Error("not supported in this implementation");if(this[Wr]!==e||this[Hr]!==t){this.flush(Ft.Z_SYNC_FLUSH),Zr(this[E],"zlib binding closed");let i=this[E].flush;this[E].flush=(r,n)=>{this.flush(r),n()};try{this[E].params(e,t)}finally{this[E].flush=i}this[E]&&(this[Wr]=e,this[Hr]=t)}}}},Jr=class extends Ce{constructor(e){super(e,"Deflate")}},Xr=class extends Ce{constructor(e){super(e,"Inflate")}},Kr=Symbol("_portable"),Qr=class extends Ce{constructor(e){super(e,"Gzip"),this[Kr]=e&&!!e.portable}[Mt](e){return this[Kr]?(this[Kr]=!1,e[9]=255,super[Mt](e)):super[Mt](e)}},en=class extends Ce{constructor(e){super(e,"Gunzip")}},tn=class extends Ce{constructor(e){super(e,"DeflateRaw")}},sn=class extends Ce{constructor(e){super(e,"InflateRaw")}},rn=class extends Ce{constructor(e){super(e,"Unzip")}},Os=class extends xs{constructor(e,t){e=e||{},e.flush=e.flush||Ft.BROTLI_OPERATION_PROCESS,e.finishFlush=e.finishFlush||Ft.BROTLI_OPERATION_FINISH,super(e,t),this[an]=Ft.BROTLI_OPERATION_FLUSH}},nn=class extends Os{constructor(e){super(e,"BrotliCompress")}},on=class extends Os{constructor(e){super(e,"BrotliDecompress")}};G.Deflate=Jr;G.Inflate=Xr;G.Gzip=Qr;G.Gunzip=en;G.DeflateRaw=tn;G.InflateRaw=sn;G.Unzip=rn;typeof Ea.BrotliCompress=="function"?(G.BrotliCompress=nn,G.BrotliDecompress=on):G.BrotliCompress=G.BrotliDecompress=class{constructor(){throw new Error("Brotli is not supported in this version of Node.js")}}});var si=p((Bw,Sa)=>{var Wc=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform;Sa.exports=Wc!=="win32"?s=>s:s=>s&&s.replace(/\\/g,"/")});var Ts=p((kw,Ca)=>{"use strict";var Hc=bs(),ln=si(),cn=Symbol("slurp");Ca.exports=class extends Hc{constructor(e,t,i){switch(super(),this.pause(),this.extended=t,this.globalExtended=i,this.header=e,this.startBlockSize=512*Math.ceil(e.size/512),this.blockRemain=this.startBlockSize,this.remain=e.size,this.type=e.type,this.meta=!1,this.ignore=!1,this.type){case"File":case"OldFile":case"Link":case"SymbolicLink":case"CharacterDevice":case"BlockDevice":case"Directory":case"FIFO":case"ContiguousFile":case"GNUDumpDir":break;case"NextFileHasLongLinkpath":case"NextFileHasLongPath":case"OldGnuLongPath":case"GlobalExtendedHeader":case"ExtendedHeader":case"OldExtendedHeader":this.meta=!0;break;default:this.ignore=!0}this.path=ln(e.path),this.mode=e.mode,this.mode&&(this.mode=this.mode&4095),this.uid=e.uid,this.gid=e.gid,this.uname=e.uname,this.gname=e.gname,this.size=e.size,this.mtime=e.mtime,this.atime=e.atime,this.ctime=e.ctime,this.linkpath=ln(e.linkpath),this.uname=e.uname,this.gname=e.gname,t&&this[cn](t),i&&this[cn](i,!0)}write(e){let t=e.length;if(t>this.blockRemain)throw new Error("writing more to entry than is appropriate");let i=this.remain,r=this.blockRemain;return this.remain=Math.max(0,i-t),this.blockRemain=Math.max(0,r-t),this.ignore?!0:i>=t?super.write(e):super.write(e.slice(0,i))}[cn](e,t){for(let i in e)e[i]!==null&&e[i]!==void 0&&!(t&&i==="path")&&(this[i]=i==="path"||i==="linkpath"?ln(e[i]):e[i])}}});var un=p(_s=>{"use strict";_s.name=new Map([["0","File"],["","OldFile"],["1","Link"],["2","SymbolicLink"],["3","CharacterDevice"],["4","BlockDevice"],["5","Directory"],["6","FIFO"],["7","ContiguousFile"],["g","GlobalExtendedHeader"],["x","ExtendedHeader"],["A","SolarisACL"],["D","GNUDumpDir"],["I","Inode"],["K","NextFileHasLongLinkpath"],["L","NextFileHasLongPath"],["M","ContinuationFile"],["N","OldGnuLongPath"],["S","SparseFile"],["V","TapeVolumeHeader"],["X","OldExtendedHeader"]]);_s.code=new Map(Array.from(_s.name).map(s=>[s[1],s[0]]))});var xa=p((Mw,Pa)=>{"use strict";var Yc=(s,e)=>{if(Number.isSafeInteger(s))s<0?Zc(s,e):Kc(s,e);else throw Error("cannot encode number outside of javascript safe integer range");return e},Kc=(s,e)=>{e[0]=128;for(var t=e.length;t>1;t--)e[t-1]=s&255,s=Math.floor(s/256)},Zc=(s,e)=>{e[0]=255;var t=!1;s=s*-1;for(var i=e.length;i>1;i--){var r=s&255;s=Math.floor(s/256),t?e[i-1]=Na(r):r===0?e[i-1]=0:(t=!0,e[i-1]=Ra(r))}},Jc=s=>{let e=s[0],t=e===128?Qc(s.slice(1,s.length)):e===255?Xc(s):null;if(t===null)throw Error("invalid base256 encoding");if(!Number.isSafeInteger(t))throw Error("parsed number outside of javascript safe integer range");return t},Xc=s=>{for(var e=s.length,t=0,i=!1,r=e-1;r>-1;r--){var n=s[r],o;i?o=Na(n):n===0?o=n:(i=!0,o=Ra(n)),o!==0&&(t-=o*Math.pow(256,e-r-1))}return t},Qc=s=>{for(var e=s.length,t=0,i=e-1;i>-1;i--){var r=s[i];r!==0&&(t+=r*Math.pow(256,e-i-1))}return t},Na=s=>(255^s)&255,Ra=s=>(255^s)+1&255;Pa.exports={encode:Yc,parse:Jc}});var ni=p((jw,Ta)=>{"use strict";var dn=un(),ri=require("path").posix,Oa=xa(),fn=Symbol("slurp"),V=Symbol("type"),gn=class{constructor(e,t,i,r){this.cksumValid=!1,this.needPax=!1,this.nullBlock=!1,this.block=null,this.path=null,this.mode=null,this.uid=null,this.gid=null,this.size=null,this.mtime=null,this.cksum=null,this[V]="0",this.linkpath=null,this.uname=null,this.gname=null,this.devmaj=0,this.devmin=0,this.atime=null,this.ctime=null,Buffer.isBuffer(e)?this.decode(e,t||0,i,r):e&&this.set(e)}decode(e,t,i,r){if(t||(t=0),!e||!(e.length>=t+512))throw new Error("need 512 bytes for header");if(this.path=jt(e,t,100),this.mode=qe(e,t+100,8),this.uid=qe(e,t+108,8),this.gid=qe(e,t+116,8),this.size=qe(e,t+124,12),this.mtime=mn(e,t+136,12),this.cksum=qe(e,t+148,12),this[fn](i),this[fn](r,!0),this[V]=jt(e,t+156,1),this[V]===""&&(this[V]="0"),this[V]==="0"&&this.path.slice(-1)==="/"&&(this[V]="5"),this[V]==="5"&&(this.size=0),this.linkpath=jt(e,t+157,100),e.slice(t+257,t+265).toString()==="ustar\x0000")if(this.uname=jt(e,t+265,32),this.gname=jt(e,t+297,32),this.devmaj=qe(e,t+329,8),this.devmin=qe(e,t+337,8),e[t+475]!==0){let o=jt(e,t+345,155);this.path=o+"/"+this.path}else{let o=jt(e,t+345,130);o&&(this.path=o+"/"+this.path),this.atime=mn(e,t+476,12),this.ctime=mn(e,t+488,12)}let n=8*32;for(let o=t;o<t+148;o++)n+=e[o];for(let o=t+156;o<t+512;o++)n+=e[o];this.cksumValid=n===this.cksum,this.cksum===null&&n===8*32&&(this.nullBlock=!0)}[fn](e,t){for(let i in e)e[i]!==null&&e[i]!==void 0&&!(t&&i==="path")&&(this[i]=e[i])}encode(e,t){if(e||(e=this.block=Buffer.alloc(512),t=0),t||(t=0),!(e.length>=t+512))throw new Error("need 512 bytes for header");let i=this.ctime||this.atime?130:155,r=eu(this.path||"",i),n=r[0],o=r[1];this.needPax=r[2],this.needPax=$t(e,t,100,n)||this.needPax,this.needPax=Ue(e,t+100,8,this.mode)||this.needPax,this.needPax=Ue(e,t+108,8,this.uid)||this.needPax,this.needPax=Ue(e,t+116,8,this.gid)||this.needPax,this.needPax=Ue(e,t+124,12,this.size)||this.needPax,this.needPax=pn(e,t+136,12,this.mtime)||this.needPax,e[t+156]=this[V].charCodeAt(0),this.needPax=$t(e,t+157,100,this.linkpath)||this.needPax,e.write("ustar\x0000",t+257,8),this.needPax=$t(e,t+265,32,this.uname)||this.needPax,this.needPax=$t(e,t+297,32,this.gname)||this.needPax,this.needPax=Ue(e,t+329,8,this.devmaj)||this.needPax,this.needPax=Ue(e,t+337,8,this.devmin)||this.needPax,this.needPax=$t(e,t+345,i,o)||this.needPax,e[t+475]!==0?this.needPax=$t(e,t+345,155,o)||this.needPax:(this.needPax=$t(e,t+345,130,o)||this.needPax,this.needPax=pn(e,t+476,12,this.atime)||this.needPax,this.needPax=pn(e,t+488,12,this.ctime)||this.needPax);let a=8*32;for(let l=t;l<t+148;l++)a+=e[l];for(let l=t+156;l<t+512;l++)a+=e[l];return this.cksum=a,Ue(e,t+148,8,this.cksum),this.cksumValid=!0,this.needPax}set(e){for(let t in e)e[t]!==null&&e[t]!==void 0&&(this[t]=e[t])}get type(){return dn.name.get(this[V])||this[V]}get typeKey(){return this[V]}set type(e){dn.code.has(e)?this[V]=dn.code.get(e):this[V]=e}},eu=(s,e)=>{let i=s,r="",n,o=ri.parse(s).root||".";if(Buffer.byteLength(i)<100)n=[i,r,!1];else{r=ri.dirname(i),i=ri.basename(i);do Buffer.byteLength(i)<=100&&Buffer.byteLength(r)<=e?n=[i,r,!1]:Buffer.byteLength(i)>100&&Buffer.byteLength(r)<=e?n=[i.slice(0,100-1),r,!0]:(i=ri.join(ri.basename(r),i),r=ri.dirname(r));while(r!==o&&!n);n||(n=[s.slice(0,100-1),"",!0])}return n},jt=(s,e,t)=>s.slice(e,e+t).toString("utf8").replace(/\0.*/,""),mn=(s,e,t)=>tu(qe(s,e,t)),tu=s=>s===null?null:new Date(s*1e3),qe=(s,e,t)=>s[e]&128?Oa.parse(s.slice(e,e+t)):su(s,e,t),iu=s=>isNaN(s)?null:s,su=(s,e,t)=>iu(parseInt(s.slice(e,e+t).toString("utf8").replace(/\0.*$/,"").trim(),8)),ru={12:8589934591,8:2097151},Ue=(s,e,t,i)=>i===null?!1:i>ru[t]||i<0?(Oa.encode(i,s.slice(e,e+t)),!0):(nu(s,e,t,i),!1),nu=(s,e,t,i)=>s.write(ou(i,t),e,t,"ascii"),ou=(s,e)=>au(Math.floor(s).toString(8),e),au=(s,e)=>(s.length===e-1?s:new Array(e-s.length-1).join("0")+s+" ")+"\0",pn=(s,e,t,i)=>i===null?!1:Ue(s,e,t,i.getTime()/1e3),hu=new Array(156).join("\0"),$t=(s,e,t,i)=>i===null?!1:(s.write(i+hu,e,t,"utf8"),i.length!==Buffer.byteLength(i)||i.length>t);Ta.exports=gn});var As=p(($w,_a)=>{"use strict";var lu=ni(),cu=require("path"),ji=class{constructor(e,t){this.atime=e.atime||null,this.charset=e.charset||null,this.comment=e.comment||null,this.ctime=e.ctime||null,this.gid=e.gid||null,this.gname=e.gname||null,this.linkpath=e.linkpath||null,this.mtime=e.mtime||null,this.path=e.path||null,this.size=e.size||null,this.uid=e.uid||null,this.uname=e.uname||null,this.dev=e.dev||null,this.ino=e.ino||null,this.nlink=e.nlink||null,this.global=t||!1}encode(){let e=this.encodeBody();if(e==="")return null;let t=Buffer.byteLength(e),i=512*Math.ceil(1+t/512),r=Buffer.allocUnsafe(i);for(let n=0;n<512;n++)r[n]=0;new lu({path:("PaxHeader/"+cu.basename(this.path)).slice(0,99),mode:this.mode||420,uid:this.uid||null,gid:this.gid||null,size:t,mtime:this.mtime||null,type:this.global?"GlobalExtendedHeader":"ExtendedHeader",linkpath:"",uname:this.uname||"",gname:this.gname||"",devmaj:0,devmin:0,atime:this.atime||null,ctime:this.ctime||null}).encode(r),r.write(e,512,t,"utf8");for(let n=t+512;n<r.length;n++)r[n]=0;return r}encodeBody(){return this.encodeField("path")+this.encodeField("ctime")+this.encodeField("atime")+this.encodeField("dev")+this.encodeField("ino")+this.encodeField("nlink")+this.encodeField("charset")+this.encodeField("comment")+this.encodeField("gid")+this.encodeField("gname")+this.encodeField("linkpath")+this.encodeField("mtime")+this.encodeField("size")+this.encodeField("uid")+this.encodeField("uname")}encodeField(e){if(this[e]===null||this[e]===void 0)return"";let t=this[e]instanceof Date?this[e].getTime()/1e3:this[e],i=" "+(e==="dev"||e==="ino"||e==="nlink"?"SCHILY.":"")+e+"="+t+`
`,r=Buffer.byteLength(i),n=Math.floor(Math.log(r)/Math.log(10))+1;return r+n>=Math.pow(10,n)&&(n+=1),n+r+i}};ji.parse=(s,e,t)=>new ji(uu(du(s),e),t);var uu=(s,e)=>e?Object.keys(s).reduce((t,i)=>(t[i]=s[i],t),e):s,du=s=>s.replace(/\n$/,"").split(`
`).reduce(fu,Object.create(null)),fu=(s,e)=>{let t=parseInt(e,10);if(t!==Buffer.byteLength(e)+1)return s;e=e.slice((t+" ").length);let i=e.split("="),r=i.shift().replace(/^SCHILY\.(dev|ino|nlink)/,"$1");if(!r)return s;let n=i.join("=");return s[r]=/^([A-Z]+\.)?([mac]|birth|creation)time$/.test(r)?new Date(n*1e3):/^[0-9]+$/.test(n)?+n:n,s};_a.exports=ji});var oi=p((qw,Aa)=>{Aa.exports=s=>{let e=s.length-1,t=-1;for(;e>-1&&s.charAt(e)==="/";)t=e,e--;return t===-1?s:s.slice(0,t)}});var Is=p((Uw,Ia)=>{"use strict";Ia.exports=s=>class extends s{warn(e,t,i={}){this.file&&(i.file=this.file),this.cwd&&(i.cwd=this.cwd),i.code=t instanceof Error&&t.code||e,i.tarCode=e,!this.strict&&i.recoverable!==!1?(t instanceof Error&&(i=Object.assign(t,i),t=t.message),this.emit("warn",i.tarCode,t,i)):t instanceof Error?this.emit("error",Object.assign(t,i)):this.emit("error",Object.assign(new Error(`${e}: ${t}`),i))}}});var wn=p((Vw,La)=>{"use strict";var Ls=["|","<",">","?",":"],yn=Ls.map(s=>String.fromCharCode(61440+s.charCodeAt(0))),mu=new Map(Ls.map((s,e)=>[s,yn[e]])),pu=new Map(yn.map((s,e)=>[s,Ls[e]]));La.exports={encode:s=>Ls.reduce((e,t)=>e.split(t).join(mu.get(t)),s),decode:s=>yn.reduce((e,t)=>e.split(t).join(pu.get(t)),s)}});var vn=p((zw,Da)=>{var{isAbsolute:gu,parse:Ba}=require("path").win32;Da.exports=s=>{let e="",t=Ba(s);for(;gu(s)||t.root;){let i=s.charAt(0)==="/"&&s.slice(0,4)!=="//?/"?"/":t.root;s=s.slice(i.length),e+=i,t=Ba(s)}return[e,s]}});var Fa=p((Ww,ka)=>{"use strict";ka.exports=(s,e,t)=>(s&=4095,t&&(s=(s|384)&-19),e&&(s&256&&(s|=64),s&32&&(s|=8),s&4&&(s|=1)),s)});var Tn=p((Kw,Ja)=>{"use strict";var Va=bs(),za=As(),Wa=ni(),se=require("fs"),Ma=require("path"),ie=si(),yu=oi(),Ha=(s,e)=>e?(s=ie(s).replace(/^\.(\/|$)/,""),yu(e)+"/"+s):ie(s),wu=16*1024*1024,ja=Symbol("process"),$a=Symbol("file"),qa=Symbol("directory"),En=Symbol("symlink"),Ua=Symbol("hardlink"),$i=Symbol("header"),Bs=Symbol("read"),Sn=Symbol("lstat"),Ds=Symbol("onlstat"),Cn=Symbol("onread"),Nn=Symbol("onreadlink"),Rn=Symbol("openfile"),Pn=Symbol("onopenfile"),Ge=Symbol("close"),ks=Symbol("mode"),xn=Symbol("awaitDrain"),bn=Symbol("ondrain"),re=Symbol("prefix"),Ga=Symbol("hadError"),Ya=Is(),vu=wn(),Ka=vn(),Za=Fa(),Fs=Ya(class extends Va{constructor(e,t){if(t=t||{},super(t),typeof e!="string")throw new TypeError("path is required");this.path=ie(e),this.portable=!!t.portable,this.myuid=process.getuid&&process.getuid()||0,this.myuser=process.env.USER||"",this.maxReadSize=t.maxReadSize||wu,this.linkCache=t.linkCache||new Map,this.statCache=t.statCache||new Map,this.preservePaths=!!t.preservePaths,this.cwd=ie(t.cwd||process.cwd()),this.strict=!!t.strict,this.noPax=!!t.noPax,this.noMtime=!!t.noMtime,this.mtime=t.mtime||null,this.prefix=t.prefix?ie(t.prefix):null,this.fd=null,this.blockLen=null,this.blockRemain=null,this.buf=null,this.offset=null,this.length=null,this.pos=null,this.remain=null,typeof t.onwarn=="function"&&this.on("warn",t.onwarn);let i=!1;if(!this.preservePaths){let[r,n]=Ka(this.path);r&&(this.path=n,i=r)}this.win32=!!t.win32||process.platform==="win32",this.win32&&(this.path=vu.decode(this.path.replace(/\\/g,"/")),e=e.replace(/\\/g,"/")),this.absolute=ie(t.absolute||Ma.resolve(this.cwd,e)),this.path===""&&(this.path="./"),i&&this.warn("TAR_ENTRY_INFO",`stripping ${i} from absolute path`,{entry:this,path:i+this.path}),this.statCache.has(this.absolute)?this[Ds](this.statCache.get(this.absolute)):this[Sn]()}emit(e,...t){return e==="error"&&(this[Ga]=!0),super.emit(e,...t)}[Sn](){se.lstat(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[Ds](t)})}[Ds](e){this.statCache.set(this.absolute,e),this.stat=e,e.isFile()||(e.size=0),this.type=Eu(e),this.emit("stat",e),this[ja]()}[ja](){switch(this.type){case"File":return this[$a]();case"Directory":return this[qa]();case"SymbolicLink":return this[En]();default:return this.end()}}[ks](e){return Za(e,this.type==="Directory",this.portable)}[re](e){return Ha(e,this.prefix)}[$i](){this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.header=new Wa({path:this[re](this.path),linkpath:this.type==="Link"?this[re](this.linkpath):this.linkpath,mode:this[ks](this.stat.mode),uid:this.portable?null:this.stat.uid,gid:this.portable?null:this.stat.gid,size:this.stat.size,mtime:this.noMtime?null:this.mtime||this.stat.mtime,type:this.type,uname:this.portable?null:this.stat.uid===this.myuid?this.myuser:"",atime:this.portable?null:this.stat.atime,ctime:this.portable?null:this.stat.ctime}),this.header.encode()&&!this.noPax&&super.write(new za({atime:this.portable?null:this.header.atime,ctime:this.portable?null:this.header.ctime,gid:this.portable?null:this.header.gid,mtime:this.noMtime?null:this.mtime||this.header.mtime,path:this[re](this.path),linkpath:this.type==="Link"?this[re](this.linkpath):this.linkpath,size:this.header.size,uid:this.portable?null:this.header.uid,uname:this.portable?null:this.header.uname,dev:this.portable?null:this.stat.dev,ino:this.portable?null:this.stat.ino,nlink:this.portable?null:this.stat.nlink}).encode()),super.write(this.header.block)}[qa](){this.path.slice(-1)!=="/"&&(this.path+="/"),this.stat.size=0,this[$i](),this.end()}[En](){se.readlink(this.absolute,(e,t)=>{if(e)return this.emit("error",e);this[Nn](t)})}[Nn](e){this.linkpath=ie(e),this[$i](),this.end()}[Ua](e){this.type="Link",this.linkpath=ie(Ma.relative(this.cwd,e)),this.stat.size=0,this[$i](),this.end()}[$a](){if(this.stat.nlink>1){let e=this.stat.dev+":"+this.stat.ino;if(this.linkCache.has(e)){let t=this.linkCache.get(e);if(t.indexOf(this.cwd)===0)return this[Ua](t)}this.linkCache.set(e,this.absolute)}if(this[$i](),this.stat.size===0)return this.end();this[Rn]()}[Rn](){se.open(this.absolute,"r",(e,t)=>{if(e)return this.emit("error",e);this[Pn](t)})}[Pn](e){if(this.fd=e,this[Ga])return this[Ge]();this.blockLen=512*Math.ceil(this.stat.size/512),this.blockRemain=this.blockLen;let t=Math.min(this.blockLen,this.maxReadSize);this.buf=Buffer.allocUnsafe(t),this.offset=0,this.pos=0,this.remain=this.stat.size,this.length=this.buf.length,this[Bs]()}[Bs](){let{fd:e,buf:t,offset:i,length:r,pos:n}=this;se.read(e,t,i,r,n,(o,a)=>{if(o)return this[Ge](()=>this.emit("error",o));this[Cn](a)})}[Ge](e){se.close(this.fd,e)}[Cn](e){if(e<=0&&this.remain>0){let r=new Error("encountered unexpected EOF");return r.path=this.absolute,r.syscall="read",r.code="EOF",this[Ge](()=>this.emit("error",r))}if(e>this.remain){let r=new Error("did not encounter expected EOF");return r.path=this.absolute,r.syscall="read",r.code="EOF",this[Ge](()=>this.emit("error",r))}if(e===this.remain)for(let r=e;r<this.length&&e<this.blockRemain;r++)this.buf[r+this.offset]=0,e++,this.remain++;let t=this.offset===0&&e===this.buf.length?this.buf:this.buf.slice(this.offset,this.offset+e);this.write(t)?this[bn]():this[xn](()=>this[bn]())}[xn](e){this.once("drain",e)}write(e){if(this.blockRemain<e.length){let t=new Error("writing more data than expected");return t.path=this.absolute,this.emit("error",t)}return this.remain-=e.length,this.blockRemain-=e.length,this.pos+=e.length,this.offset+=e.length,super.write(e)}[bn](){if(!this.remain)return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),this[Ge](e=>e?this.emit("error",e):this.end());this.offset>=this.length&&(this.buf=Buffer.allocUnsafe(Math.min(this.blockRemain,this.buf.length)),this.offset=0),this.length=this.buf.length-this.offset,this[Bs]()}}),On=class extends Fs{[Sn](){this[Ds](se.lstatSync(this.absolute))}[En](){this[Nn](se.readlinkSync(this.absolute))}[Rn](){this[Pn](se.openSync(this.absolute,"r"))}[Bs](){let e=!0;try{let{fd:t,buf:i,offset:r,length:n,pos:o}=this,a=se.readSync(t,i,r,n,o);this[Cn](a),e=!1}finally{if(e)try{this[Ge](()=>{})}catch{}}}[xn](e){e()}[Ge](e){se.closeSync(this.fd),e()}},bu=Ya(class extends Va{constructor(e,t){t=t||{},super(t),this.preservePaths=!!t.preservePaths,this.portable=!!t.portable,this.strict=!!t.strict,this.noPax=!!t.noPax,this.noMtime=!!t.noMtime,this.readEntry=e,this.type=e.type,this.type==="Directory"&&this.portable&&(this.noMtime=!0),this.prefix=t.prefix||null,this.path=ie(e.path),this.mode=this[ks](e.mode),this.uid=this.portable?null:e.uid,this.gid=this.portable?null:e.gid,this.uname=this.portable?null:e.uname,this.gname=this.portable?null:e.gname,this.size=e.size,this.mtime=this.noMtime?null:t.mtime||e.mtime,this.atime=this.portable?null:e.atime,this.ctime=this.portable?null:e.ctime,this.linkpath=ie(e.linkpath),typeof t.onwarn=="function"&&this.on("warn",t.onwarn);let i=!1;if(!this.preservePaths){let[r,n]=Ka(this.path);r&&(this.path=n,i=r)}this.remain=e.size,this.blockRemain=e.startBlockSize,this.header=new Wa({path:this[re](this.path),linkpath:this.type==="Link"?this[re](this.linkpath):this.linkpath,mode:this.mode,uid:this.portable?null:this.uid,gid:this.portable?null:this.gid,size:this.size,mtime:this.noMtime?null:this.mtime,type:this.type,uname:this.portable?null:this.uname,atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime}),i&&this.warn("TAR_ENTRY_INFO",`stripping ${i} from absolute path`,{entry:this,path:i+this.path}),this.header.encode()&&!this.noPax&&super.write(new za({atime:this.portable?null:this.atime,ctime:this.portable?null:this.ctime,gid:this.portable?null:this.gid,mtime:this.noMtime?null:this.mtime,path:this[re](this.path),linkpath:this.type==="Link"?this[re](this.linkpath):this.linkpath,size:this.size,uid:this.portable?null:this.uid,uname:this.portable?null:this.uname,dev:this.portable?null:this.readEntry.dev,ino:this.portable?null:this.readEntry.ino,nlink:this.portable?null:this.readEntry.nlink}).encode()),super.write(this.header.block),e.pipe(this)}[re](e){return Ha(e,this.prefix)}[ks](e){return Za(e,this.type==="Directory",this.portable)}write(e){let t=e.length;if(t>this.blockRemain)throw new Error("writing more to entry than is appropriate");return this.blockRemain-=t,super.write(e)}end(){return this.blockRemain&&super.write(Buffer.alloc(this.blockRemain)),super.end()}});Fs.Sync=On;Fs.Tar=bu;var Eu=s=>s.isFile()?"File":s.isDirectory()?"Directory":s.isSymbolicLink()?"SymbolicLink":"Unsupported";Ja.exports=Fs});var Qa=p((Zw,Xa)=>{"use strict";Xa.exports=function(s){s.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}});var _n=p((Jw,eh)=>{"use strict";eh.exports=w;w.Node=qt;w.create=w;function w(s){var e=this;if(e instanceof w||(e=new w),e.tail=null,e.head=null,e.length=0,s&&typeof s.forEach=="function")s.forEach(function(r){e.push(r)});else if(arguments.length>0)for(var t=0,i=arguments.length;t<i;t++)e.push(arguments[t]);return e}w.prototype.removeNode=function(s){if(s.list!==this)throw new Error("removing node which does not belong to this list");var e=s.next,t=s.prev;return e&&(e.prev=t),t&&(t.next=e),s===this.head&&(this.head=e),s===this.tail&&(this.tail=t),s.list.length--,s.next=null,s.prev=null,s.list=null,e};w.prototype.unshiftNode=function(s){if(s!==this.head){s.list&&s.list.removeNode(s);var e=this.head;s.list=this,s.next=e,e&&(e.prev=s),this.head=s,this.tail||(this.tail=s),this.length++}};w.prototype.pushNode=function(s){if(s!==this.tail){s.list&&s.list.removeNode(s);var e=this.tail;s.list=this,s.prev=e,e&&(e.next=s),this.tail=s,this.head||(this.head=s),this.length++}};w.prototype.push=function(){for(var s=0,e=arguments.length;s<e;s++)Cu(this,arguments[s]);return this.length};w.prototype.unshift=function(){for(var s=0,e=arguments.length;s<e;s++)Nu(this,arguments[s]);return this.length};w.prototype.pop=function(){if(this.tail){var s=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,s}};w.prototype.shift=function(){if(this.head){var s=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,s}};w.prototype.forEach=function(s,e){e=e||this;for(var t=this.head,i=0;t!==null;i++)s.call(e,t.value,i,this),t=t.next};w.prototype.forEachReverse=function(s,e){e=e||this;for(var t=this.tail,i=this.length-1;t!==null;i--)s.call(e,t.value,i,this),t=t.prev};w.prototype.get=function(s){for(var e=0,t=this.head;t!==null&&e<s;e++)t=t.next;if(e===s&&t!==null)return t.value};w.prototype.getReverse=function(s){for(var e=0,t=this.tail;t!==null&&e<s;e++)t=t.prev;if(e===s&&t!==null)return t.value};w.prototype.map=function(s,e){e=e||this;for(var t=new w,i=this.head;i!==null;)t.push(s.call(e,i.value,this)),i=i.next;return t};w.prototype.mapReverse=function(s,e){e=e||this;for(var t=new w,i=this.tail;i!==null;)t.push(s.call(e,i.value,this)),i=i.prev;return t};w.prototype.reduce=function(s,e){var t,i=this.head;if(arguments.length>1)t=e;else if(this.head)i=this.head.next,t=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)t=s(t,i.value,r),i=i.next;return t};w.prototype.reduceReverse=function(s,e){var t,i=this.tail;if(arguments.length>1)t=e;else if(this.tail)i=this.tail.prev,t=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)t=s(t,i.value,r),i=i.prev;return t};w.prototype.toArray=function(){for(var s=new Array(this.length),e=0,t=this.head;t!==null;e++)s[e]=t.value,t=t.next;return s};w.prototype.toArrayReverse=function(){for(var s=new Array(this.length),e=0,t=this.tail;t!==null;e++)s[e]=t.value,t=t.prev;return s};w.prototype.slice=function(s,e){e=e||this.length,e<0&&(e+=this.length),s=s||0,s<0&&(s+=this.length);var t=new w;if(e<s||e<0)return t;s<0&&(s=0),e>this.length&&(e=this.length);for(var i=0,r=this.head;r!==null&&i<s;i++)r=r.next;for(;r!==null&&i<e;i++,r=r.next)t.push(r.value);return t};w.prototype.sliceReverse=function(s,e){e=e||this.length,e<0&&(e+=this.length),s=s||0,s<0&&(s+=this.length);var t=new w;if(e<s||e<0)return t;s<0&&(s=0),e>this.length&&(e=this.length);for(var i=this.length,r=this.tail;r!==null&&i>e;i--)r=r.prev;for(;r!==null&&i>s;i--,r=r.prev)t.push(r.value);return t};w.prototype.splice=function(s,e,...t){s>this.length&&(s=this.length-1),s<0&&(s=this.length+s);for(var i=0,r=this.head;r!==null&&i<s;i++)r=r.next;for(var n=[],i=0;r&&i<e;i++)n.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<t.length;i++)r=Su(this,r,t[i]);return n};w.prototype.reverse=function(){for(var s=this.head,e=this.tail,t=s;t!==null;t=t.prev){var i=t.prev;t.prev=t.next,t.next=i}return this.head=e,this.tail=s,this};function Su(s,e,t){var i=e===s.head?new qt(t,null,e,s):new qt(t,e,e.next,s);return i.next===null&&(s.tail=i),i.prev===null&&(s.head=i),s.length++,i}function Cu(s,e){s.tail=new qt(e,s.tail,null,s),s.head||(s.head=s.tail),s.length++}function Nu(s,e){s.head=new qt(e,null,s.head,s),s.tail||(s.tail=s.head),s.length++}function qt(s,e,t,i){if(!(this instanceof qt))return new qt(s,e,t,i);this.list=i,this.value=s,e?(e.next=this,this.prev=e):this.prev=null,t?(t.prev=this,this.next=t):this.next=null}try{Qa()(w)}catch{}});var Ws=p((Qw,ah)=>{"use strict";var Vs=class{constructor(e,t){this.path=e||"./",this.absolute=t,this.entry=null,this.stat=null,this.readdir=null,this.pending=!1,this.ignore=!1,this.piped=!1}},Ru=bs(),Pu=hn(),xu=Ts(),jn=Tn(),Ou=jn.Sync,Tu=jn.Tar,_u=_n(),th=Buffer.alloc(1024),$s=Symbol("onStat"),Ms=Symbol("ended"),ne=Symbol("queue"),ai=Symbol("current"),Ut=Symbol("process"),js=Symbol("processing"),ih=Symbol("processJob"),oe=Symbol("jobs"),An=Symbol("jobDone"),qs=Symbol("addFSEntry"),sh=Symbol("addTarEntry"),Dn=Symbol("stat"),kn=Symbol("readdir"),Us=Symbol("onreaddir"),Gs=Symbol("pipe"),rh=Symbol("entry"),In=Symbol("entryOpt"),Fn=Symbol("writeEntryClass"),oh=Symbol("write"),Ln=Symbol("ondrain"),zs=require("fs"),nh=require("path"),Au=Is(),Bn=si(),$n=Au(class extends Ru{constructor(e){super(e),e=e||Object.create(null),this.opt=e,this.file=e.file||"",this.cwd=e.cwd||process.cwd(),this.maxReadSize=e.maxReadSize,this.preservePaths=!!e.preservePaths,this.strict=!!e.strict,this.noPax=!!e.noPax,this.prefix=Bn(e.prefix||""),this.linkCache=e.linkCache||new Map,this.statCache=e.statCache||new Map,this.readdirCache=e.readdirCache||new Map,this[Fn]=jn,typeof e.onwarn=="function"&&this.on("warn",e.onwarn),this.portable=!!e.portable,this.zip=null,e.gzip?(typeof e.gzip!="object"&&(e.gzip={}),this.portable&&(e.gzip.portable=!0),this.zip=new Pu.Gzip(e.gzip),this.zip.on("data",t=>super.write(t)),this.zip.on("end",t=>super.end()),this.zip.on("drain",t=>this[Ln]()),this.on("resume",t=>this.zip.resume())):this.on("drain",this[Ln]),this.noDirRecurse=!!e.noDirRecurse,this.follow=!!e.follow,this.noMtime=!!e.noMtime,this.mtime=e.mtime||null,this.filter=typeof e.filter=="function"?e.filter:t=>!0,this[ne]=new _u,this[oe]=0,this.jobs=+e.jobs||4,this[js]=!1,this[Ms]=!1}[oh](e){return super.write(e)}add(e){return this.write(e),this}end(e){return e&&this.write(e),this[Ms]=!0,this[Ut](),this}write(e){if(this[Ms])throw new Error("write after end");return e instanceof xu?this[sh](e):this[qs](e),this.flowing}[sh](e){let t=Bn(nh.resolve(this.cwd,e.path));if(!this.filter(e.path,e))e.resume();else{let i=new Vs(e.path,t,!1);i.entry=new Tu(e,this[In](i)),i.entry.on("end",r=>this[An](i)),this[oe]+=1,this[ne].push(i)}this[Ut]()}[qs](e){let t=Bn(nh.resolve(this.cwd,e));this[ne].push(new Vs(e,t)),this[Ut]()}[Dn](e){e.pending=!0,this[oe]+=1;let t=this.follow?"stat":"lstat";zs[t](e.absolute,(i,r)=>{e.pending=!1,this[oe]-=1,i?this.emit("error",i):this[$s](e,r)})}[$s](e,t){this.statCache.set(e.absolute,t),e.stat=t,this.filter(e.path,t)||(e.ignore=!0),this[Ut]()}[kn](e){e.pending=!0,this[oe]+=1,zs.readdir(e.absolute,(t,i)=>{if(e.pending=!1,this[oe]-=1,t)return this.emit("error",t);this[Us](e,i)})}[Us](e,t){this.readdirCache.set(e.absolute,t),e.readdir=t,this[Ut]()}[Ut](){if(!this[js]){this[js]=!0;for(let e=this[ne].head;e!==null&&this[oe]<this.jobs;e=e.next)if(this[ih](e.value),e.value.ignore){let t=e.next;this[ne].removeNode(e),e.next=t}this[js]=!1,this[Ms]&&!this[ne].length&&this[oe]===0&&(this.zip?this.zip.end(th):(super.write(th),super.end()))}}get[ai](){return this[ne]&&this[ne].head&&this[ne].head.value}[An](e){this[ne].shift(),this[oe]-=1,this[Ut]()}[ih](e){if(!e.pending){if(e.entry){e===this[ai]&&!e.piped&&this[Gs](e);return}if(e.stat||(this.statCache.has(e.absolute)?this[$s](e,this.statCache.get(e.absolute)):this[Dn](e)),!!e.stat&&!e.ignore&&!(!this.noDirRecurse&&e.stat.isDirectory()&&!e.readdir&&(this.readdirCache.has(e.absolute)?this[Us](e,this.readdirCache.get(e.absolute)):this[kn](e),!e.readdir))){if(e.entry=this[rh](e),!e.entry){e.ignore=!0;return}e===this[ai]&&!e.piped&&this[Gs](e)}}}[In](e){return{onwarn:(t,i,r)=>this.warn(t,i,r),noPax:this.noPax,cwd:this.cwd,absolute:e.absolute,preservePaths:this.preservePaths,maxReadSize:this.maxReadSize,strict:this.strict,portable:this.portable,linkCache:this.linkCache,statCache:this.statCache,noMtime:this.noMtime,mtime:this.mtime,prefix:this.prefix}}[rh](e){this[oe]+=1;try{return new this[Fn](e.path,this[In](e)).on("end",()=>this[An](e)).on("error",t=>this.emit("error",t))}catch(t){this.emit("error",t)}}[Ln](){this[ai]&&this[ai].entry&&this[ai].entry.resume()}[Gs](e){e.piped=!0,e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[qs](o+r)});let t=e.entry,i=this.zip;i?t.on("data",r=>{i.write(r)||t.pause()}):t.on("data",r=>{super.write(r)||t.pause()})}pause(){return this.zip&&this.zip.pause(),super.pause()}}),Mn=class extends $n{constructor(e){super(e),this[Fn]=Ou}pause(){}resume(){}[Dn](e){let t=this.follow?"statSync":"lstatSync";this[$s](e,zs[t](e.absolute))}[kn](e,t){this[Us](e,zs.readdirSync(e.absolute))}[Gs](e){let t=e.entry,i=this.zip;e.readdir&&e.readdir.forEach(r=>{let n=e.path,o=n==="./"?"":n.replace(/\/*$/,"/");this[qs](o+r)}),i?t.on("data",r=>{i.write(r)}):t.on("data",r=>{super[oh](r)})}};$n.Sync=Mn;ah.exports=$n});var yh=p((ev,gh)=>{"use strict";var hh=typeof process=="object"&&process?process:{stdout:null,stderr:null},Iu=require("events"),lh=require("stream"),ch=require("string_decoder").StringDecoder,Ne=Symbol("EOF"),Re=Symbol("maybeEmitEnd"),Ve=Symbol("emittedEnd"),Hs=Symbol("emittingEnd"),qi=Symbol("emittedError"),Ys=Symbol("closed"),uh=Symbol("read"),Ks=Symbol("flush"),dh=Symbol("flushChunk"),$=Symbol("encoding"),Pe=Symbol("decoder"),Zs=Symbol("flowing"),Ui=Symbol("paused"),hi=Symbol("resume"),_=Symbol("bufferLength"),qn=Symbol("bufferPush"),Un=Symbol("bufferShift"),D=Symbol("objectMode"),k=Symbol("destroyed"),Gn=Symbol("emitData"),fh=Symbol("emitEnd"),Vn=Symbol("emitEnd2"),xe=Symbol("async"),Gi=s=>Promise.resolve().then(s),mh=global._MP_NO_ITERATOR_SYMBOLS_!=="1",Lu=mh&&Symbol.asyncIterator||Symbol("asyncIterator not implemented"),Bu=mh&&Symbol.iterator||Symbol("iterator not implemented"),Du=s=>s==="end"||s==="finish"||s==="prefinish",ku=s=>s instanceof ArrayBuffer||typeof s=="object"&&s.constructor&&s.constructor.name==="ArrayBuffer"&&s.byteLength>=0,Fu=s=>!Buffer.isBuffer(s)&&ArrayBuffer.isView(s),Js=class{constructor(e,t,i){this.src=e,this.dest=t,this.opts=i,this.ondrain=()=>e[hi](),t.on("drain",this.ondrain)}unpipe(){this.dest.removeListener("drain",this.ondrain)}proxyErrors(){}end(){this.unpipe(),this.opts.end&&this.dest.end()}},zn=class extends Js{unpipe(){this.src.removeListener("error",this.proxyErrors),super.unpipe()}constructor(e,t,i){super(e,t,i),this.proxyErrors=r=>t.emit("error",r),e.on("error",this.proxyErrors)}};gh.exports=class ph extends lh{constructor(e){super(),this[Zs]=!1,this[Ui]=!1,this.pipes=[],this.buffer=[],this[D]=e&&e.objectMode||!1,this[D]?this[$]=null:this[$]=e&&e.encoding||null,this[$]==="buffer"&&(this[$]=null),this[xe]=e&&!!e.async||!1,this[Pe]=this[$]?new ch(this[$]):null,this[Ne]=!1,this[Ve]=!1,this[Hs]=!1,this[Ys]=!1,this[qi]=null,this.writable=!0,this.readable=!0,this[_]=0,this[k]=!1}get bufferLength(){return this[_]}get encoding(){return this[$]}set encoding(e){if(this[D])throw new Error("cannot set encoding in objectMode");if(this[$]&&e!==this[$]&&(this[Pe]&&this[Pe].lastNeed||this[_]))throw new Error("cannot change encoding");this[$]!==e&&(this[Pe]=e?new ch(e):null,this.buffer.length&&(this.buffer=this.buffer.map(t=>this[Pe].write(t)))),this[$]=e}setEncoding(e){this.encoding=e}get objectMode(){return this[D]}set objectMode(e){this[D]=this[D]||!!e}get async(){return this[xe]}set async(e){this[xe]=this[xe]||!!e}write(e,t,i){if(this[Ne])throw new Error("write after end");if(this[k])return this.emit("error",Object.assign(new Error("Cannot call write after a stream was destroyed"),{code:"ERR_STREAM_DESTROYED"})),!0;typeof t=="function"&&(i=t,t="utf8"),t||(t="utf8");let r=this[xe]?Gi:n=>n();return!this[D]&&!Buffer.isBuffer(e)&&(Fu(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):ku(e)?e=Buffer.from(e):typeof e!="string"&&(this.objectMode=!0)),this[D]?(this.flowing&&this[_]!==0&&this[Ks](!0),this.flowing?this.emit("data",e):this[qn](e),this[_]!==0&&this.emit("readable"),i&&r(i),this.flowing):e.length?(typeof e=="string"&&!(t===this[$]&&!this[Pe].lastNeed)&&(e=Buffer.from(e,t)),Buffer.isBuffer(e)&&this[$]&&(e=this[Pe].write(e)),this.flowing&&this[_]!==0&&this[Ks](!0),this.flowing?this.emit("data",e):this[qn](e),this[_]!==0&&this.emit("readable"),i&&r(i),this.flowing):(this[_]!==0&&this.emit("readable"),i&&r(i),this.flowing)}read(e){if(this[k])return null;if(this[_]===0||e===0||e>this[_])return this[Re](),null;this[D]&&(e=null),this.buffer.length>1&&!this[D]&&(this.encoding?this.buffer=[this.buffer.join("")]:this.buffer=[Buffer.concat(this.buffer,this[_])]);let t=this[uh](e||null,this.buffer[0]);return this[Re](),t}[uh](e,t){return e===t.length||e===null?this[Un]():(this.buffer[0]=t.slice(e),t=t.slice(0,e),this[_]-=e),this.emit("data",t),!this.buffer.length&&!this[Ne]&&this.emit("drain"),t}end(e,t,i){return typeof e=="function"&&(i=e,e=null),typeof t=="function"&&(i=t,t="utf8"),e&&this.write(e,t),i&&this.once("end",i),this[Ne]=!0,this.writable=!1,(this.flowing||!this[Ui])&&this[Re](),this}[hi](){this[k]||(this[Ui]=!1,this[Zs]=!0,this.emit("resume"),this.buffer.length?this[Ks]():this[Ne]?this[Re]():this.emit("drain"))}resume(){return this[hi]()}pause(){this[Zs]=!1,this[Ui]=!0}get destroyed(){return this[k]}get flowing(){return this[Zs]}get paused(){return this[Ui]}[qn](e){this[D]?this[_]+=1:this[_]+=e.length,this.buffer.push(e)}[Un](){return this.buffer.length&&(this[D]?this[_]-=1:this[_]-=this.buffer[0].length),this.buffer.shift()}[Ks](e){do;while(this[dh](this[Un]()));!e&&!this.buffer.length&&!this[Ne]&&this.emit("drain")}[dh](e){return e?(this.emit("data",e),this.flowing):!1}pipe(e,t){if(this[k])return;let i=this[Ve];return t=t||{},e===hh.stdout||e===hh.stderr?t.end=!1:t.end=t.end!==!1,t.proxyErrors=!!t.proxyErrors,i?t.end&&e.end():(this.pipes.push(t.proxyErrors?new zn(this,e,t):new Js(this,e,t)),this[xe]?Gi(()=>this[hi]()):this[hi]()),e}unpipe(e){let t=this.pipes.find(i=>i.dest===e);t&&(this.pipes.splice(this.pipes.indexOf(t),1),t.unpipe())}addListener(e,t){return this.on(e,t)}on(e,t){let i=super.on(e,t);return e==="data"&&!this.pipes.length&&!this.flowing?this[hi]():e==="readable"&&this[_]!==0?super.emit("readable"):Du(e)&&this[Ve]?(super.emit(e),this.removeAllListeners(e)):e==="error"&&this[qi]&&(this[xe]?Gi(()=>t.call(this,this[qi])):t.call(this,this[qi])),i}get emittedEnd(){return this[Ve]}[Re](){!this[Hs]&&!this[Ve]&&!this[k]&&this.buffer.length===0&&this[Ne]&&(this[Hs]=!0,this.emit("end"),this.emit("prefinish"),this.emit("finish"),this[Ys]&&this.emit("close"),this[Hs]=!1)}emit(e,t,...i){if(e!=="error"&&e!=="close"&&e!==k&&this[k])return;if(e==="data")return t?this[xe]?Gi(()=>this[Gn](t)):this[Gn](t):!1;if(e==="end")return this[fh]();if(e==="close"){if(this[Ys]=!0,!this[Ve]&&!this[k])return;let n=super.emit("close");return this.removeAllListeners("close"),n}else if(e==="error"){this[qi]=t;let n=super.emit("error",t);return this[Re](),n}else if(e==="resume"){let n=super.emit("resume");return this[Re](),n}else if(e==="finish"||e==="prefinish"){let n=super.emit(e);return this.removeAllListeners(e),n}let r=super.emit(e,t,...i);return this[Re](),r}[Gn](e){for(let i of this.pipes)i.dest.write(e)===!1&&this.pause();let t=super.emit("data",e);return this[Re](),t}[fh](){this[Ve]||(this[Ve]=!0,this.readable=!1,this[xe]?Gi(()=>this[Vn]()):this[Vn]())}[Vn](){if(this[Pe]){let t=this[Pe].end();if(t){for(let i of this.pipes)i.dest.write(t);super.emit("data",t)}}for(let t of this.pipes)t.end();let e=super.emit("end");return this.removeAllListeners("end"),e}collect(){let e=[];this[D]||(e.dataLength=0);let t=this.promise();return this.on("data",i=>{e.push(i),this[D]||(e.dataLength+=i.length)}),t.then(()=>e)}concat(){return this[D]?Promise.reject(new Error("cannot concat in objectMode")):this.collect().then(e=>this[D]?Promise.reject(new Error("cannot concat in objectMode")):this[$]?e.join(""):Buffer.concat(e,e.dataLength))}promise(){return new Promise((e,t)=>{this.on(k,()=>t(new Error("stream destroyed"))),this.on("error",i=>t(i)),this.on("end",()=>e())})}[Lu](){return{next:()=>{let t=this.read();if(t!==null)return Promise.resolve({done:!1,value:t});if(this[Ne])return Promise.resolve({done:!0});let i=null,r=null,n=h=>{this.removeListener("data",o),this.removeListener("end",a),r(h)},o=h=>{this.removeListener("error",n),this.removeListener("end",a),this.pause(),i({value:h,done:!!this[Ne]})},a=()=>{this.removeListener("error",n),this.removeListener("data",o),i({done:!0})},l=()=>n(new Error("stream destroyed"));return new Promise((h,u)=>{r=u,i=h,this.once(k,l),this.once("error",n),this.once("end",a),this.once("data",o)})}}}[Bu](){return{next:()=>{let t=this.read();return{value:t,done:t===null}}}}destroy(e){return this[k]?(e?this.emit("error",e):this.emit(k),this):(this[k]=!0,this.buffer.length=0,this[_]=0,typeof this.close=="function"&&!this[Ys]&&this.close(),e?this.emit("error",e):this.emit(k),this)}static isStream(e){return!!e&&(e instanceof ph||e instanceof lh||e instanceof Iu&&(typeof e.pipe=="function"||typeof e.write=="function"&&typeof e.end=="function"))}}});var gi=p(zi=>{"use strict";var Mu=yh(),ju=require("events").EventEmitter,q=require("fs"),Yn=q.writev;if(!Yn){let s=process.binding("fs"),e=s.FSReqWrap||s.FSReqCallback;Yn=(t,i,r,n)=>{let o=(l,h)=>n(l,h,i),a=new e;a.oncomplete=o,s.writeBuffers(t,i,r,a)}}var mi=Symbol("_autoClose"),X=Symbol("_close"),Vi=Symbol("_ended"),b=Symbol("_fd"),wh=Symbol("_finished"),We=Symbol("_flags"),Wn=Symbol("_flush"),Kn=Symbol("_handleChunk"),Zn=Symbol("_makeBuf"),ir=Symbol("_mode"),Xs=Symbol("_needDrain"),di=Symbol("_onerror"),pi=Symbol("_onopen"),Hn=Symbol("_onread"),ci=Symbol("_onwrite"),He=Symbol("_open"),Oe=Symbol("_path"),Gt=Symbol("_pos"),ae=Symbol("_queue"),ui=Symbol("_read"),vh=Symbol("_readSize"),ze=Symbol("_reading"),Qs=Symbol("_remain"),bh=Symbol("_size"),er=Symbol("_write"),li=Symbol("_writing"),tr=Symbol("_defaultFlag"),fi=Symbol("_errored"),sr=class extends Mu{constructor(e,t){if(t=t||{},super(t),this.readable=!0,this.writable=!1,typeof e!="string")throw new TypeError("path must be a string");this[fi]=!1,this[b]=typeof t.fd=="number"?t.fd:null,this[Oe]=e,this[vh]=t.readSize||16*1024*1024,this[ze]=!1,this[bh]=typeof t.size=="number"?t.size:1/0,this[Qs]=this[bh],this[mi]=typeof t.autoClose=="boolean"?t.autoClose:!0,typeof this[b]=="number"?this[ui]():this[He]()}get fd(){return this[b]}get path(){return this[Oe]}write(){throw new TypeError("this is a readable stream")}end(){throw new TypeError("this is a readable stream")}[He](){q.open(this[Oe],"r",(e,t)=>this[pi](e,t))}[pi](e,t){e?this[di](e):(this[b]=t,this.emit("open",t),this[ui]())}[Zn](){return Buffer.allocUnsafe(Math.min(this[vh],this[Qs]))}[ui](){if(!this[ze]){this[ze]=!0;let e=this[Zn]();if(e.length===0)return process.nextTick(()=>this[Hn](null,0,e));q.read(this[b],e,0,e.length,null,(t,i,r)=>this[Hn](t,i,r))}}[Hn](e,t,i){this[ze]=!1,e?this[di](e):this[Kn](t,i)&&this[ui]()}[X](){if(this[mi]&&typeof this[b]=="number"){let e=this[b];this[b]=null,q.close(e,t=>t?this.emit("error",t):this.emit("close"))}}[di](e){this[ze]=!0,this[X](),this.emit("error",e)}[Kn](e,t){let i=!1;return this[Qs]-=e,e>0&&(i=super.write(e<t.length?t.slice(0,e):t)),(e===0||this[Qs]<=0)&&(i=!1,this[X](),super.end()),i}emit(e,t){switch(e){case"prefinish":case"finish":break;case"drain":typeof this[b]=="number"&&this[ui]();break;case"error":return this[fi]?void 0:(this[fi]=!0,super.emit(e,t));default:return super.emit(e,t)}}},Jn=class extends sr{[He](){let e=!0;try{this[pi](null,q.openSync(this[Oe],"r")),e=!1}finally{e&&this[X]()}}[ui](){let e=!0;try{if(!this[ze]){this[ze]=!0;do{let t=this[Zn](),i=t.length===0?0:q.readSync(this[b],t,0,t.length,null);if(!this[Kn](i,t))break}while(!0);this[ze]=!1}e=!1}finally{e&&this[X]()}}[X](){if(this[mi]&&typeof this[b]=="number"){let e=this[b];this[b]=null,q.closeSync(e),this.emit("close")}}},rr=class extends ju{constructor(e,t){t=t||{},super(t),this.readable=!1,this.writable=!0,this[fi]=!1,this[li]=!1,this[Vi]=!1,this[Xs]=!1,this[ae]=[],this[Oe]=e,this[b]=typeof t.fd=="number"?t.fd:null,this[ir]=t.mode===void 0?438:t.mode,this[Gt]=typeof t.start=="number"?t.start:null,this[mi]=typeof t.autoClose=="boolean"?t.autoClose:!0;let i=this[Gt]!==null?"r+":"w";this[tr]=t.flags===void 0,this[We]=this[tr]?i:t.flags,this[b]===null&&this[He]()}emit(e,t){if(e==="error"){if(this[fi])return;this[fi]=!0}return super.emit(e,t)}get fd(){return this[b]}get path(){return this[Oe]}[di](e){this[X](),this[li]=!0,this.emit("error",e)}[He](){q.open(this[Oe],this[We],this[ir],(e,t)=>this[pi](e,t))}[pi](e,t){this[tr]&&this[We]==="r+"&&e&&e.code==="ENOENT"?(this[We]="w",this[He]()):e?this[di](e):(this[b]=t,this.emit("open",t),this[Wn]())}end(e,t){return e&&this.write(e,t),this[Vi]=!0,!this[li]&&!this[ae].length&&typeof this[b]=="number"&&this[ci](null,0),this}write(e,t){return typeof e=="string"&&(e=Buffer.from(e,t)),this[Vi]?(this.emit("error",new Error("write() after end()")),!1):this[b]===null||this[li]||this[ae].length?(this[ae].push(e),this[Xs]=!0,!1):(this[li]=!0,this[er](e),!0)}[er](e){q.write(this[b],e,0,e.length,this[Gt],(t,i)=>this[ci](t,i))}[ci](e,t){e?this[di](e):(this[Gt]!==null&&(this[Gt]+=t),this[ae].length?this[Wn]():(this[li]=!1,this[Vi]&&!this[wh]?(this[wh]=!0,this[X](),this.emit("finish")):this[Xs]&&(this[Xs]=!1,this.emit("drain"))))}[Wn](){if(this[ae].length===0)this[Vi]&&this[ci](null,0);else if(this[ae].length===1)this[er](this[ae].pop());else{let e=this[ae];this[ae]=[],Yn(this[b],e,this[Gt],(t,i)=>this[ci](t,i))}}[X](){if(this[mi]&&typeof this[b]=="number"){let e=this[b];this[b]=null,q.close(e,t=>t?this.emit("error",t):this.emit("close"))}}},Xn=class extends rr{[He](){let e;if(this[tr]&&this[We]==="r+")try{e=q.openSync(this[Oe],this[We],this[ir])}catch(t){if(t.code==="ENOENT")return this[We]="w",this[He]();throw t}else e=q.openSync(this[Oe],this[We],this[ir]);this[pi](null,e)}[X](){if(this[mi]&&typeof this[b]=="number"){let e=this[b];this[b]=null,q.closeSync(e),this.emit("close")}}[er](e){let t=!0;try{this[ci](null,q.writeSync(this[b],e,0,e.length,this[Gt])),t=!1}finally{if(t)try{this[X]()}catch{}}}};zi.ReadStream=sr;zi.ReadStreamSync=Jn;zi.WriteStream=rr;zi.WriteStreamSync=Xn});var ur=p((sv,Oh)=>{"use strict";var $u=Is(),qu=ni(),Uu=require("events"),Gu=_n(),Vu=1024*1024,zu=Ts(),Eh=As(),Wu=hn(),{nextTick:Hu}=require("process"),Qn=Buffer.from([31,139]),H=Symbol("state"),Vt=Symbol("writeEntry"),Te=Symbol("readEntry"),eo=Symbol("nextEntry"),Sh=Symbol("processEntry"),Y=Symbol("extendedHeader"),Wi=Symbol("globalExtendedHeader"),Ye=Symbol("meta"),Ch=Symbol("emitMeta"),S=Symbol("buffer"),_e=Symbol("queue"),zt=Symbol("ended"),Nh=Symbol("emittedEnd"),Wt=Symbol("emit"),U=Symbol("unzip"),nr=Symbol("consumeChunk"),or=Symbol("consumeChunkSub"),to=Symbol("consumeBody"),Rh=Symbol("consumeMeta"),Ph=Symbol("consumeHeader"),ar=Symbol("consuming"),io=Symbol("bufferConcat"),so=Symbol("maybeEnd"),Hi=Symbol("writing"),Ke=Symbol("aborted"),hr=Symbol("onDone"),Ht=Symbol("sawValidEntry"),lr=Symbol("sawNullBlock"),cr=Symbol("sawEOF"),xh=Symbol("closeStream"),Yu=s=>!0;Oh.exports=$u(class extends Uu{constructor(e){e=e||{},super(e),this.file=e.file||"",this[Ht]=null,this.on(hr,t=>{(this[H]==="begin"||this[Ht]===!1)&&this.warn("TAR_BAD_ARCHIVE","Unrecognized archive format")}),e.ondone?this.on(hr,e.ondone):this.on(hr,t=>{this.emit("prefinish"),this.emit("finish"),this.emit("end")}),this.strict=!!e.strict,this.maxMetaEntrySize=e.maxMetaEntrySize||Vu,this.filter=typeof e.filter=="function"?e.filter:Yu,this.writable=!0,this.readable=!1,this[_e]=new Gu,this[S]=null,this[Te]=null,this[Vt]=null,this[H]="begin",this[Ye]="",this[Y]=null,this[Wi]=null,this[zt]=!1,this[U]=null,this[Ke]=!1,this[lr]=!1,this[cr]=!1,this.on("end",()=>this[xh]()),typeof e.onwarn=="function"&&this.on("warn",e.onwarn),typeof e.onentry=="function"&&this.on("entry",e.onentry)}[Ph](e,t){this[Ht]===null&&(this[Ht]=!1);let i;try{i=new qu(e,t,this[Y],this[Wi])}catch(r){return this.warn("TAR_ENTRY_INVALID",r)}if(i.nullBlock)this[lr]?(this[cr]=!0,this[H]==="begin"&&(this[H]="header"),this[Wt]("eof")):(this[lr]=!0,this[Wt]("nullBlock"));else if(this[lr]=!1,!i.cksumValid)this.warn("TAR_ENTRY_INVALID","checksum failure",{header:i});else if(!i.path)this.warn("TAR_ENTRY_INVALID","path is required",{header:i});else{let r=i.type;if(/^(Symbolic)?Link$/.test(r)&&!i.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath required",{header:i});else if(!/^(Symbolic)?Link$/.test(r)&&i.linkpath)this.warn("TAR_ENTRY_INVALID","linkpath forbidden",{header:i});else{let n=this[Vt]=new zu(i,this[Y],this[Wi]);if(!this[Ht])if(n.remain){let o=()=>{n.invalid||(this[Ht]=!0)};n.on("end",o)}else this[Ht]=!0;n.meta?n.size>this.maxMetaEntrySize?(n.ignore=!0,this[Wt]("ignoredEntry",n),this[H]="ignore",n.resume()):n.size>0&&(this[Ye]="",n.on("data",o=>this[Ye]+=o),this[H]="meta"):(this[Y]=null,n.ignore=n.ignore||!this.filter(n.path,n),n.ignore?(this[Wt]("ignoredEntry",n),this[H]=n.remain?"ignore":"header",n.resume()):(n.remain?this[H]="body":(this[H]="header",n.end()),this[Te]?this[_e].push(n):(this[_e].push(n),this[eo]())))}}}[xh](){Hu(()=>this.emit("close"))}[Sh](e){let t=!0;return e?Array.isArray(e)?this.emit.apply(this,e):(this[Te]=e,this.emit("entry",e),e.emittedEnd||(e.on("end",i=>this[eo]()),t=!1)):(this[Te]=null,t=!1),t}[eo](){do;while(this[Sh](this[_e].shift()));if(!this[_e].length){let e=this[Te];!e||e.flowing||e.size===e.remain?this[Hi]||this.emit("drain"):e.once("drain",i=>this.emit("drain"))}}[to](e,t){let i=this[Vt],r=i.blockRemain,n=r>=e.length&&t===0?e:e.slice(t,t+r);return i.write(n),i.blockRemain||(this[H]="header",this[Vt]=null,i.end()),n.length}[Rh](e,t){let i=this[Vt],r=this[to](e,t);return this[Vt]||this[Ch](i),r}[Wt](e,t,i){!this[_e].length&&!this[Te]?this.emit(e,t,i):this[_e].push([e,t,i])}[Ch](e){switch(this[Wt]("meta",this[Ye]),e.type){case"ExtendedHeader":case"OldExtendedHeader":this[Y]=Eh.parse(this[Ye],this[Y],!1);break;case"GlobalExtendedHeader":this[Wi]=Eh.parse(this[Ye],this[Wi],!0);break;case"NextFileHasLongPath":case"OldGnuLongPath":this[Y]=this[Y]||Object.create(null),this[Y].path=this[Ye].replace(/\0.*/,"");break;case"NextFileHasLongLinkpath":this[Y]=this[Y]||Object.create(null),this[Y].linkpath=this[Ye].replace(/\0.*/,"");break;default:throw new Error("unknown meta: "+e.type)}}abort(e){this[Ke]=!0,this.emit("abort",e),this.warn("TAR_ABORT",e,{recoverable:!1})}write(e){if(this[Ke])return;if(this[U]===null&&e){if(this[S]&&(e=Buffer.concat([this[S],e]),this[S]=null),e.length<Qn.length)return this[S]=e,!0;for(let i=0;this[U]===null&&i<Qn.length;i++)e[i]!==Qn[i]&&(this[U]=!1);if(this[U]===null){let i=this[zt];this[zt]=!1,this[U]=new Wu.Unzip,this[U].on("data",n=>this[nr](n)),this[U].on("error",n=>this.abort(n)),this[U].on("end",n=>{this[zt]=!0,this[nr]()}),this[Hi]=!0;let r=this[U][i?"end":"write"](e);return this[Hi]=!1,r}}this[Hi]=!0,this[U]?this[U].write(e):this[nr](e),this[Hi]=!1;let t=this[_e].length?!1:this[Te]?this[Te].flowing:!0;return!t&&!this[_e].length&&this[Te].once("drain",i=>this.emit("drain")),t}[io](e){e&&!this[Ke]&&(this[S]=this[S]?Buffer.concat([this[S],e]):e)}[so](){if(this[zt]&&!this[Nh]&&!this[Ke]&&!this[ar]){this[Nh]=!0;let e=this[Vt];if(e&&e.blockRemain){let t=this[S]?this[S].length:0;this.warn("TAR_BAD_ARCHIVE",`Truncated input (needed ${e.blockRemain} more bytes, only ${t} available)`,{entry:e}),this[S]&&e.write(this[S]),e.end()}this[Wt](hr)}}[nr](e){if(this[ar])this[io](e);else if(!e&&!this[S])this[so]();else{if(this[ar]=!0,this[S]){this[io](e);let t=this[S];this[S]=null,this[or](t)}else this[or](e);for(;this[S]&&this[S].length>=512&&!this[Ke]&&!this[cr];){let t=this[S];this[S]=null,this[or](t)}this[ar]=!1}(!this[S]||this[zt])&&this[so]()}[or](e){let t=0,i=e.length;for(;t+512<=i&&!this[Ke]&&!this[cr];)switch(this[H]){case"begin":case"header":this[Ph](e,t),t+=512;break;case"ignore":case"body":t+=this[to](e,t);break;case"meta":t+=this[Rh](e,t);break;default:throw new Error("invalid state: "+this[H])}t<i&&(this[S]?this[S]=Buffer.concat([e.slice(t),this[S]]):this[S]=e.slice(t))}end(e){this[Ke]||(this[U]?this[U].end(e):(this[zt]=!0,this.write(e)))}})});var dr=p((rv,Ih)=>{"use strict";var Ku=Xt(),_h=ur(),yi=require("fs"),Zu=gi(),Th=require("path"),ro=oi();Ih.exports=(s,e,t)=>{typeof s=="function"?(t=s,e=null,s={}):Array.isArray(s)&&(e=s,s={}),typeof e=="function"&&(t=e,e=null),e?e=Array.from(e):e=[];let i=Ku(s);if(i.sync&&typeof t=="function")throw new TypeError("callback not supported for sync tar functions");if(!i.file&&typeof t=="function")throw new TypeError("callback only supported with file option");return e.length&&Xu(i,e),i.noResume||Ju(i),i.file&&i.sync?Qu(i):i.file?ed(i,t):Ah(i)};var Ju=s=>{let e=s.onentry;s.onentry=e?t=>{e(t),t.resume()}:t=>t.resume()},Xu=(s,e)=>{let t=new Map(e.map(n=>[ro(n),!0])),i=s.filter,r=(n,o)=>{let a=o||Th.parse(n).root||".",l=n===a?!1:t.has(n)?t.get(n):r(Th.dirname(n),a);return t.set(n,l),l};s.filter=i?(n,o)=>i(n,o)&&r(ro(n)):n=>r(ro(n))},Qu=s=>{let e=Ah(s),t=s.file,i=!0,r;try{let n=yi.statSync(t),o=s.maxReadSize||16*1024*1024;if(n.size<o)e.end(yi.readFileSync(t));else{let a=0,l=Buffer.allocUnsafe(o);for(r=yi.openSync(t,"r");a<n.size;){let h=yi.readSync(r,l,0,o,a);a+=h,e.write(l.slice(0,h))}e.end()}i=!1}finally{if(i&&r)try{yi.closeSync(r)}catch{}}},ed=(s,e)=>{let t=new _h(s),i=s.maxReadSize||16*1024*1024,r=s.file,n=new Promise((o,a)=>{t.on("error",a),t.on("end",o),yi.stat(r,(l,h)=>{if(l)a(l);else{let u=new Zu.ReadStream(r,{readSize:i,size:h.size});u.on("error",a),u.pipe(t)}})});return e?n.then(e,e):n},Ah=s=>new _h(s)});var Mh=p((nv,Fh)=>{"use strict";var td=Xt(),fr=Ws(),Lh=gi(),Bh=dr(),Dh=require("path");Fh.exports=(s,e,t)=>{if(typeof e=="function"&&(t=e),Array.isArray(s)&&(e=s,s={}),!e||!Array.isArray(e)||!e.length)throw new TypeError("no files or directories specified");e=Array.from(e);let i=td(s);if(i.sync&&typeof t=="function")throw new TypeError("callback not supported for sync tar functions");if(!i.file&&typeof t=="function")throw new TypeError("callback only supported with file option");return i.file&&i.sync?id(i,e):i.file?sd(i,e,t):i.sync?rd(i,e):nd(i,e)};var id=(s,e)=>{let t=new fr.Sync(s),i=new Lh.WriteStreamSync(s.file,{mode:s.mode||438});t.pipe(i),kh(t,e)},sd=(s,e,t)=>{let i=new fr(s),r=new Lh.WriteStream(s.file,{mode:s.mode||438});i.pipe(r);let n=new Promise((o,a)=>{r.on("error",a),r.on("close",o),i.on("error",a)});return no(i,e),t?n.then(t,t):n},kh=(s,e)=>{e.forEach(t=>{t.charAt(0)==="@"?Bh({file:Dh.resolve(s.cwd,t.slice(1)),sync:!0,noResume:!0,onentry:i=>s.add(i)}):s.add(t)}),s.end()},no=(s,e)=>{for(;e.length;){let t=e.shift();if(t.charAt(0)==="@")return Bh({file:Dh.resolve(s.cwd,t.slice(1)),noResume:!0,onentry:i=>s.add(i)}).then(i=>no(s,e));s.add(t)}s.end()},rd=(s,e)=>{let t=new fr.Sync(s);return kh(t,e),t},nd=(s,e)=>{let t=new fr(s);return no(t,e),t}});var oo=p((ov,zh)=>{"use strict";var od=Xt(),jh=Ws(),z=require("fs"),$h=gi(),qh=dr(),Uh=require("path"),Gh=ni();zh.exports=(s,e,t)=>{let i=od(s);if(!i.file)throw new TypeError("file is required");if(i.gzip)throw new TypeError("cannot append to compressed archives");if(!e||!Array.isArray(e)||!e.length)throw new TypeError("no files or directories specified");return e=Array.from(e),i.sync?ad(i,e):ld(i,e,t)};var ad=(s,e)=>{let t=new jh.Sync(s),i=!0,r,n;try{try{r=z.openSync(s.file,"r+")}catch(l){if(l.code==="ENOENT")r=z.openSync(s.file,"w+");else throw l}let o=z.fstatSync(r),a=Buffer.alloc(512);e:for(n=0;n<o.size;n+=512){for(let u=0,d=0;u<512;u+=d){if(d=z.readSync(r,a,u,a.length-u,n+u),n===0&&a[0]===31&&a[1]===139)throw new Error("cannot append to compressed archives");if(!d)break e}let l=new Gh(a);if(!l.cksumValid)break;let h=512*Math.ceil(l.size/512);if(n+h+512>o.size)break;n+=h,s.mtimeCache&&s.mtimeCache.set(l.path,l.mtime)}i=!1,hd(s,t,n,r,e)}finally{if(i)try{z.closeSync(r)}catch{}}},hd=(s,e,t,i,r)=>{let n=new $h.WriteStreamSync(s.file,{fd:i,start:t});e.pipe(n),cd(e,r)},ld=(s,e,t)=>{e=Array.from(e);let i=new jh(s),r=(o,a,l)=>{let h=(y,I)=>{y?z.close(o,C=>l(y)):l(null,I)},u=0;if(a===0)return h(null,0);let d=0,f=Buffer.alloc(512),g=(y,I)=>{if(y)return h(y);if(d+=I,d<512&&I)return z.read(o,f,d,f.length-d,u+d,g);if(u===0&&f[0]===31&&f[1]===139)return h(new Error("cannot append to compressed archives"));if(d<512)return h(null,u);let C=new Gh(f);if(!C.cksumValid)return h(null,u);let N=512*Math.ceil(C.size/512);if(u+N+512>a||(u+=N+512,u>=a))return h(null,u);s.mtimeCache&&s.mtimeCache.set(C.path,C.mtime),d=0,z.read(o,f,0,512,u,g)};z.read(o,f,0,512,u,g)},n=new Promise((o,a)=>{i.on("error",a);let l="r+",h=(u,d)=>{if(u&&u.code==="ENOENT"&&l==="r+")return l="w+",z.open(s.file,l,h);if(u)return a(u);z.fstat(d,(f,g)=>{if(f)return z.close(d,()=>a(f));r(d,g.size,(y,I)=>{if(y)return a(y);let C=new $h.WriteStream(s.file,{fd:d,start:I});i.pipe(C),C.on("error",a),C.on("close",o),Vh(i,e)})})};z.open(s.file,l,h)});return t?n.then(t,t):n},cd=(s,e)=>{e.forEach(t=>{t.charAt(0)==="@"?qh({file:Uh.resolve(s.cwd,t.slice(1)),sync:!0,noResume:!0,onentry:i=>s.add(i)}):s.add(t)}),s.end()},Vh=(s,e)=>{for(;e.length;){let t=e.shift();if(t.charAt(0)==="@")return qh({file:Uh.resolve(s.cwd,t.slice(1)),noResume:!0,onentry:i=>s.add(i)}).then(i=>Vh(s,e));s.add(t)}s.end()}});var Hh=p((av,Wh)=>{"use strict";var ud=Xt(),dd=oo();Wh.exports=(s,e,t)=>{let i=ud(s);if(!i.file)throw new TypeError("file is required");if(i.gzip)throw new TypeError("cannot append to compressed archives");if(!e||!Array.isArray(e)||!e.length)throw new TypeError("no files or directories specified");return e=Array.from(e),fd(i),dd(i,e,t)};var fd=s=>{let e=s.filter;s.mtimeCache||(s.mtimeCache=new Map),s.filter=e?(t,i)=>e(t,i)&&!(s.mtimeCache.get(t)>i.mtime):(t,i)=>!(s.mtimeCache.get(t)>i.mtime)}});var Zh=p((hv,Kh)=>{var{promisify:Yh}=require("util"),Ze=require("fs"),md=s=>{if(!s)s={mode:511,fs:Ze};else if(typeof s=="object")s={mode:511,fs:Ze,...s};else if(typeof s=="number")s={mode:s,fs:Ze};else if(typeof s=="string")s={mode:parseInt(s,8),fs:Ze};else throw new TypeError("invalid options argument");return s.mkdir=s.mkdir||s.fs.mkdir||Ze.mkdir,s.mkdirAsync=Yh(s.mkdir),s.stat=s.stat||s.fs.stat||Ze.stat,s.statAsync=Yh(s.stat),s.statSync=s.statSync||s.fs.statSync||Ze.statSync,s.mkdirSync=s.mkdirSync||s.fs.mkdirSync||Ze.mkdirSync,s};Kh.exports=md});var Xh=p((lv,Jh)=>{var pd=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,{resolve:gd,parse:yd}=require("path"),wd=s=>{if(/\0/.test(s))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:s,code:"ERR_INVALID_ARG_VALUE"});if(s=gd(s),pd==="win32"){let e=/[*|"<>?:]/,{root:t}=yd(s);if(e.test(s.substr(t.length)))throw Object.assign(new Error("Illegal characters in path."),{path:s,code:"EINVAL"})}return s};Jh.exports=wd});var sl=p((cv,il)=>{var{dirname:Qh}=require("path"),el=(s,e,t=void 0)=>t===e?Promise.resolve():s.statAsync(e).then(i=>i.isDirectory()?t:void 0,i=>i.code==="ENOENT"?el(s,Qh(e),e):void 0),tl=(s,e,t=void 0)=>{if(t!==e)try{return s.statSync(e).isDirectory()?t:void 0}catch(i){return i.code==="ENOENT"?tl(s,Qh(e),e):void 0}};il.exports={findMade:el,findMadeSync:tl}});var lo=p((uv,nl)=>{var{dirname:rl}=require("path"),ao=(s,e,t)=>{e.recursive=!1;let i=rl(s);return i===s?e.mkdirAsync(s,e).catch(r=>{if(r.code!=="EISDIR")throw r}):e.mkdirAsync(s,e).then(()=>t||s,r=>{if(r.code==="ENOENT")return ao(i,e).then(n=>ao(s,e,n));if(r.code!=="EEXIST"&&r.code!=="EROFS")throw r;return e.statAsync(s).then(n=>{if(n.isDirectory())return t;throw r},()=>{throw r})})},ho=(s,e,t)=>{let i=rl(s);if(e.recursive=!1,i===s)try{return e.mkdirSync(s,e)}catch(r){if(r.code!=="EISDIR")throw r;return}try{return e.mkdirSync(s,e),t||s}catch(r){if(r.code==="ENOENT")return ho(s,e,ho(i,e,t));if(r.code!=="EEXIST"&&r.code!=="EROFS")throw r;try{if(!e.statSync(s).isDirectory())throw r}catch{throw r}}};nl.exports={mkdirpManual:ao,mkdirpManualSync:ho}});var hl=p((dv,al)=>{var{dirname:ol}=require("path"),{findMade:vd,findMadeSync:bd}=sl(),{mkdirpManual:Ed,mkdirpManualSync:Sd}=lo(),Cd=(s,e)=>(e.recursive=!0,ol(s)===s?e.mkdirAsync(s,e):vd(e,s).then(i=>e.mkdirAsync(s,e).then(()=>i).catch(r=>{if(r.code==="ENOENT")return Ed(s,e);throw r}))),Nd=(s,e)=>{if(e.recursive=!0,ol(s)===s)return e.mkdirSync(s,e);let i=bd(e,s);try{return e.mkdirSync(s,e),i}catch(r){if(r.code==="ENOENT")return Sd(s,e);throw r}};al.exports={mkdirpNative:Cd,mkdirpNativeSync:Nd}});var dl=p((fv,ul)=>{var ll=require("fs"),Rd=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version,co=Rd.replace(/^v/,"").split("."),cl=+co[0]>10||+co[0]==10&&+co[1]>=12,Pd=cl?s=>s.mkdir===ll.mkdir:()=>!1,xd=cl?s=>s.mkdirSync===ll.mkdirSync:()=>!1;ul.exports={useNative:Pd,useNativeSync:xd}});var wl=p((mv,yl)=>{var wi=Zh(),vi=Xh(),{mkdirpNative:fl,mkdirpNativeSync:ml}=hl(),{mkdirpManual:pl,mkdirpManualSync:gl}=lo(),{useNative:Od,useNativeSync:Td}=dl(),bi=(s,e)=>(s=vi(s),e=wi(e),Od(e)?fl(s,e):pl(s,e)),_d=(s,e)=>(s=vi(s),e=wi(e),Td(e)?ml(s,e):gl(s,e));bi.sync=_d;bi.native=(s,e)=>fl(vi(s),wi(e));bi.manual=(s,e)=>pl(vi(s),wi(e));bi.nativeSync=(s,e)=>ml(vi(s),wi(e));bi.manualSync=(s,e)=>gl(vi(s),wi(e));yl.exports=bi});var Rl=p((pv,Nl)=>{"use strict";var K=require("fs"),Yt=require("path"),Ad=K.lchown?"lchown":"chown",Id=K.lchownSync?"lchownSync":"chownSync",bl=K.lchown&&!process.version.match(/v1[1-9]+\./)&&!process.version.match(/v10\.[6-9]/),vl=(s,e,t)=>{try{return K[Id](s,e,t)}catch(i){if(i.code!=="ENOENT")throw i}},Ld=(s,e,t)=>{try{return K.chownSync(s,e,t)}catch(i){if(i.code!=="ENOENT")throw i}},Bd=bl?(s,e,t,i)=>r=>{!r||r.code!=="EISDIR"?i(r):K.chown(s,e,t,i)}:(s,e,t,i)=>i,uo=bl?(s,e,t)=>{try{return vl(s,e,t)}catch(i){if(i.code!=="EISDIR")throw i;Ld(s,e,t)}}:(s,e,t)=>vl(s,e,t),Dd=process.version,El=(s,e,t)=>K.readdir(s,e,t),kd=(s,e)=>K.readdirSync(s,e);/^v4\./.test(Dd)&&(El=(s,e,t)=>K.readdir(s,t));var mr=(s,e,t,i)=>{K[Ad](s,e,t,Bd(s,e,t,r=>{i(r&&r.code!=="ENOENT"?r:null)}))},Sl=(s,e,t,i,r)=>{if(typeof e=="string")return K.lstat(Yt.resolve(s,e),(n,o)=>{if(n)return r(n.code!=="ENOENT"?n:null);o.name=e,Sl(s,o,t,i,r)});if(e.isDirectory())fo(Yt.resolve(s,e.name),t,i,n=>{if(n)return r(n);let o=Yt.resolve(s,e.name);mr(o,t,i,r)});else{let n=Yt.resolve(s,e.name);mr(n,t,i,r)}},fo=(s,e,t,i)=>{El(s,{withFileTypes:!0},(r,n)=>{if(r){if(r.code==="ENOENT")return i();if(r.code!=="ENOTDIR"&&r.code!=="ENOTSUP")return i(r)}if(r||!n.length)return mr(s,e,t,i);let o=n.length,a=null,l=h=>{if(!a){if(h)return i(a=h);if(--o===0)return mr(s,e,t,i)}};n.forEach(h=>Sl(s,h,e,t,l))})},Fd=(s,e,t,i)=>{if(typeof e=="string")try{let r=K.lstatSync(Yt.resolve(s,e));r.name=e,e=r}catch(r){if(r.code==="ENOENT")return;throw r}e.isDirectory()&&Cl(Yt.resolve(s,e.name),t,i),uo(Yt.resolve(s,e.name),t,i)},Cl=(s,e,t)=>{let i;try{i=kd(s,{withFileTypes:!0})}catch(r){if(r.code==="ENOENT")return;if(r.code==="ENOTDIR"||r.code==="ENOTSUP")return uo(s,e,t);throw r}return i&&i.length&&i.forEach(r=>Fd(s,r,e,t)),uo(s,e,t)};Nl.exports=fo;fo.sync=Cl});var Tl=p((gv,mo)=>{"use strict";var Pl=wl(),Z=require("fs"),pr=require("path"),xl=Rl(),Q=si(),gr=class extends Error{constructor(e,t){super("Cannot extract through symbolic link"),this.path=t,this.symlink=e}get name(){return"SylinkError"}},yr=class extends Error{constructor(e,t){super(t+": Cannot cd into '"+e+"'"),this.path=e,this.code=t}get name(){return"CwdError"}},wr=(s,e)=>s.get(Q(e)),Yi=(s,e,t)=>s.set(Q(e),t),Md=(s,e)=>{Z.stat(s,(t,i)=>{(t||!i.isDirectory())&&(t=new yr(s,t&&t.code||"ENOTDIR")),e(t)})};mo.exports=(s,e,t)=>{s=Q(s);let i=e.umask,r=e.mode|448,n=(r&i)!==0,o=e.uid,a=e.gid,l=typeof o=="number"&&typeof a=="number"&&(o!==e.processUid||a!==e.processGid),h=e.preserve,u=e.unlink,d=e.cache,f=Q(e.cwd),g=(C,N)=>{C?t(C):(Yi(d,s,!0),N&&l?xl(N,o,a,To=>g(To)):n?Z.chmod(s,r,t):t())};if(d&&wr(d,s)===!0)return g();if(s===f)return Md(s,g);if(h)return Pl(s,{mode:r}).then(C=>g(null,C),g);let I=Q(pr.relative(f,s)).split("/");vr(f,I,r,d,u,f,null,g)};var vr=(s,e,t,i,r,n,o,a)=>{if(!e.length)return a(null,o);let l=e.shift(),h=Q(pr.resolve(s+"/"+l));if(wr(i,h))return vr(h,e,t,i,r,n,o,a);Z.mkdir(h,t,Ol(h,e,t,i,r,n,o,a))},Ol=(s,e,t,i,r,n,o,a)=>l=>{l?Z.lstat(s,(h,u)=>{if(h)h.path=h.path&&Q(h.path),a(h);else if(u.isDirectory())vr(s,e,t,i,r,n,o,a);else if(r)Z.unlink(s,d=>{if(d)return a(d);Z.mkdir(s,t,Ol(s,e,t,i,r,n,o,a))});else{if(u.isSymbolicLink())return a(new gr(s,s+"/"+e.join("/")));a(l)}}):(o=o||s,vr(s,e,t,i,r,n,o,a))},jd=s=>{let e=!1,t="ENOTDIR";try{e=Z.statSync(s).isDirectory()}catch(i){t=i.code}finally{if(!e)throw new yr(s,t)}};mo.exports.sync=(s,e)=>{s=Q(s);let t=e.umask,i=e.mode|448,r=(i&t)!==0,n=e.uid,o=e.gid,a=typeof n=="number"&&typeof o=="number"&&(n!==e.processUid||o!==e.processGid),l=e.preserve,h=e.unlink,u=e.cache,d=Q(e.cwd),f=C=>{Yi(u,s,!0),C&&a&&xl.sync(C,n,o),r&&Z.chmodSync(s,i)};if(u&&wr(u,s)===!0)return f();if(s===d)return jd(d),f();if(l)return f(Pl.sync(s,i));let y=Q(pr.relative(d,s)).split("/"),I=null;for(let C=y.shift(),N=d;C&&(N+="/"+C);C=y.shift())if(N=Q(pr.resolve(N)),!wr(u,N))try{Z.mkdirSync(N,i),I=I||N,Yi(u,N,!0)}catch{let _o=Z.lstatSync(N);if(_o.isDirectory()){Yi(u,N,!0);continue}else if(h){Z.unlinkSync(N),Z.mkdirSync(N,i),I=I||N,Yi(u,N,!0);continue}else if(_o.isSymbolicLink())return new gr(N,N+"/"+y.join("/"))}return f(I)}});var go=p((yv,_l)=>{var po=Object.create(null),{hasOwnProperty:$d}=Object.prototype;_l.exports=s=>($d.call(po,s)||(po[s]=s.normalize("NFKD")),po[s])});var Bl=p((wv,Ll)=>{var Al=require("assert"),qd=go(),Ud=oi(),{join:Il}=require("path"),Gd=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,Vd=Gd==="win32";Ll.exports=()=>{let s=new Map,e=new Map,t=h=>h.split("/").slice(0,-1).reduce((d,f)=>(d.length&&(f=Il(d[d.length-1],f)),d.push(f||"/"),d),[]),i=new Set,r=h=>{let u=e.get(h);if(!u)throw new Error("function does not have any path reservations");return{paths:u.paths.map(d=>s.get(d)),dirs:[...u.dirs].map(d=>s.get(d))}},n=h=>{let{paths:u,dirs:d}=r(h);return u.every(f=>f[0]===h)&&d.every(f=>f[0]instanceof Set&&f[0].has(h))},o=h=>i.has(h)||!n(h)?!1:(i.add(h),h(()=>a(h)),!0),a=h=>{if(!i.has(h))return!1;let{paths:u,dirs:d}=e.get(h),f=new Set;return u.forEach(g=>{let y=s.get(g);Al.equal(y[0],h),y.length===1?s.delete(g):(y.shift(),typeof y[0]=="function"?f.add(y[0]):y[0].forEach(I=>f.add(I)))}),d.forEach(g=>{let y=s.get(g);Al(y[0]instanceof Set),y[0].size===1&&y.length===1?s.delete(g):y[0].size===1?(y.shift(),f.add(y[0])):y[0].delete(h)}),i.delete(h),f.forEach(g=>o(g)),!0};return{check:n,reserve:(h,u)=>{h=Vd?["win32 parallelization disabled"]:h.map(f=>qd(Ud(Il(f))).toLowerCase());let d=new Set(h.map(f=>t(f)).reduce((f,g)=>f.concat(g)));return e.set(u,{dirs:d,paths:h}),h.forEach(f=>{let g=s.get(f);g?g.push(u):s.set(f,[u])}),d.forEach(f=>{let g=s.get(f);g?g[g.length-1]instanceof Set?g[g.length-1].add(u):g.push(new Set([u])):s.set(f,[new Set([u])])}),o(u)}}}});var Fl=p((vv,kl)=>{var zd=process.env.__FAKE_PLATFORM__||process.platform,Wd=zd==="win32",Hd=global.__FAKE_TESTING_FS__||require("fs"),{O_CREAT:Yd,O_TRUNC:Kd,O_WRONLY:Zd,UV_FS_O_FILEMAP:Dl=0}=Hd.constants,Jd=Wd&&!!Dl,Xd=512*1024,Qd=Dl|Kd|Yd|Zd;kl.exports=Jd?s=>s<Xd?Qd:"w":()=>"w"});var Ro=p((bv,Jl)=>{"use strict";var ef=require("assert"),tf=ur(),v=require("fs"),sf=gi(),Ae=require("path"),Yl=Tl(),Ml=wn(),rf=Bl(),nf=vn(),W=si(),of=oi(),af=go(),jl=Symbol("onEntry"),vo=Symbol("checkFs"),$l=Symbol("checkFs2"),Sr=Symbol("pruneCache"),bo=Symbol("isReusable"),J=Symbol("makeFs"),Eo=Symbol("file"),So=Symbol("directory"),Cr=Symbol("link"),ql=Symbol("symlink"),Ul=Symbol("hardlink"),Gl=Symbol("unsupported"),Vl=Symbol("checkPath"),Je=Symbol("mkdir"),F=Symbol("onError"),br=Symbol("pending"),zl=Symbol("pend"),Ei=Symbol("unpend"),yo=Symbol("ended"),wo=Symbol("maybeClose"),Co=Symbol("skip"),Ki=Symbol("doChown"),Zi=Symbol("uid"),Ji=Symbol("gid"),Xi=Symbol("checkedCwd"),Kl=require("crypto"),Zl=Fl(),hf=process.env.TESTING_TAR_FAKE_PLATFORM||process.platform,Qi=hf==="win32",lf=(s,e)=>{if(!Qi)return v.unlink(s,e);let t=s+".DELETE."+Kl.randomBytes(16).toString("hex");v.rename(s,t,i=>{if(i)return e(i);v.unlink(t,e)})},cf=s=>{if(!Qi)return v.unlinkSync(s);let e=s+".DELETE."+Kl.randomBytes(16).toString("hex");v.renameSync(s,e),v.unlinkSync(e)},Wl=(s,e,t)=>s===s>>>0?s:e===e>>>0?e:t,Hl=s=>af(of(W(s))).toLowerCase(),uf=(s,e)=>{e=Hl(e);for(let t of s.keys()){let i=Hl(t);(i===e||i.indexOf(e+"/")===0)&&s.delete(t)}},df=s=>{for(let e of s.keys())s.delete(e)},es=class extends tf{constructor(e){if(e||(e={}),e.ondone=t=>{this[yo]=!0,this[wo]()},super(e),this[Xi]=!1,this.reservations=rf(),this.transform=typeof e.transform=="function"?e.transform:null,this.writable=!0,this.readable=!1,this[br]=0,this[yo]=!1,this.dirCache=e.dirCache||new Map,typeof e.uid=="number"||typeof e.gid=="number"){if(typeof e.uid!="number"||typeof e.gid!="number")throw new TypeError("cannot set owner without number uid and gid");if(e.preserveOwner)throw new TypeError("cannot preserve owner in archive and also set owner explicitly");this.uid=e.uid,this.gid=e.gid,this.setOwner=!0}else this.uid=null,this.gid=null,this.setOwner=!1;e.preserveOwner===void 0&&typeof e.uid!="number"?this.preserveOwner=process.getuid&&process.getuid()===0:this.preserveOwner=!!e.preserveOwner,this.processUid=(this.preserveOwner||this.setOwner)&&process.getuid?process.getuid():null,this.processGid=(this.preserveOwner||this.setOwner)&&process.getgid?process.getgid():null,this.forceChown=e.forceChown===!0,this.win32=!!e.win32||Qi,this.newer=!!e.newer,this.keep=!!e.keep,this.noMtime=!!e.noMtime,this.preservePaths=!!e.preservePaths,this.unlink=!!e.unlink,this.cwd=W(Ae.resolve(e.cwd||process.cwd())),this.strip=+e.strip||0,this.processUmask=e.noChmod?0:process.umask(),this.umask=typeof e.umask=="number"?e.umask:this.processUmask,this.dmode=e.dmode||511&~this.umask,this.fmode=e.fmode||438&~this.umask,this.on("entry",t=>this[jl](t))}warn(e,t,i={}){return(e==="TAR_BAD_ARCHIVE"||e==="TAR_ABORT")&&(i.recoverable=!1),super.warn(e,t,i)}[wo](){this[yo]&&this[br]===0&&(this.emit("prefinish"),this.emit("finish"),this.emit("end"))}[Vl](e){if(this.strip){let t=W(e.path).split("/");if(t.length<this.strip)return!1;if(e.path=t.slice(this.strip).join("/"),e.type==="Link"){let i=W(e.linkpath).split("/");if(i.length>=this.strip)e.linkpath=i.slice(this.strip).join("/");else return!1}}if(!this.preservePaths){let t=W(e.path),i=t.split("/");if(i.includes("..")||Qi&&/^[a-z]:\.\.$/i.test(i[0]))return this.warn("TAR_ENTRY_ERROR","path contains '..'",{entry:e,path:t}),!1;let[r,n]=nf(t);r&&(e.path=n,this.warn("TAR_ENTRY_INFO",`stripping ${r} from absolute path`,{entry:e,path:t}))}if(Ae.isAbsolute(e.path)?e.absolute=W(Ae.resolve(e.path)):e.absolute=W(Ae.resolve(this.cwd,e.path)),!this.preservePaths&&e.absolute.indexOf(this.cwd+"/")!==0&&e.absolute!==this.cwd)return this.warn("TAR_ENTRY_ERROR","path escaped extraction target",{entry:e,path:W(e.path),resolvedPath:e.absolute,cwd:this.cwd}),!1;if(e.absolute===this.cwd&&e.type!=="Directory"&&e.type!=="GNUDumpDir")return!1;if(this.win32){let{root:t}=Ae.win32.parse(e.absolute);e.absolute=t+Ml.encode(e.absolute.slice(t.length));let{root:i}=Ae.win32.parse(e.path);e.path=i+Ml.encode(e.path.slice(i.length))}return!0}[jl](e){if(!this[Vl](e))return e.resume();switch(ef.equal(typeof e.absolute,"string"),e.type){case"Directory":case"GNUDumpDir":e.mode&&(e.mode=e.mode|448);case"File":case"OldFile":case"ContiguousFile":case"Link":case"SymbolicLink":return this[vo](e);case"CharacterDevice":case"BlockDevice":case"FIFO":default:return this[Gl](e)}}[F](e,t){e.name==="CwdError"?this.emit("error",e):(this.warn("TAR_ENTRY_ERROR",e,{entry:t}),this[Ei](),t.resume())}[Je](e,t,i){Yl(W(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t,noChmod:this.noChmod},i)}[Ki](e){return this.forceChown||this.preserveOwner&&(typeof e.uid=="number"&&e.uid!==this.processUid||typeof e.gid=="number"&&e.gid!==this.processGid)||typeof this.uid=="number"&&this.uid!==this.processUid||typeof this.gid=="number"&&this.gid!==this.processGid}[Zi](e){return Wl(this.uid,e.uid,this.processUid)}[Ji](e){return Wl(this.gid,e.gid,this.processGid)}[Eo](e,t){let i=e.mode&4095||this.fmode,r=new sf.WriteStream(e.absolute,{flags:Zl(e.size),mode:i,autoClose:!1});r.on("error",l=>{r.fd&&v.close(r.fd,()=>{}),r.write=()=>!0,this[F](l,e),t()});let n=1,o=l=>{if(l){r.fd&&v.close(r.fd,()=>{}),this[F](l,e),t();return}--n===0&&v.close(r.fd,h=>{h?this[F](h,e):this[Ei](),t()})};r.on("finish",l=>{let h=e.absolute,u=r.fd;if(e.mtime&&!this.noMtime){n++;let d=e.atime||new Date,f=e.mtime;v.futimes(u,d,f,g=>g?v.utimes(h,d,f,y=>o(y&&g)):o())}if(this[Ki](e)){n++;let d=this[Zi](e),f=this[Ji](e);v.fchown(u,d,f,g=>g?v.chown(h,d,f,y=>o(y&&g)):o())}o()});let a=this.transform&&this.transform(e)||e;a!==e&&(a.on("error",l=>{this[F](l,e),t()}),e.pipe(a)),a.pipe(r)}[So](e,t){let i=e.mode&4095||this.dmode;this[Je](e.absolute,i,r=>{if(r){this[F](r,e),t();return}let n=1,o=a=>{--n===0&&(t(),this[Ei](),e.resume())};e.mtime&&!this.noMtime&&(n++,v.utimes(e.absolute,e.atime||new Date,e.mtime,o)),this[Ki](e)&&(n++,v.chown(e.absolute,this[Zi](e),this[Ji](e),o)),o()})}[Gl](e){e.unsupported=!0,this.warn("TAR_ENTRY_UNSUPPORTED",`unsupported entry type: ${e.type}`,{entry:e}),e.resume()}[ql](e,t){this[Cr](e,e.linkpath,"symlink",t)}[Ul](e,t){let i=W(Ae.resolve(this.cwd,e.linkpath));this[Cr](e,i,"link",t)}[zl](){this[br]++}[Ei](){this[br]--,this[wo]()}[Co](e){this[Ei](),e.resume()}[bo](e,t){return e.type==="File"&&!this.unlink&&t.isFile()&&t.nlink<=1&&!Qi}[vo](e){this[zl]();let t=[e.path];e.linkpath&&t.push(e.linkpath),this.reservations.reserve(t,i=>this[$l](e,i))}[Sr](e){e.type==="SymbolicLink"?df(this.dirCache):e.type!=="Directory"&&uf(this.dirCache,e.absolute)}[$l](e,t){this[Sr](e);let i=a=>{this[Sr](e),t(a)},r=()=>{this[Je](this.cwd,this.dmode,a=>{if(a){this[F](a,e),i();return}this[Xi]=!0,n()})},n=()=>{if(e.absolute!==this.cwd){let a=W(Ae.dirname(e.absolute));if(a!==this.cwd)return this[Je](a,this.dmode,l=>{if(l){this[F](l,e),i();return}o()})}o()},o=()=>{v.lstat(e.absolute,(a,l)=>{if(l&&(this.keep||this.newer&&l.mtime>e.mtime)){this[Co](e),i();return}if(a||this[bo](e,l))return this[J](null,e,i);if(l.isDirectory()){if(e.type==="Directory"){let h=!this.noChmod&&e.mode&&(l.mode&4095)!==e.mode,u=d=>this[J](d,e,i);return h?v.chmod(e.absolute,e.mode,u):u()}if(e.absolute!==this.cwd)return v.rmdir(e.absolute,h=>this[J](h,e,i))}if(e.absolute===this.cwd)return this[J](null,e,i);lf(e.absolute,h=>this[J](h,e,i))})};this[Xi]?n():r()}[J](e,t,i){if(e){this[F](e,t),i();return}switch(t.type){case"File":case"OldFile":case"ContiguousFile":return this[Eo](t,i);case"Link":return this[Ul](t,i);case"SymbolicLink":return this[ql](t,i);case"Directory":case"GNUDumpDir":return this[So](t,i)}}[Cr](e,t,i,r){v[i](t,e.absolute,n=>{n?this[F](n,e):(this[Ei](),e.resume()),r()})}},Er=s=>{try{return[null,s()]}catch(e){return[e,null]}},No=class extends es{[J](e,t){return super[J](e,t,()=>{})}[vo](e){if(this[Sr](e),!this[Xi]){let n=this[Je](this.cwd,this.dmode);if(n)return this[F](n,e);this[Xi]=!0}if(e.absolute!==this.cwd){let n=W(Ae.dirname(e.absolute));if(n!==this.cwd){let o=this[Je](n,this.dmode);if(o)return this[F](o,e)}}let[t,i]=Er(()=>v.lstatSync(e.absolute));if(i&&(this.keep||this.newer&&i.mtime>e.mtime))return this[Co](e);if(t||this[bo](e,i))return this[J](null,e);if(i.isDirectory()){if(e.type==="Directory"){let o=!this.noChmod&&e.mode&&(i.mode&4095)!==e.mode,[a]=o?Er(()=>{v.chmodSync(e.absolute,e.mode)}):[];return this[J](a,e)}let[n]=Er(()=>v.rmdirSync(e.absolute));this[J](n,e)}let[r]=e.absolute===this.cwd?[]:Er(()=>cf(e.absolute));this[J](r,e)}[Eo](e,t){let i=e.mode&4095||this.fmode,r=a=>{let l;try{v.closeSync(n)}catch(h){l=h}(a||l)&&this[F](a||l,e),t()},n;try{n=v.openSync(e.absolute,Zl(e.size),i)}catch(a){return r(a)}let o=this.transform&&this.transform(e)||e;o!==e&&(o.on("error",a=>this[F](a,e)),e.pipe(o)),o.on("data",a=>{try{v.writeSync(n,a,0,a.length)}catch(l){r(l)}}),o.on("end",a=>{let l=null;if(e.mtime&&!this.noMtime){let h=e.atime||new Date,u=e.mtime;try{v.futimesSync(n,h,u)}catch(d){try{v.utimesSync(e.absolute,h,u)}catch{l=d}}}if(this[Ki](e)){let h=this[Zi](e),u=this[Ji](e);try{v.fchownSync(n,h,u)}catch(d){try{v.chownSync(e.absolute,h,u)}catch{l=l||d}}}r(l)})}[So](e,t){let i=e.mode&4095||this.dmode,r=this[Je](e.absolute,i);if(r){this[F](r,e),t();return}if(e.mtime&&!this.noMtime)try{v.utimesSync(e.absolute,e.atime||new Date,e.mtime)}catch{}if(this[Ki](e))try{v.chownSync(e.absolute,this[Zi](e),this[Ji](e))}catch{}t(),e.resume()}[Je](e,t){try{return Yl.sync(W(e),{uid:this.uid,gid:this.gid,processUid:this.processUid,processGid:this.processGid,umask:this.processUmask,preserve:this.preservePaths,unlink:this.unlink,cache:this.dirCache,cwd:this.cwd,mode:t})}catch(i){return i}}[Cr](e,t,i,r){try{v[i+"Sync"](t,e.absolute),r(),e.resume()}catch(n){return this[F](n,e)}}};es.Sync=No;Jl.exports=es});var ic=p((Ev,tc)=>{"use strict";var ff=Xt(),Nr=Ro(),Ql=require("fs"),ec=gi(),Xl=require("path"),Po=oi();tc.exports=(s,e,t)=>{typeof s=="function"?(t=s,e=null,s={}):Array.isArray(s)&&(e=s,s={}),typeof e=="function"&&(t=e,e=null),e?e=Array.from(e):e=[];let i=ff(s);if(i.sync&&typeof t=="function")throw new TypeError("callback not supported for sync tar functions");if(!i.file&&typeof t=="function")throw new TypeError("callback only supported with file option");return e.length&&mf(i,e),i.file&&i.sync?pf(i):i.file?gf(i,t):i.sync?yf(i):wf(i)};var mf=(s,e)=>{let t=new Map(e.map(n=>[Po(n),!0])),i=s.filter,r=(n,o)=>{let a=o||Xl.parse(n).root||".",l=n===a?!1:t.has(n)?t.get(n):r(Xl.dirname(n),a);return t.set(n,l),l};s.filter=i?(n,o)=>i(n,o)&&r(Po(n)):n=>r(Po(n))},pf=s=>{let e=new Nr.Sync(s),t=s.file,i=Ql.statSync(t),r=s.maxReadSize||16*1024*1024;new ec.ReadStreamSync(t,{readSize:r,size:i.size}).pipe(e)},gf=(s,e)=>{let t=new Nr(s),i=s.maxReadSize||16*1024*1024,r=s.file,n=new Promise((o,a)=>{t.on("error",a),t.on("close",o),Ql.stat(r,(l,h)=>{if(l)a(l);else{let u=new ec.ReadStream(r,{readSize:i,size:h.size});u.on("error",a),u.pipe(t)}})});return e?n.then(e,e):n},yf=s=>new Nr.Sync(s),wf=s=>new Nr(s)});var sc=p(x=>{"use strict";x.c=x.create=Mh();x.r=x.replace=oo();x.t=x.list=dr();x.u=x.update=Hh();x.x=x.extract=ic();x.Pack=Ws();x.Unpack=Ro();x.Parse=ur();x.ReadEntry=Ts();x.WriteEntry=Tn();x.Header=ni();x.Pax=As();x.types=un()});var Pf={};fc(Pf,{Aggregator:()=>et,ApiKey:()=>Ci,AuthAccessTokenCredentials:()=>Xe,AuthClientCredentials:()=>Zt,AuthUserPasswordCredentials:()=>Kt,BackupCreateStatusGetter:()=>ke,BackupCreator:()=>Lt,BackupRestoreStatusGetter:()=>Fe,BackupRestorer:()=>Bt,Checker:()=>bt,ClassCreator:()=>ot,ClassDeleter:()=>at,ClassGetter:()=>ht,ClassificationsGetter:()=>fe,ClassificationsScheduler:()=>Rt,ConceptsGetter:()=>It,Creator:()=>ft,Deleter:()=>vt,EmbeddedDB:()=>is,EmbeddedOptions:()=>ts,Explorer:()=>rt,ExtensionCreator:()=>At,Getter:()=>yt,GetterById:()=>wt,GraphQLGetter:()=>st,LiveChecker:()=>Tt,Merger:()=>gt,MetaGetter:()=>me,NodesStatusGetter:()=>Dt,ObjectsBatchDeleter:()=>xt,ObjectsBatcher:()=>Pt,OidcAuthenticator:()=>Si,OpenidConfigurationGetter:()=>he,PropertyCreator:()=>lt,Raw:()=>nt,ReadyChecker:()=>_t,ReferenceCreator:()=>Et,ReferenceDeleter:()=>Ct,ReferencePayloadBuilder:()=>Nt,ReferenceReplacer:()=>St,ReferencesBatcher:()=>Ot,SchemaGetter:()=>ct,ShardUpdater:()=>ut,ShardsUpdater:()=>dt,Updater:()=>pt,Validator:()=>mt,default:()=>Rf});module.exports=mc(Pf);var Si=class{constructor(e,t){this.refresh=async e=>{let t=await this.getOpenidConfig(e),i;switch(this.creds.constructor){case Kt:i=new Or(this.http,this.creds,t);break;case Xe:i=new Tr(this.http,this.creds,t);break;case Zt:i=new _r(this.http,this.creds,t);break;default:throw new Error("unsupported credential type")}return i.refresh().then(r=>{this.accessToken=r.accessToken,this.expiresAt=r.expiresAt,this.refreshToken=r.refreshToken,this.startTokenRefresh(i)})};this.getOpenidConfig=e=>this.http.externalGet(e.href).then(t=>{let i=e.scopes||[];return{clientId:e.clientId,provider:t,scopes:i}});this.startTokenRefresh=e=>{this.creds.silentRefresh&&!this.refreshRunning&&this.refreshTokenProvided()&&(this.refreshInterval=setInterval(async()=>{if(this.expiresAt-Date.now()<=6e4){let t=await e.refresh();this.accessToken=t.accessToken,this.expiresAt=t.expiresAt,this.refreshToken=t.refreshToken}},3e4),this.refreshRunning=!0)};this.stopTokenRefresh=()=>{clearInterval(this.refreshInterval),this.refreshRunning=!1};this.refreshTokenProvided=()=>this.refreshToken&&this.refreshToken!="";this.getAccessToken=()=>this.accessToken;this.getExpiresAt=()=>this.expiresAt;this.http=e,this.creds=t,this.accessToken="",this.refreshToken="",this.expiresAt=0,this.refreshRunning=!1,this.creds instanceof Xe&&(this.accessToken=this.creds.accessToken,this.expiresAt=this.creds.expiresAt,this.refreshToken=this.creds.refreshToken)}resetExpiresAt(){this.expiresAt=0}},Kt=class{constructor(e){this.username=e.username,this.password=e.password,this.scopes=e.scopes,this.silentRefresh=Ar(e.silentRefresh)}},Or=class{constructor(e,t,i){this.refresh=()=>(this.validateOpenidConfig(),this.requestAccessToken().then(e=>({accessToken:e.access_token,expiresAt:ns(e.expires_in),refreshToken:e.refresh_token})).catch(e=>Promise.reject(new Error(`failed to refresh access token: ${e}`))));this.validateOpenidConfig=()=>{if(this.openidConfig.provider.grant_types_supported!==void 0&&!this.openidConfig.provider.grant_types_supported.includes("password"))throw new Error("grant_type password not supported");if(this.openidConfig.provider.token_endpoint.includes("https://login.microsoftonline.com"))throw new Error("microsoft/azure recommends to avoid authentication using username and password, so this method is not supported by this client");this.openidConfig.scopes.push("offline_access")};this.requestAccessToken=()=>{let e=this.openidConfig.provider.token_endpoint,t=new URLSearchParams({grant_type:"password",client_id:this.openidConfig.clientId,username:this.creds.username,password:this.creds.password,scope:this.openidConfig.scopes.join(" ")}),i="application/x-www-form-urlencoded;charset=UTF-8";return this.http.externalPost(e,t,i)};this.http=e,this.creds=t,this.openidConfig=i,t.scopes&&this.openidConfig.scopes.push(t.scopes)}},Xe=class{constructor(e){this.validate=e=>{if(e.expiresIn===void 0)throw new Error("AuthAccessTokenCredentials: expiresIn is required");if(!Number.isInteger(e.expiresIn)||e.expiresIn<=0)throw new Error("AuthAccessTokenCredentials: expiresIn must be int > 0")};this.validate(e),this.accessToken=e.accessToken,this.expiresAt=ns(e.expiresIn),this.refreshToken=e.refreshToken,this.silentRefresh=Ar(e.silentRefresh)}},Tr=class{constructor(e,t,i){this.refresh=()=>this.creds.refreshToken===void 0||this.creds.refreshToken==""?(console.warn("AuthAccessTokenCredentials not provided with refreshToken, cannot refresh"),Promise.resolve({accessToken:this.creds.accessToken,expiresAt:this.creds.expiresAt})):(this.validateOpenidConfig(),this.requestAccessToken().then(e=>({accessToken:e.access_token,expiresAt:ns(e.expires_in),refreshToken:e.refresh_token})).catch(e=>Promise.reject(new Error(`failed to refresh access token: ${e}`))));this.validateOpenidConfig=()=>{if(this.openidConfig.provider.grant_types_supported===void 0||!this.openidConfig.provider.grant_types_supported.includes("refresh_token"))throw new Error("grant_type refresh_token not supported")};this.requestAccessToken=()=>{let e=this.openidConfig.provider.token_endpoint,t=new URLSearchParams({grant_type:"refresh_token",client_id:this.openidConfig.clientId,refresh_token:this.creds.refreshToken}),i="application/x-www-form-urlencoded;charset=UTF-8";return this.http.externalPost(e,t,i)};this.http=e,this.creds=t,this.openidConfig=i}},Zt=class{constructor(e){this.clientSecret=e.clientSecret,this.scopes=e.scopes,this.silentRefresh=Ar(e.silentRefresh)}},_r=class{constructor(e,t,i){this.refresh=()=>(this.validateOpenidConfig(),this.requestAccessToken().then(e=>({accessToken:e.access_token,expiresAt:ns(e.expires_in),refreshToken:e.refresh_token})).catch(e=>Promise.reject(new Error(`failed to refresh access token: ${e}`))));this.validateOpenidConfig=()=>{this.openidConfig.scopes.length>0||this.openidConfig.provider.token_endpoint.includes("https://login.microsoftonline.com")&&this.openidConfig.scopes.push(this.openidConfig.clientId+"/.default")};this.requestAccessToken=()=>{let e=this.openidConfig.provider.token_endpoint,t=new URLSearchParams({grant_type:"client_credentials",client_id:this.openidConfig.clientId,client_secret:this.creds.clientSecret,scope:this.openidConfig.scopes.join(" ")}),i="application/x-www-form-urlencoded;charset=UTF-8";return this.http.externalPost(e,t,i)};this.http=e,this.creds=t,this.openidConfig=i,t.scopes&&this.openidConfig.scopes.push(t.scopes)}},Ci=class{constructor(e){this.apiKey=e}};function ns(s){return Date.now()+(s-2)*1e3}function Ar(s){return s===void 0?!0:s}var he=class{constructor(e){this.do=()=>this.client.getRaw("/.well-known/openid-configuration").then(e=>e.status<400?e.json():e.status==404?Promise.resolve(void 0):Promise.reject(new Error(`unexpected status code: ${e.status}`)));this.client=e}};var ee=rs(require("isomorphic-fetch")),pc=s=>{let e=`${s.scheme}://${s.host}/v1`,t=gc(e);return{post:(i,r,n=!0,o="")=>{let a={method:"POST",headers:{...s.headers,"content-type":"application/json"},body:JSON.stringify(r)};return Qe(a,o),(0,ee.default)(t(i),a).then(Le(n))},put:(i,r,n=!0,o="")=>{let a={method:"PUT",headers:{...s.headers,"content-type":"application/json"},body:JSON.stringify(r)};return Qe(a,o),(0,ee.default)(t(i),a).then(Le(n))},patch:(i,r,n="")=>{let o={method:"PATCH",headers:{...s.headers,"content-type":"application/json"},body:JSON.stringify(r)};return Qe(o,n),(0,ee.default)(t(i),o).then(Le(!1))},delete:(i,r,n=!1,o="")=>{let a={method:"DELETE",headers:{...s.headers,"content-type":"application/json"},body:r?JSON.stringify(r):void 0};return Qe(a,o),(0,ee.default)(t(i),a).then(Le(n))},head:(i,r,n="")=>{let o={method:"HEAD",headers:{...s.headers,"content-type":"application/json"},body:r?JSON.stringify(r):void 0};return Qe(o,n),(0,ee.default)(t(i),o).then(yc(!1))},get:(i,r=!0,n="")=>{let o={method:"GET",headers:{...s.headers}};return Qe(o,n),(0,ee.default)(t(i),o).then(Le(r))},getRaw:(i,r="")=>{let n={method:"GET",headers:{...s.headers}};return Qe(n,r),(0,ee.default)(t(i),n)},externalGet:i=>(0,ee.default)(i,{method:"GET",headers:{...s.headers}}).then(Le(!0)),externalPost:(i,r,n)=>{(n==null||n=="")&&(n="application/json");let o={body:void 0,method:"POST",headers:{...s.headers,"content-type":n}};return r!=null&&(o.body=r),(0,ee.default)(i,o).then(Le(!0))}}},gc=s=>e=>s+e,Le=s=>e=>{if(e.status>=400)return e.text().then(t=>{let i;try{i=JSON.stringify(JSON.parse(t))}catch{i=t}return Promise.reject(new Error(`usage error (${e.status}): ${i}`))});if(s)return e.json()},yc=s=>e=>e.status==204||e.status==404?e.status==204:Le(s);function Qe(s,e){e!==""&&(s.headers.Authorization=`Bearer ${e}`)}var Io=pc;var Lo=require("graphql-request"),wc=s=>{let e=s.scheme,t=s.host,i=s.headers;return{query:(r,n,o)=>new Lo.GraphQLClient(`${e}://${t}/v1/graphql`,{headers:{...i,...o}}).request(r,n,o).then(a=>({data:a}))}},Bo=wc;var Ni=class{constructor(e){this.post=(e,t,i=!0)=>this.authEnabled?this.login().then(r=>this.http.post(e,t,i,r)):this.http.post(e,t,i);this.put=(e,t,i=!0)=>this.authEnabled?this.login().then(r=>this.http.put(e,t,i,r)):this.http.put(e,t,i);this.patch=(e,t)=>this.authEnabled?this.login().then(i=>this.http.patch(e,t,i)):this.http.patch(e,t);this.delete=(e,t,i=!1)=>this.authEnabled?this.login().then(r=>this.http.delete(e,t,i,r)):this.http.delete(e,t,i);this.head=(e,t)=>this.authEnabled?this.login().then(i=>this.http.head(e,t,i)):this.http.head(e,t);this.get=(e,t=!0)=>this.authEnabled?this.login().then(i=>this.http.get(e,t,i)):this.http.get(e,t);this.query=(e,t)=>this.authEnabled?this.login().then(i=>{let r={Authorization:`Bearer ${i}`};return this.gql.query(e,t,r)}):this.gql.query(e,t);this.login=async()=>{if(this.apiKey)return this.apiKey;if(!this.oidcAuth)return"";let e=await new he(this.http).do();return e===void 0?(console.warn("client is configured for authentication, but server is not"),""):(Date.now()>=this.oidcAuth.getExpiresAt()&&await this.oidcAuth.refresh(e),this.oidcAuth.getAccessToken())};e=this.sanitizeParams(e),this.http=Io(e),this.gql=Bo(e),this.authEnabled=this.parseAuthParams(e)}parseAuthParams(e){if(e.authClientSecret&&e.apiKey)throw new Error("must provide one of authClientSecret (OIDC) or apiKey, cannot provide both");return e.authClientSecret?(this.oidcAuth=new Si(this.http,e.authClientSecret),!0):e.apiKey?(this.apiKey=e.apiKey?.apiKey,!0):!1}sanitizeParams(e){for(;e.host.endsWith("/");)e.host=e.host.slice(0,-1);return e}};var le=class{constructor(e){this.source=e}toString(){if(this.parse(),this.validate(),this.operands)return`{operator:${this.operator},operands:[${this.operands}]}`;{let e=this.marshalValueContent();return`{operator:${this.operator},${this.valueType}:${e},path:${JSON.stringify(this.path)}}`}}marshalValueContent(){return this.valueType=="valueGeoRange"?this.marshalValueGeoRange():JSON.stringify(this.valueContent)}marshalValueGeoRange(){let e=[],t=this.valueContent.geoCoordinates;if(t){let r=[];t.latitude&&(r=[...r,`latitude:${t.latitude}`]),t.longitude&&(r=[...r,`longitude:${t.longitude}`]),e=[...e,`geoCoordinates:{${r.join(",")}}`]}let i=this.valueContent.distance;if(i){let r=[];i.max&&(r=[...r,`max:${i.max}`]),e=[...e,`distance:{${r.join(",")}}`]}return`{${e.join(",")}}`}validate(){if(!this.operator)throw new Error("where filter: operator cannot be empty");if(!this.operands){if(!this.valueType)throw new Error("where filter: value<Type> cannot be empty");if(!this.path)throw new Error("where filter: path cannot be empty")}}parse(){for(let e in this.source)switch(e){case"operator":this.parseOperator(this.source[e]);break;case"operands":this.parseOperands(this.source[e]);break;case"path":this.parsePath(this.source[e]);break;default:if(e.indexOf("value")!=0)throw new Error("where filter: unrecognized key '"+e+"'");this.parseValue(e,this.source[e])}}parseOperator(e){if(typeof e!="string")throw new Error("where filter: operator must be a string");this.operator=e}parsePath(e){if(!Array.isArray(e))throw new Error("where filter: path must be an array");this.path=e}parseValue(e,t){switch(e){case"valueString":case"valueText":case"valueInt":case"valueNumber":case"valueDate":case"valueBoolean":case"valueGeoRange":break;default:throw new Error("where filter: unrecognized value prop '"+e+"'")}this.valueType=e,this.valueContent=t}parseOperands(e){if(!Array.isArray(e))throw new Error("where filter: operands must be an array");this.operands=e.map(t=>new le(t).toString()).join(",")}};var ce=class{constructor(e){this.autocorrect=e.autocorrect,this.certainty=e.certainty,this.concepts=e.concepts,this.distance=e.distance,this.moveAwayFrom=e.moveAwayFrom,this.moveTo=e.moveTo}toString(){this.validate();let e=[`concepts:${JSON.stringify(this.concepts)}`];if(this.certainty&&(e=[...e,`certainty:${this.certainty}`]),this.distance&&(e=[...e,`distance:${this.distance}`]),this.moveTo){let t=[];this.moveTo.concepts&&(t=[...t,`concepts:${JSON.stringify(this.moveTo.concepts)}`]),this.moveTo.objects&&(t=[...t,`objects:${this.parseMoveObjects("moveTo",this.moveTo.objects)}`]),this.moveTo.force&&(t=[...t,`force:${this.moveTo.force}`]),e=[...e,`moveTo:{${t.join(",")}}`]}if(this.moveAwayFrom){let t=[];this.moveAwayFrom.concepts&&(t=[...t,`concepts:${JSON.stringify(this.moveAwayFrom.concepts)}`]),this.moveAwayFrom.objects&&(t=[...t,`objects:${this.parseMoveObjects("moveAwayFrom",this.moveAwayFrom.objects)}`]),this.moveAwayFrom.force&&(t=[...t,`force:${this.moveAwayFrom.force}`]),e=[...e,`moveAwayFrom:{${t.join(",")}}`]}return this.autocorrect!==void 0&&(e=[...e,`autocorrect:${this.autocorrect}`]),`{${e.join(",")}}`}validate(){if(this.moveTo){if(!this.moveTo.concepts&&!this.moveTo.objects)throw new Error("nearText filter: moveTo.concepts or moveTo.objects must be present");if(!this.moveTo.force||!this.moveTo.concepts&&!this.moveTo.objects)throw new Error("nearText filter: moveTo must have fields 'concepts' or 'objects' and 'force'")}if(this.moveAwayFrom){if(!this.moveAwayFrom.concepts&&!this.moveAwayFrom.objects)throw new Error("nearText filter: moveAwayFrom.concepts or moveAwayFrom.objects must be present");if(!this.moveAwayFrom.force||!this.moveAwayFrom.concepts&&!this.moveAwayFrom.objects)throw new Error("nearText filter: moveAwayFrom must have fields 'concepts' or 'objects' and 'force'")}}parseMoveObjects(e,t){let i=[];for(let r in t){if(!t[r].id&&!t[r].beacon)throw new Error(`nearText: ${e}.objects[${r}].id or ${e}.objects[${r}].beacon must be present`);let n=[];t[r].id&&n.push(`id:"${t[r].id}"`),t[r].beacon&&n.push(`beacon:"${t[r].beacon}"`),i.push(`{${n.join(",")}}`)}return`[${i.join(",")}]`}};var ue=class{constructor(e){this.certainty=e.certainty,this.distance=e.distance,this.vector=e.vector}toString(e=!0){let t=[`vector:${JSON.stringify(this.vector)}`];return this.certainty&&(t=[...t,`certainty:${this.certainty}`]),this.distance&&(t=[...t,`distance:${this.distance}`]),e?`{${t.join(",")}}`:`${t.join(",")}`}};var de=class{constructor(e){this.beacon=e.beacon,this.certainty=e.certainty,this.distance=e.distance,this.id=e.id}toString(e=!0){this.validate();let t=[];return this.id&&(t=[...t,`id:${JSON.stringify(this.id)}`]),this.beacon&&(t=[...t,`beacon:${JSON.stringify(this.beacon)}`]),this.certainty&&(t=[...t,`certainty:${this.certainty}`]),this.distance&&(t=[...t,`distance:${this.distance}`]),e?`{${t.join(",")}}`:`${t.join(",")}`}validate(){if(!this.id&&!this.beacon)throw new Error("nearObject filter: id or beacon needs to be set")}};function vc(s){return Number.isInteger(s)}function Do(s){return vc(s)&&s>=0}var c=class{constructor(e){this.client=e,this._errors=[]}get errors(){return this._errors}addError(e){this._errors=[...this.errors,e]}addErrors(e){this._errors=[...this.errors,...e]}};var et=class extends c{constructor(t){super(t);this.withFields=t=>(this.fields=t,this);this.withClassName=t=>(this.className=t,this);this.withWhere=t=>{try{this.whereString=new le(t).toString()}catch(i){this.addError(i)}return this};this.withNearText=t=>{if(this.includesNearMediaFilter)throw new Error("cannot use multiple near<Media> filters in a single query");try{this.nearTextString=new ce(t).toString(),this.includesNearMediaFilter=!0}catch(i){this.addError(i.toString())}return this};this.withNearObject=t=>{if(this.includesNearMediaFilter)throw new Error("cannot use multiple near<Media> filters in a single query");try{this.nearObjectString=new de(t).toString(),this.includesNearMediaFilter=!0}catch(i){this.addError(i.toString())}return this};this.withNearVector=t=>{if(this.includesNearMediaFilter)throw new Error("cannot use multiple near<Media> filters in a single query");try{this.nearVectorString=new ue(t).toString(),this.includesNearMediaFilter=!0}catch(i){this.addError(i.toString())}return this};this.withObjectLimit=t=>{if(!Do(t))throw new Error("objectLimit must be a non-negative integer");return this.objectLimit=t,this};this.withLimit=t=>(this.limit=t,this);this.withGroupBy=t=>(this.groupBy=t,this);this.validateGroup=()=>{if(this.groupBy&&!Array.isArray(this.groupBy))throw new Error("groupBy must be an array")};this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateGroup(),this.validateIsSet(this.className,"className",".withClassName(className)"),this.validateIsSet(this.fields,"fields",".withFields(fields)")};this.do=()=>{let t="";if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));if(this.whereString||this.nearTextString||this.nearObjectString||this.nearVectorString||this.limit||this.groupBy){let i=[];this.whereString&&(i=[...i,`where:${this.whereString}`]),this.nearTextString&&(i=[...i,`nearText:${this.nearTextString}`]),this.nearObjectString&&(i=[...i,`nearObject:${this.nearObjectString}`]),this.nearVectorString&&(i=[...i,`nearVector:${this.nearVectorString}`]),this.groupBy&&(i=[...i,`groupBy:${JSON.stringify(this.groupBy)}`]),this.limit&&(i=[...i,`limit:${this.limit}`]),this.objectLimit&&(i=[...i,`objectLimit:${this.objectLimit}`]),t=`(${i.join(",")})`}return this.client.query(`{Aggregate{${this.className}${t}{${this.fields}}}}`)};this.includesNearMediaFilter=!1}};var Ri=class{constructor(e){this.properties=e.properties,this.query=e.query}toString(){let e=[`query:${JSON.stringify(this.query)}`];return this.properties!==void 0&&(e=[...e,`properties:${JSON.stringify(this.properties)}`]),`{${e.join(",")}}`}};var Pi=class{constructor(e){this.alpha=e.alpha,this.query=e.query,this.vector=e.vector}toString(){let e=[`query:${JSON.stringify(this.query)}`];return this.alpha!==void 0&&(e=[...e,`alpha:${JSON.stringify(this.alpha)}`]),this.vector!==void 0&&(e=[...e,`vector:${JSON.stringify(this.vector)}`]),`{${e.join(",")}}`}};var tt=class{constructor(e){this.certainty=e.certainty,this.distance=e.distance,this.image=e.image}toString(e=!0){this.validate();let t=[];if(this.image){let i=this.image;if(i.startsWith("data:")){let r=";base64,";i=i.substring(i.indexOf(r)+r.length)}t=[...t,`image:${JSON.stringify(i)}`]}return this.certainty&&(t=[...t,`certainty:${this.certainty}`]),this.distance&&(t=[...t,`distance:${this.distance}`]),e?`{${t.join(",")}}`:`${t.join(",")}`}validate(){if(!this.image)throw new Error("nearImage filter: image field must be present")}};var it=class{constructor(e){this.autocorrect=e.autocorrect,this.certainty=e.certainty,this.distance=e.distance,this.properties=e.properties,this.question=e.question,this.rerank=e.rerank}toString(e=!0){this.validate();let t=[];return this.question&&(t=[...t,`question:${JSON.stringify(this.question)}`]),this.properties&&(t=[...t,`properties:${JSON.stringify(this.properties)}`]),this.certainty&&(t=[...t,`certainty:${this.certainty}`]),this.distance&&(t=[...t,`distance:${this.distance}`]),this.autocorrect!==void 0&&(t=[...t,`autocorrect:${this.autocorrect}`]),this.rerank!==void 0&&(t=[...t,`rerank:${this.rerank}`]),e?`{${t.join(",")}}`:`${t.join(",")}`}validate(){if(!this.question)throw new Error("ask filter: question needs to be set")}};var xi=class{constructor(e){this.args=e}toString(){let e=[];return this.args.type&&(e=[...e,`type:${this.args.type}`]),this.args.force&&(e=[...e,`force:${this.args.force}`]),`{${e.join(",")}}`}};var Oi=class{constructor(e){this.args=e}toString(){let e=[];for(let t of this.args){let i=`{path:${JSON.stringify(t.path)}`;t.order?i=i.concat(`,order:${t.order}}`):i=i.concat("}"),e.push(i)}return e.join(",")}};var os=class{constructor(e){this.groupedTask=e.groupedTask,this.singlePrompt=e.singlePrompt}toString(){this.validate();let e="generate(",t=["error"];return this.singlePrompt&&(e+=`singleResult:{prompt:"${this.singlePrompt.replace(/[\n\r]+/g,"")}"}`,t.push("singleResult")),this.groupedTask&&(e+=`groupedResult:{task:"${this.groupedTask.replace(/[\n\r]+/g,"")}"}`,t.push("groupedResult")),e+=`){${t.join(" ")}}`,e}validate(){if(!this.groupedTask&&!this.singlePrompt)throw new Error("must provide at least one of `singlePrompt` or `groupTask`");if(this.groupedTask!==void 0&&this.groupedTask=="")throw new Error("groupedTask must not be empty");if(this.singlePrompt!==void 0&&this.singlePrompt=="")throw new Error("singlePrompt must not be empty")}};var st=class extends c{constructor(t){super(t);this.withFields=t=>(this.fields=t,this);this.withClassName=t=>(this.className=t,this);this.withAfter=t=>(this.after=t,this);this.withGroup=t=>{try{this.groupString=new xi(t).toString()}catch(i){this.addError(i.toString())}return this};this.withWhere=t=>{try{this.whereString=new le(t).toString()}catch(i){this.addError(i.toString())}return this};this.withNearText=t=>{if(this.includesNearMediaFilter)throw new Error("cannot use multiple near<Media> filters in a single query");return this.nearTextString=new ce(t).toString(),this.includesNearMediaFilter=!0,this};this.withBm25=t=>{try{this.bm25String=new Ri(t).toString()}catch(i){this.addError(i.toString())}return this};this.withHybrid=t=>{try{this.hybridString=new Pi(t).toString()}catch(i){this.addError(i.toString())}return this};this.withNearObject=t=>{if(this.includesNearMediaFilter)throw new Error("cannot use multiple near<Media> filters in a single query");try{this.nearObjectString=new de(t).toString(),this.includesNearMediaFilter=!0}catch(i){this.addError(i.toString())}return this};this.withAsk=t=>{try{this.askString=new it(t).toString()}catch(i){this.addError(i.toString())}return this};this.withNearImage=t=>{if(this.includesNearMediaFilter)throw new Error("cannot use multiple near<Media> filters in a single query");try{this.nearImageString=new tt(t).toString(),this.includesNearMediaFilter=!0}catch(i){this.addError(i.toString())}return this};this.withNearVector=t=>{if(this.includesNearMediaFilter)throw new Error("cannot use multiple near<Media> filters in a single query");try{this.nearVectorString=new ue(t).toString(),this.includesNearMediaFilter=!0}catch(i){this.addError(i.toString())}return this};this.withLimit=t=>(this.limit=t,this);this.withOffset=t=>(this.offset=t,this);this.withSort=t=>(this.sortString=new Oi(t).toString(),this);this.withGenerate=t=>(this.generateString=new os(t).toString(),this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.className,"className",".withClassName(className)"),this.validateIsSet(this.fields,"fields",".withFields(fields)")};this.do=()=>{let t="";if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let i=[];return this.whereString&&(i=[...i,`where:${this.whereString}`]),this.nearTextString&&(i=[...i,`nearText:${this.nearTextString}`]),this.nearObjectString&&(i=[...i,`nearObject:${this.nearObjectString}`]),this.askString&&(i=[...i,`ask:${this.askString}`]),this.nearImageString&&(i=[...i,`nearImage:${this.nearImageString}`]),this.nearVectorString&&(i=[...i,`nearVector:${this.nearVectorString}`]),this.bm25String&&(i=[...i,`bm25:${this.bm25String}`]),this.hybridString&&(i=[...i,`hybrid:${this.hybridString}`]),this.groupString&&(i=[...i,`group:${this.groupString}`]),this.limit&&(i=[...i,`limit:${this.limit}`]),this.offset&&(i=[...i,`offset:${this.offset}`]),this.sortString&&(i=[...i,`sort:[${this.sortString}]`]),this.after&&(i=[...i,`after:"${this.after}"`]),this.generateString&&(this.fields?.includes("_additional")?this.fields.replace("_additional{",`_additional{${this.generateString}`):this.fields=this.fields?.concat(` _additional{${this.generateString}}`)),i.length>0&&(t=`(${i.join(",")})`),this.client.query(`{Get{${this.className}${t}{${this.fields}}}}`)};this.includesNearMediaFilter=!1}};var rt=class extends c{constructor(t){super(t);this.withFields=t=>(this.fields=t,this);this.withLimit=t=>(this.limit=t,this);this.withNearText=t=>{try{this.nearTextString=new ce(t).toString()}catch(i){this.addError(i.toString())}return this};this.withNearObject=t=>{try{this.nearObjectString=new de(t).toString()}catch(i){this.addError(i.toString())}return this};this.withAsk=t=>{try{this.askString=new it(t).toString()}catch(i){this.addError(i.toString())}return this};this.withNearImage=t=>{try{this.nearImageString=new tt(t).toString()}catch(i){this.addError(i.toString())}return this};this.withNearVector=t=>{try{this.nearVectorString=new ue(t).toString()}catch(i){this.addError(i.toString())}return this};this.validateGroup=()=>{if(this.group&&!Array.isArray(this.group))throw new Error("groupBy must be an array")};this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.fields,"fields",".withFields(fields)")};this.do=()=>{let t="";if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let i=[];return this.nearTextString&&(i=[...i,`nearText:${this.nearTextString}`]),this.nearObjectString&&(i=[...i,`nearObject:${this.nearObjectString}`]),this.askString&&(i=[...i,`ask:${this.askString}`]),this.nearImageString&&(i=[...i,`nearImage:${this.nearImageString}`]),this.nearVectorString&&(i=[...i,`nearVector:${this.nearVectorString}`]),this.limit&&(i=[...i,`limit:${this.limit}`]),t=`(${i.join(",")})`,this.client.query(`{Explore${t}{${this.fields}}}`)};this.params={}}};var nt=class extends c{constructor(t){super(t);this.withQuery=t=>(this.query=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.query,"query",".raw().withQuery(query)")};this.do=()=>{let t="";return this.validate(),this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.query?this.client.query(this.query):Promise.resolve(void 0)}}};var bc=s=>({get:()=>new st(s),aggregate:()=>new et(s),explore:()=>new rt(s),raw:()=>new nt(s)}),ko=bc;var ot=class extends c{constructor(t){super(t);this.withClass=t=>(this.class=t,this);this.validateClass=()=>{(this.class==null||this.class==null)&&this.addError("class object must be set - set with .withClass(class)")};this.do=()=>{if(this.validateClass(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t="/schema";return this.client.post(t,this.class)}}validate(){this.validateClass()}};function m(s){return typeof s=="string"&&s.length>0}var at=class extends c{constructor(t){super(t);this.withClassName=t=>(this.className=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.validate=()=>{this.validateClassName()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=`/schema/${this.className}`;return this.client.delete(t,void 0,!1)}}};var ht=class extends c{constructor(t){super(t);this.withClassName=t=>(this.className=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.validate=()=>{this.validateClassName()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=`/schema/${this.className}`;return this.client.get(t)}}};var lt=class extends c{constructor(t){super(t);this.withClassName=t=>(this.className=t,this);this.withProperty=t=>(this.property=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.validateProperty=()=>{(this.property==null||this.property==null)&&this.addError("property must be set - set with .withProperty(property)")};this.validate=()=>{this.validateClassName(),this.validateProperty()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=`/schema/${this.className}/properties`;return this.client.post(t,this.property)}}};var ct=class extends c{constructor(t){super(t);this.do=()=>{if(this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t="/schema";return this.client.get(t)}}validate(){}};var Ti=class extends c{constructor(t){super(t);this.withClassName=t=>(this.className=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.validate=()=>{this.validateClassName()};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error(`invalid usage: ${this.errors.join(", ")}`)):Ir(this.client,this.className))}};function Ir(s,e){let t=`/schema/${e}/shards`;return s.get(t)}var ut=class extends c{constructor(t){super(t);this.withClassName=t=>(this.className=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.withShardName=t=>(this.shardName=t,this);this.validateShardName=()=>{m(this.shardName)||this.addError("shardName must be set - set with .withShardName(shardName)")};this.withStatus=t=>(this.status=t,this);this.validateStatus=()=>{m(this.status)||this.addError("status must be set - set with .withStatus(status)")};this.validate=()=>{this.validateClassName(),this.validateShardName(),this.validateStatus()};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error(`invalid usage: ${this.errors.join(", ")}`)):Lr(this.client,this.className,this.shardName,this.status))}};function Lr(s,e,t,i){let r=`/schema/${e}/shards/${t}`;return s.put(r,{status:i},!0)}var dt=class extends c{constructor(t){super(t);this.withClassName=t=>(this.className=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.withStatus=t=>(this.status=t,this);this.validateStatus=()=>{m(this.status)||this.addError("status must be set - set with .withStatus(status)")};this.validate=()=>{this.validateClassName(),this.validateStatus()};this.updateShards=async()=>{let t=await Promise.all(Array.from({length:this.shards.length},(i,r)=>Lr(this.client,this.className,this.shards[r].name||"",this.status).then(n=>({name:this.shards[r].name,status:n.status})).catch(n=>this.addError(n.toString()))));return this.errors.length>0?Promise.reject(new Error(`failed to update shards: ${this.errors.join(", ")}`)):Promise.resolve(t)};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error(`invalid usage: ${this.errors.join(", ")}`)):Ir(this.client,this.className).then(t=>this.shards=t).then(()=>this.updateShards()).then(t=>t).catch(t=>Promise.reject(t)));this.shards=[]}};var Ec=s=>({classCreator:()=>new ot(s),classDeleter:()=>new at(s),classGetter:()=>new ht(s),getter:()=>new ct(s),propertyCreator:()=>new lt(s),shardsGetter:()=>new Ti(s),shardUpdater:()=>new ut(s),shardsUpdater:()=>new dt(s)}),Fo=Ec;var ft=class extends c{constructor(t,i){super(t);this.withVector=t=>(this.vector=t,this);this.withClassName=t=>(this.className=t,this);this.withProperties=t=>(this.properties=t,this);this.withId=t=>(this.id=t,this);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.payload=()=>({vector:this.vector,properties:this.properties,class:this.className,id:this.id});this.validate=()=>{this.validateClassName()};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.objectsPath.buildCreate(this.consistencyLevel).then(t=>this.client.post(t,this.payload())));this.objectsPath=i}};var mt=class extends c{constructor(t){super(t);this.withClassName=t=>(this.className=t,this);this.withProperties=t=>(this.properties=t,this);this.withId=t=>(this.id=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with .withClassName(className)")};this.payload=()=>({properties:this.properties,class:this.className,id:this.id});this.validate=()=>{this.validateClassName()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t="/objects/validate";return this.client.post(t,this.payload(),!1).then(()=>!0)}}};var pt=class extends c{constructor(t,i){super(t);this.withProperties=t=>(this.properties=t,this);this.withId=t=>(this.id=t,this);this.withClassName=t=>(this.className=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - use withClassName(className)")};this.validateId=()=>{(this.id==null||this.id==null||this.id.length==0)&&this.addError("id must be set - initialize with updater(id)")};this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.payload=()=>({properties:this.properties,class:this.className,id:this.id});this.validate=()=>{this.validateClassName(),this.validateId()};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.objectsPath.buildUpdate(this.id,this.className,this.consistencyLevel).then(t=>this.client.put(t,this.payload())));this.objectsPath=i}};var gt=class extends c{constructor(t,i){super(t);this.withProperties=t=>(this.properties=t,this);this.withClassName=t=>(this.className=t,this);this.withId=t=>(this.id=t,this);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.validateClassName=()=>{m(this.className)||this.addError("className must be set - set with withClassName(className)")};this.validateId=()=>{(this.id==null||this.id==null||this.id.length==0)&&this.addError("id must be set - set with withId(id)")};this.payload=()=>({properties:this.properties,class:this.className,id:this.id});this.validate=()=>{this.validateClassName(),this.validateId()};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.objectsPath.buildMerge(this.id,this.className,this.consistencyLevel).then(t=>this.client.patch(t,this.payload())));this.objectsPath=i}};var yt=class extends c{constructor(t,i){super(t);this.withClassName=t=>(this.className=t,this);this.withAfter=t=>(this.after=t,this);this.withLimit=t=>(this.limit=t,this);this.extendAdditional=t=>(this.additional=[...this.additional,t],this);this.withAdditional=t=>this.extendAdditional(t);this.withVector=()=>this.extendAdditional("vector");this.do=()=>this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.objectsPath.buildGet(this.className,this.limit,this.additional,this.after).then(t=>this.client.get(t));this.objectsPath=i,this.additional=[]}validate(){}};var wt=class extends c{constructor(t,i){super(t);this.withId=t=>(this.id=t,this);this.withClassName=t=>(this.className=t,this);this.extendAdditional=t=>(this.additional=[...this.additional,t],this);this.withAdditional=t=>this.extendAdditional(t);this.withVector=()=>this.extendAdditional("vector");this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.withNodeName=t=>(this.nodeName=t,this);this.validateId=()=>{(this.id==null||this.id==null||this.id.length==0)&&this.addError("id must be set - initialize with getterById(id)")};this.validate=()=>{this.validateId()};this.buildPath=()=>this.objectsPath.buildGetOne(this.id,this.className,this.additional,this.consistencyLevel,this.nodeName);this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.buildPath().then(t=>this.client.get(t)));this.objectsPath=i,this.additional=[]}};var vt=class extends c{constructor(t,i){super(t);this.withId=t=>(this.id=t,this);this.withClassName=t=>(this.className=t,this);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validateId=()=>{this.validateIsSet(this.id,"id",".withId(id)")};this.validate=()=>{this.validateId()};this.do=()=>this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):(this.validate(),this.objectsPath.buildDelete(this.id,this.className,this.consistencyLevel).then(t=>this.client.delete(t,void 0,!1)));this.objectsPath=i}};var bt=class extends c{constructor(t,i){super(t);this.withId=t=>(this.id=t,this);this.withClassName=t=>(this.className=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validateId=()=>{this.validateIsSet(this.id,"id",".withId(id)")};this.validate=()=>{this.validateId()};this.do=()=>this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):(this.validate(),this.objectsPath.buildCheck(this.id,this.className).then(t=>this.client.head(t,void 0)));this.objectsPath=i}};var Et=class extends c{constructor(t,i,r){super(t);this.withId=t=>(this.id=t,this);this.withReference=t=>(this.reference=t,this);this.withReferenceProperty=t=>(this.refProp=t,this);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.id,"id",".withId(id)"),this.validateIsSet(this.refProp,"referenceProperty",".withReferenceProperty(refProp)")};this.payload=()=>this.reference;this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));if(!this.reference.beacon)throw new Error("reference beacon must be set");return Promise.all([this.referencesPath.build(this.id,this.className,this.refProp,this.consistencyLevel),this.beaconPath.rebuild(this.reference.beacon)]).then(t=>{let i=t[0],r=t[1];return this.client.post(i,{beacon:r},!1)})};this.referencesPath=i,this.beaconPath=r}withClassName(t){return this.className=t,this}};var St=class extends c{constructor(t,i,r){super(t);this.withId=t=>(this.id=t,this);this.withReferences=t=>(this.references=t,this);this.withReferenceProperty=t=>(this.refProp=t,this);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.id,"id",".withId(id)"),this.validateIsSet(this.refProp,"referenceProperty",".withReferenceProperty(refProp)")};this.payload=()=>this.references;this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=Array.isArray(this.references)?Promise.all(this.references.map(i=>this.rebuildReferencePromise(i))):Promise.resolve([]);return Promise.all([this.referencesPath.build(this.id,this.className,this.refProp,this.consistencyLevel),t]).then(i=>{let r=i[0],n=i[1];return this.client.put(r,n,!1)})};this.beaconPath=r,this.referencesPath=i}withClassName(t){return this.className=t,this}rebuildReferencePromise(t){return this.beaconPath.rebuild(t.beacon).then(i=>({beacon:i}))}};var Ct=class extends c{constructor(t,i,r){super(t);this.withId=t=>(this.id=t,this);this.withReference=t=>(this.reference=t,this);this.withReferenceProperty=t=>(this.refProp=t,this);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.id,"id",".withId(id)"),this.validateIsSet(this.refProp,"referenceProperty",".withReferenceProperty(refProp)")};this.payload=()=>this.reference;this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));if(!this.reference.beacon)throw new Error("reference beacon must be set");return Promise.all([this.referencesPath.build(this.id,this.className,this.refProp,this.consistencyLevel),this.beaconPath.rebuild(this.reference.beacon)]).then(t=>{let i=t[0],r=t[1];return this.client.delete(i,{beacon:r},!1)})};this.referencesPath=i,this.beaconPath=r}withClassName(t){return this.className=t,this}};var Nt=class extends c{constructor(t){super(t);this.withId=t=>(this.id=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.id,"id",".withId(id)")};this.payload=()=>{if(this.validate(),this.errors.length>0)throw new Error(this.errors.join(", "));let t="weaviate://localhost";return m(this.className)&&(t=`${t}/${this.className}`),{beacon:`${t}/${this.id}`}}}withClassName(t){return this.className=t,this}do(){return Promise.reject(new Error("Should never be called"))}};var Mo="/objects",as=class{constructor(e){this.dbVersionSupport=e}buildCreate(e){return this.build({consistencyLevel:e},[this.addQueryParams])}buildDelete(e,t,i){return this.build({id:e,className:t,consistencyLevel:i},[this.addClassNameDeprecatedNotSupportedCheck,this.addId,this.addQueryParams])}buildCheck(e,t){return this.build({id:e,className:t},[this.addClassNameDeprecatedNotSupportedCheck,this.addId])}buildGetOne(e,t,i,r,n){return this.build({id:e,className:t,additional:i,consistencyLevel:r,nodeName:n},[this.addClassNameDeprecatedNotSupportedCheck,this.addId,this.addQueryParams])}buildGet(e,t,i,r){return this.build({className:e,limit:t,additional:i,after:r},[this.addQueryParamsForGet])}buildUpdate(e,t,i){return this.build({id:e,className:t,consistencyLevel:i},[this.addClassNameDeprecatedCheck,this.addId,this.addQueryParams])}buildMerge(e,t,i){return this.build({id:e,className:t,consistencyLevel:i},[this.addClassNameDeprecatedCheck,this.addId,this.addQueryParams])}build(e,t){return this.dbVersionSupport.supportsClassNameNamespacedEndpointsPromise().then(i=>{let r=Mo;return t.forEach(n=>{r=n(e,r,i)}),r})}addClassNameDeprecatedNotSupportedCheck(e,t,i){if(i.supports){if(m(e.className))return`${t}/${e.className}`;i.warns.deprecatedNonClassNameNamespacedEndpointsForObjects()}else i.warns.notSupportedClassNamespacedEndpointsForObjects();return t}addClassNameDeprecatedCheck(e,t,i){if(i.supports){if(m(e.className))return`${t}/${e.className}`;i.warns.deprecatedNonClassNameNamespacedEndpointsForObjects()}return t}addId(e,t){return m(e.id)?`${t}/${e.id}`:t}addQueryParams(e,t){let i=[];return Array.isArray(e.additional)&&e.additional.length>0&&i.push(`include=${e.additional.join(",")}`),m(e.nodeName)&&i.push(`node_name=${e.nodeName}`),m(e.consistencyLevel)&&i.push(`consistency_level=${e.consistencyLevel}`),i.length>0?`${t}?${i.join("&")}`:t}addQueryParamsForGet(e,t,i){let r=[];return Array.isArray(e.additional)&&e.additional.length>0&&r.push(`include=${e.additional.join(",")}`),typeof e.limit=="number"&&e.limit>0&&r.push(`limit=${e.limit}`),m(e.className)&&(i.supports?r.push(`class=${e.className}`):i.warns.notSupportedClassParameterInEndpointsForObjects()),m(e.after)&&r.push(`after=${e.after}`),r.length>0?`${t}?${r.join("&")}`:t}},hs=class{constructor(e){this.dbVersionSupport=e}build(e,t,i,r){return this.dbVersionSupport.supportsClassNameNamespacedEndpointsPromise().then(n=>{let o=Mo;return n.supports?m(t)?o=`${o}/${t}`:n.warns.deprecatedNonClassNameNamespacedEndpointsForReferences():n.warns.notSupportedClassNamespacedEndpointsForReferences(),m(e)&&(o=`${o}/${e}`),o=`${o}/references`,m(i)&&(o=`${o}/${i}`),m(r)&&(o=`${o}?consistency_level=${r}`),o})}};var Sc="weaviate://localhost",Jt=class{constructor(e){this.dbVersionSupport=e,this.beaconRegExp=/^weaviate:\/\/localhost(\/([^\\/]+))?(\/([^\\/]+))?[\\/]?$/gi}async rebuild(e){let t=await this.dbVersionSupport.supportsClassNameNamespacedEndpointsPromise(),i=new RegExp(this.beaconRegExp).exec(e);if(!i)return e;let r,n;i[4]!==void 0?(n=i[4],r=i[2]):n=i[2];let o=Sc;return t.supports?m(r)?o=`${o}/${r}`:t.warns.deprecatedNonClassNameNamespacedEndpointsForBeacons():t.warns.notSupportedClassNamespacedEndpointsForBeacons(),m(n)&&(o=`${o}/${n}`),o}};var Cc=(s,e)=>{let t=new as(e),i=new hs(e),r=new Jt(e);return{creator:()=>new ft(s,t),validator:()=>new mt(s),updater:()=>new pt(s,t),merger:()=>new gt(s,t),getter:()=>new yt(s,t),getterById:()=>new wt(s,t),deleter:()=>new vt(s,t),checker:()=>new bt(s,t),referenceCreator:()=>new Et(s,i,r),referenceReplacer:()=>new St(s,i,r),referenceDeleter:()=>new Ct(s,i,r),referencePayloadBuilder:()=>new Nt(s)}},jo=Cc;var fe=class extends c{constructor(t){super(t);this.withId=t=>(this.id=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validateId=()=>{this.validateIsSet(this.id,"id",".withId(id)")};this.validate=()=>{this.validateId()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=`/classifications/${this.id}`;return this.client.get(t)}}};var Rt=class extends c{constructor(t){super(t);this.withType=t=>(this.type=t,this);this.withSettings=t=>(this.settings=t,this);this.withClassName=t=>(this.className=t,this);this.withClassifyProperties=t=>(this.classifyProperties=t,this);this.withBasedOnProperties=t=>(this.basedOnProperties=t,this);this.withWaitForCompletion=()=>(this.waitForCompletion=!0,this);this.withWaitTimeout=t=>(this.waitTimeout=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validateClassName=()=>{this.validateIsSet(this.className,"className",".withClassName(className)")};this.validateBasedOnProperties=()=>{this.validateIsSet(this.basedOnProperties,"basedOnProperties",".withBasedOnProperties(basedOnProperties)")};this.validateClassifyProperties=()=>{this.validateIsSet(this.classifyProperties,"classifyProperties",".withClassifyProperties(classifyProperties)")};this.validate=()=>{this.validateClassName(),this.validateClassifyProperties(),this.validateBasedOnProperties()};this.payload=()=>({type:this.type,settings:this.settings,class:this.className,classifyProperties:this.classifyProperties,basedOnProperties:this.basedOnProperties});this.pollForCompletion=t=>new Promise((i,r)=>{let n=setTimeout(()=>{clearInterval(o),clearTimeout(n),r(new Error("classification didn't finish within configured timeout, set larger timeout with .withWaitTimeout(timeout)"))},this.waitTimeout),o=setInterval(()=>{new fe(this.client).withId(t).do().then(a=>{a.status==="completed"&&(clearInterval(o),clearTimeout(n),i(a))})},500)});this.do=()=>{if(this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));this.validate();let t="/classifications";return this.client.post(t,this.payload()).then(i=>this.waitForCompletion?this.pollForCompletion(i.id):Promise.resolve(i))};this.waitTimeout=10*60*1e3,this.waitForCompletion=!1}};var Nc=s=>({scheduler:()=>new Rt(s),getter:()=>new fe(s)}),$o=Nc;function ls(s){return Uo("/batch/objects",s)}function qo(s){return Uo("/batch/references",s)}function Uo(s,e){return e&&e.toString()!=""&&(s=`${s}?${e.toString()}`),s}var Pt=class extends c{constructor(t){super(t);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.payload=()=>({objects:this.objects});this.validateObjectCount=()=>{this.objects.length==0&&this.addError("need at least one object to send a request, add one with .withObject(obj)")};this.validate=()=>{this.validateObjectCount()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=new URLSearchParams;this.consistencyLevel&&t.set("consistency_level",this.consistencyLevel);let i=ls(t);return this.client.post(i,this.payload())};this.objects=[]}withObjects(...t){let i=t;return t.length&&Array.isArray(t[0])&&(i=t[0]),this.objects=[...this.objects,...i],this}withObject(t){return this.withObjects(t)}};var xt=class extends c{constructor(t){super(t);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.payload=()=>({match:{class:this.className,where:this.whereFilter},output:this.output,dryRun:this.dryRun});this.validateClassName=()=>{m(this.className)||this.addError("string className must be set - set with .withClassName(className)")};this.validateWhereFilter=()=>{typeof this.whereFilter!="object"&&this.addError("object where must be set - set with .withWhere(whereFilter)")};this.validate=()=>{this.validateClassName(),this.validateWhereFilter()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=new URLSearchParams;this.consistencyLevel&&t.set("consistency_level",this.consistencyLevel);let i=ls(t);return this.client.delete(i,this.payload(),!0)}}withClassName(t){return this.className=t,this}withWhere(t){return this.whereFilter=t,this}withOutput(t){return this.output=t,this}withDryRun(t){return this.dryRun=t,this}};var Ot=class extends c{constructor(t,i){super(t);this.withConsistencyLevel=t=>(this.consistencyLevel=t,this);this.payload=()=>this.references;this.validateReferenceCount=()=>{this.references.length==0&&this.addError("need at least one reference to send a request, add one with .withReference(obj)")};this.validate=()=>{this.validateReferenceCount()};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=new URLSearchParams;this.consistencyLevel&&t.set("consistency_level",this.consistencyLevel);let i=qo(t);return Promise.all(this.references.map(n=>this.rebuildReferencePromise(n))).then(n=>this.client.post(i,n))};this.rebuildReferencePromise=t=>this.beaconPath.rebuild(t.to).then(i=>({from:t.from,to:i}));this.beaconPath=i,this.references=[]}withReferences(...t){let i=t;return t.length&&Array.isArray(t[0])&&(i=t[0]),this.references=[...this.references,...i],this}withReference(t){return this.withReferences(t)}};var _i=class extends c{constructor(t){super(t);this.withFromId=t=>(this.fromId=t,this);this.withToId=t=>(this.toId=t,this);this.withFromClassName=t=>(this.fromClassName=t,this);this.withFromRefProp=t=>(this.fromRefProp=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.fromId,"fromId",".withFromId(id)"),this.validateIsSet(this.toId,"toId",".withToId(id)"),this.validateIsSet(this.fromClassName,"fromClassName",".withFromClassName(className)"),this.validateIsSet(this.fromRefProp,"fromRefProp",".withFromRefProp(refProp)")};this.payload=()=>{if(this.validate(),this.errors.length>0)throw new Error(this.errors.join(", "));let t="weaviate://localhost";return m(this.toClassName)&&(t=`${t}/${this.toClassName}`),{from:`weaviate://localhost/${this.fromClassName}/${this.fromId}/${this.fromRefProp}`,to:`${t}/${this.toId}`}};this.do=()=>Promise.reject(new Error("Should never be called"))}withToClassName(t){return this.toClassName=t,this}};var Rc=(s,e)=>{let t=new Jt(e);return{objectsBatcher:()=>new Pt(s),objectsBatchDeleter:()=>new xt(s),referencesBatcher:()=>new Ot(s,t),referencePayloadBuilder:()=>new _i(s)}},Go=Rc;var Tt=class extends c{constructor(t,i){super(t);this.do=()=>this.client.get("/.well-known/live",!1).then(()=>(setTimeout(()=>this.dbVersionProvider.refresh()),Promise.resolve(!0))).catch(()=>Promise.resolve(!1));this.dbVersionProvider=i}validate(){}};var _t=class extends c{constructor(t,i){super(t);this.do=()=>this.client.get("/.well-known/ready",!1).then(()=>(setTimeout(()=>this.dbVersionProvider.refresh()),Promise.resolve(!0))).catch(()=>Promise.resolve(!1));this.dbVersionProvider=i}validate(){}};var me=class extends c{constructor(t){super(t);this.do=()=>this.client.get("/meta",!0)}validate(){}};var Pc=(s,e)=>({liveChecker:()=>new Tt(s,e),readyChecker:()=>new _t(s,e),metaGetter:()=>new me(s),openidConfigurationGetter:()=>new he(s.http)}),Vo=Pc;var At=class extends c{constructor(t){super(t);this.withConcept=t=>(this.concept=t,this);this.withDefinition=t=>(this.definition=t,this);this.withWeight=t=>(this.weight=t,this);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.validate=()=>{this.validateIsSet(this.concept,"concept","withConcept(concept)"),this.validateIsSet(this.definition,"definition","withDefinition(definition)"),this.validateIsSet(this.weight?.toString()||"","weight","withWeight(weight)")};this.payload=()=>({concept:this.concept,definition:this.definition,weight:this.weight});this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t="/modules/text2vec-contextionary/extensions";return this.client.post(t,this.payload())}}};var It=class extends c{constructor(t){super(t);this.validateIsSet=(t,i,r)=>{(t==null||t==null||t.length==0)&&this.addError(`${i} must be set - set with ${r}`)};this.withConcept=t=>(this.concept=t,this);this.validate=()=>{this.validateIsSet(this.concept,"concept","withConcept(concept)")};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t=`/modules/text2vec-contextionary/concepts/${this.concept}`;return this.client.get(t)}}};var xc=s=>({conceptsGetter:()=>new It(s),extensionCreator:()=>new At(s)}),zo=xc;var cs=class{constructor(e){this.dbVersionProvider=e}supportsClassNameNamespacedEndpointsPromise(){return this.dbVersionProvider.getVersionPromise().then(e=>({version:e,supports:this.supportsClassNameNamespacedEndpoints(e),warns:{deprecatedNonClassNameNamespacedEndpointsForObjects:()=>console.warn(`Usage of objects paths without className is deprecated in Weaviate ${e}. Please provide className parameter`),deprecatedNonClassNameNamespacedEndpointsForReferences:()=>console.warn(`Usage of references paths without className is deprecated in Weaviate ${e}. Please provide className parameter`),deprecatedNonClassNameNamespacedEndpointsForBeacons:()=>console.warn(`Usage of beacons paths without className is deprecated in Weaviate ${e}. Please provide className parameter`),notSupportedClassNamespacedEndpointsForObjects:()=>console.warn(`Usage of objects paths with className is not supported in Weaviate ${e}. className parameter is ignored`),notSupportedClassNamespacedEndpointsForReferences:()=>console.warn(`Usage of references paths with className is not supported in Weaviate ${e}. className parameter is ignored`),notSupportedClassNamespacedEndpointsForBeacons:()=>console.warn(`Usage of beacons paths with className is not supported in Weaviate ${e}. className parameter is ignored`),notSupportedClassParameterInEndpointsForObjects:()=>console.warn(`Usage of objects paths with class query parameter is not supported in Weaviate ${e}. class query parameter is ignored`)}}))}supportsClassNameNamespacedEndpoints(e){if(typeof e=="string"){let t=e.split(".");if(t.length>=2){let i=parseInt(t[0],10),r=parseInt(t[1],10);return i==1&&r>=14||i>=2}}return!1}},Wo="",us=class{constructor(e){this.versionGetter=e,this.emptyVersionPromise=Promise.resolve(Wo),this.versionPromise=void 0}getVersionPromise(){return this.versionPromise?this.versionPromise:this.versionGetter().then(e=>this.assignPromise(e))}refresh(e=!1){return e||!this.versionPromise?(this.versionPromise=void 0,this.versionGetter().then(t=>this.assignPromise(t)).then(()=>Promise.resolve(!0))):Promise.resolve(!1)}assignPromise(e){return e===Wo?this.emptyVersionPromise:(this.versionPromise=Promise.resolve(e),this.versionPromise)}};function ds(s){if(Array.isArray(s)){let e=[];return s.forEach(t=>{m(t)||e.push("string className invalid - set with .withIncludeClassNames(...classNames)")}),e}return s!=null?["strings classNames invalid - set with .withIncludeClassNames(...classNames)"]:[]}function fs(s){if(Array.isArray(s)){let e=[];return s.forEach(t=>{m(t)||e.push("string className invalid - set with .withExcludeClassNames(...classNames)")}),e}return s!=null?["strings classNames invalid - set with .withExcludeClassNames(...classNames)"]:[]}function Be(s){return m(s)?[]:["string backend must set - set with .withBackend(backend)"]}function De(s){return m(s)?[]:["string backupId must be set - set with .withBackupId(backupId)"]}var Oc=1e3,Lt=class extends c{constructor(t,i){super(t);this.validate=()=>{this.addErrors([...ds(this.includeClassNames),...fs(this.excludeClassNames),...Be(this.backend),...De(this.backupId)])};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t={id:this.backupId,config:{},include:this.includeClassNames,exclude:this.excludeClassNames};return this.waitForCompletion?this._createAndWaitForCompletion(t):this._create(t)};this._create=t=>this.client.post(this._path(),t);this._createAndWaitForCompletion=t=>new Promise((i,r)=>{this._create(t).then(n=>{this.statusGetter.withBackend(this.backend).withBackupId(this.backupId);let o=()=>{this.statusGetter.do().then(a=>{a.status=="SUCCESS"||a.status=="FAILED"?i(this._merge(a,n)):setTimeout(o,Oc)}).catch(r)};o()}).catch(r)});this._path=()=>`/backups/${this.backend}`;this._merge=(t,i)=>{let r={};return"id"in t&&(r.id=t.id),"path"in t&&(r.path=t.path),"backend"in t&&(r.backend=t.backend),"status"in t&&(r.status=t.status),"error"in t&&(r.error=t.error),"classes"in i&&(r.classes=i.classes),r};this.statusGetter=i}withIncludeClassNames(...t){let i=t;return t.length&&Array.isArray(t[0])&&(i=t[0]),this.includeClassNames=i,this}withExcludeClassNames(...t){let i=t;return t.length&&Array.isArray(t[0])&&(i=t[0]),this.excludeClassNames=i,this}withBackend(t){return this.backend=t,this}withBackupId(t){return this.backupId=t,this}withWaitForCompletion(t){return this.waitForCompletion=t,this}};var ke=class extends c{constructor(t){super(t);this.validate=()=>{this.addErrors([...Be(this.backend),...De(this.backupId)])};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.client.get(this._path()));this._path=()=>`/backups/${this.backend}/${this.backupId}`}withBackend(t){return this.backend=t,this}withBackupId(t){return this.backupId=t,this}};var Tc=1e3,Bt=class extends c{constructor(t,i){super(t);this.validate=()=>{this.addErrors([...ds(this.includeClassNames||[]),...fs(this.excludeClassNames||[]),...Be(this.backend),...De(this.backupId)])};this.do=()=>{if(this.validate(),this.errors.length>0)return Promise.reject(new Error("invalid usage: "+this.errors.join(", ")));let t={config:{},include:this.includeClassNames,exclude:this.excludeClassNames};return this.waitForCompletion?this._restoreAndWaitForCompletion(t):this._restore(t)};this._restore=t=>this.client.post(this._path(),t);this._restoreAndWaitForCompletion=t=>new Promise((i,r)=>{this._restore(t).then(n=>{this.statusGetter.withBackend(this.backend).withBackupId(this.backupId);let o=()=>{this.statusGetter.do().then(a=>{a.status=="SUCCESS"||a.status=="FAILED"?i(this._merge(a,n)):setTimeout(o,Tc)}).catch(r)};o()}).catch(r)});this._path=()=>`/backups/${this.backend}/${this.backupId}/restore`;this._merge=(t,i)=>{let r={};return"id"in t&&(r.id=t.id),"path"in t&&(r.path=t.path),"backend"in t&&(r.backend=t.backend),"status"in t&&(r.status=t.status),"error"in t&&(r.error=t.error),"classes"in i&&(r.classes=i.classes),r};this.statusGetter=i}withIncludeClassNames(...t){let i=t;return t.length&&Array.isArray(t[0])&&(i=t[0]),this.includeClassNames=i,this}withExcludeClassNames(...t){let i=t;return t.length&&Array.isArray(t[0])&&(i=t[0]),this.excludeClassNames=i,this}withBackend(t){return this.backend=t,this}withBackupId(t){return this.backupId=t,this}withWaitForCompletion(t){return this.waitForCompletion=t,this}};var Fe=class extends c{constructor(t){super(t);this.validate=()=>{this.addErrors([...Be(this.backend),...De(this.backupId)])};this.do=()=>(this.validate(),this.errors.length>0?Promise.reject(new Error("invalid usage: "+this.errors.join(", "))):this.client.get(this._path()));this._path=()=>`/backups/${this.backend}/${this.backupId}/restore`}withBackend(t){return this.backend=t,this}withBackupId(t){return this.backupId=t,this}};var _c=s=>({creator:()=>new Lt(s,new ke(s)),createStatusGetter:()=>new ke(s),restorer:()=>new Bt(s,new Fe(s)),restoreStatusGetter:()=>new Fe(s)}),Ho=_c;var Dt=class extends c{constructor(e){super(e)}validate(){}do(){return this.client.get("/nodes")}};var Ac=s=>({nodesStatusGetter:()=>new Dt(s)}),Yo=Ac;var Ie=rs(require("fs")),Rr=require("https"),xo=rs(require("net")),rc=require("child_process"),Pr=require("path/posix"),Oo=require("os"),xr=require("path"),nc=rs(sc()),oc=require("crypto"),vf=(0,xr.join)((0,Oo.homedir)(),".cache/weaviate-embedded"),bf=(0,xr.join)((0,Oo.homedir)(),".local/share/weaviate"),Ef="1.18.1",ts=class{constructor(e){if(this.version&&this.binaryUrl)throw new Error("cannot provide both version and binaryUrl");this.host=e&&e.host?e.host:"127.0.0.1",this.port=e&&e.port?e.port:6666,this.binaryUrl=e?.binaryUrl,this.version=this.parseVersion(e),this.binaryPath=this.getBinaryPath(e),this.persistenceDataPath=this.getPersistenceDataPath(),this.env=this.parseEnv(e)}parseEnv(e){this.persistenceDataPath||(this.persistenceDataPath=this.getPersistenceDataPath());let t={AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED:"true",QUERY_DEFAULTS_LIMIT:"20",PERSISTENCE_DATA_PATH:this.persistenceDataPath,CLUSTER_HOSTNAME:`Embedded_at_${this.port}`,DEFAULT_VECTORIZER_MODULE:"none",ENABLE_MODULES:"text2vec-openai,text2vec-cohere,text2vec-huggingface,ref2vec-centroid,generative-openai,qna-openai",...process.env};return e&&e.env&&Object.entries(e.env).forEach(([i,r])=>{t[i]=r}),t}parseVersion(e){if(!(e&&e.binaryUrl)){if(!e||!e.version)return Ef;if(e.version=="latest")return"latest";if(e.version.match(/[1-9]\.[1-9]{2}\..*/g))return e.version;throw new Error(`invalid version: ${e.version}. version must resemble '{major}.{minor}.{patch}, or 'latest'`)}}getBinaryPath(e){let t=process.env.XDG_CACHE_HOME;if(t||(t=vf),this.version||(this.version=this.parseVersion(e)),this.binaryUrl){let i=(0,oc.createHash)("md5").update(this.binaryUrl).digest("base64url");return`${t}-${i}`}return`${t}-${this.version}`}getPersistenceDataPath(){let e=process.env.XDG_DATA_HOME;return e||(e=bf),e}},is=class{constructor(e){this.options=e,this.pid=0,this.ensurePathsExist(),Sf()}async start(){await this.isListening()&&console.log(`Embedded db already listening @ ${this.options.host}:${this.options.port}`),await this.resolveWeaviateVersion().then(async()=>{await this.ensureWeaviateBinaryExists()}),this.options.env.CLUSTER_GOSSIP_BIND_PORT||(this.options.env.CLUSTER_GOSSIP_BIND_PORT=await Cf());let e=(0,rc.spawn)(this.options.binaryPath,["--host",this.options.host,"--port",`${this.options.port}`,"--scheme","http"],{env:this.options.env});e.on("error",t=>{console.log(`embedded db failed to start: ${JSON.stringify(t)}`)}),e.stdout.pipe(process.stdout),e.stderr.pipe(process.stderr),this.pid=e.pid,console.log(`Started ${this.options.binaryPath} @ ${this.options.host}:${this.options.port} -- process ID ${this.pid}`),await this.waitTillListening()}stop(){try{process.kill(this.pid,"SIGTERM"),console.log(`Embedded db @ PID ${this.pid} successfully stopped`)}catch{console.log(`Tried to stop embedded db @ PID ${this.pid}.`,"PID not found, so nothing will be done")}}resolveWeaviateVersion(){return new Promise((e,t)=>{this.options.version=="latest"?(0,Rr.get)("https://api.github.com/repos/weaviate/weaviate/releases/latest",{headers:{"User-Agent":"Weaviate-Embedded-DB"}},i=>{let r="";i.on("data",n=>{r+=n}),i.on("end",()=>{if(i.statusCode===200)try{let n=JSON.parse(r);this.options.version=n.tag_name.slice(1),e()}catch(n){t(new Error(`failed to parse latest binary version response: ${JSON.stringify(n)}`))}else t(new Error(`fetch latest binary version, unexpected status code ${i.statusCode}: ${r}`))})}).on("error",i=>{t(new Error(`failed to find latest binary version: ${JSON.stringify(i)}`))}):e()})}async ensureWeaviateBinaryExists(){Ie.default.existsSync(`${this.options.binaryPath}`)||(console.log(`Binary ${this.options.binaryPath} does not exist.`,`Downloading binary for version ${this.options.version||this.options.binaryPath}`),await this.downloadBinary().then(e=>this.untarBinary(e)))}ensurePathsExist(){let e=(0,Pr.dirname)(this.options.binaryPath);Ie.default.mkdirSync(e,{recursive:!0}),Ie.default.mkdirSync(this.options.persistenceDataPath,{recursive:!0})}downloadBinary(){let e=`${this.options.binaryPath}.tgz`,t=Ie.default.createWriteStream(e);return new Promise((i,r)=>{let n=this.buildBinaryUrl();(0,Rr.get)(n,o=>{o.statusCode==200?(o.pipe(t),t.on("finish",()=>{t.close(),i(e)})):o.statusCode==302&&o.headers.location?(0,Rr.get)(o.headers.location,a=>{a.pipe(t),t.on("finish",()=>{t.close(),i(e)})}):o.statusCode==404?r(new Error(`failed to download binary: not found. are you sure Weaviate version ${this.options.version} exists? note that embedded db is only supported for versions >= 1.18.0`)):r(new Error(`failed to download binary: unexpected status code: ${o.statusCode}`))}).on("error",o=>{Ie.default.unlinkSync(e),r(new Error(`failed to download binary: ${JSON.stringify(o)}`))})})}buildBinaryUrl(){if(this.options.binaryUrl)return this.options.binaryUrl;let e;switch(process.arch){case"arm64":e="arm64";break;case"x64":e="amd64";break;default:throw new Error(`Embedded DB unsupported architecture: ${process.arch}`)}return`https://github.com/weaviate/weaviate/releases/download/v${this.options.version}/weaviate-v${this.options.version}-linux-${e}.tar.gz`}untarBinary(e){let t=Ie.default.createReadStream(e);return new Promise((i,r)=>{t.pipe((0,nc.extract)({cwd:(0,Pr.dirname)(e),strict:!0}).on("finish",()=>{t.close(),Ie.default.unlinkSync(e),Ie.default.renameSync((0,xr.join)((0,Pr.dirname)(this.options.binaryPath),"weaviate"),this.options.binaryPath),i(null)}).on("error",n=>{this.options.binaryUrl&&r(new Error(`failed to untar binary: ${JSON.stringify(n)}, are you sure binaryUrl points to a tar file?`)),r(new Error(`failed to untar binary: ${JSON.stringify(n)}`))}))})}waitTillListening(){return new Promise((e,t)=>{let i=setTimeout(()=>{clearTimeout(i),clearInterval(r),t(new Error(`failed to connect to embedded db @ ${this.options.host}:${this.options.port}`))},3e4),r=setInterval(()=>{this.isListening().then(n=>{n&&(clearTimeout(i),clearInterval(r),e(null))})},500)})}isListening(){let e=xo.default.connect(this.options.port,this.options.host);return new Promise(t=>{e.on("connect",()=>{console.log("connected to embedded db!"),e.destroy(),t(!0)}).on("error",i=>{console.log("Trying to connect to embedded db...",JSON.stringify(i)),e.destroy(),t(!1)})})}};function Sf(){let s=process.platform;if(s=="darwin"||s=="win32")throw new Error(`${s} is not supported with EmbeddedDB`)}function Cf(){return new Promise((s,e)=>{let t=xo.default.createServer();t.listen(0,()=>{let{port:i}=t.address();i?t.close(()=>s(i.toString())):e(new Error("failed to find open port"))})})}var ac={client:function(s){if(!s.host)throw new Error("Missing `host` parameter");if(!s.scheme)throw new Error("Missing `scheme` parameter");s.headers||(s.headers={});let e=new Ni(s),t=Nf(e),i=new cs(t),r={graphql:ko(e),schema:Fo(e),data:jo(e,i),classifications:$o(e),batch:Go(e,i),misc:Vo(e,t),c11y:zo(e),backup:Ho(e),cluster:Yo(e)};return s.embedded&&(r.embedded=new is(s.embedded)),e.oidcAuth&&(r.oidcAuth=e.oidcAuth),r},ApiKey:Ci,AuthUserPasswordCredentials:Kt,AuthAccessTokenCredentials:Xe,AuthClientCredentials:Zt,EmbeddedOptions:ts};function Nf(s){let e=new me(s),t=()=>e.do().then(r=>r.version).catch(()=>Promise.resolve("")),i=new us(t);return i.refresh(),i}module.exports=ac;var Rf=ac;0&&(module.exports={Aggregator,ApiKey,AuthAccessTokenCredentials,AuthClientCredentials,AuthUserPasswordCredentials,BackupCreateStatusGetter,BackupCreator,BackupRestoreStatusGetter,BackupRestorer,Checker,ClassCreator,ClassDeleter,ClassGetter,ClassificationsGetter,ClassificationsScheduler,ConceptsGetter,Creator,Deleter,EmbeddedDB,EmbeddedOptions,Explorer,ExtensionCreator,Getter,GetterById,GraphQLGetter,LiveChecker,Merger,MetaGetter,NodesStatusGetter,ObjectsBatchDeleter,ObjectsBatcher,OidcAuthenticator,OpenidConfigurationGetter,PropertyCreator,Raw,ReadyChecker,ReferenceCreator,ReferenceDeleter,ReferencePayloadBuilder,ReferenceReplacer,ReferencesBatcher,SchemaGetter,ShardUpdater,ShardsUpdater,Updater,Validator});
//# sourceMappingURL=index.js.map
